const posts={},LAST_CALL_TIME=Symbol("LAST_CALL_TIME"),SETTIMEOUT_HANDLE=Symbol("SETTIMEOUT_HANDLE"),STRING_HASH_CODE=Symbol("STRING_HASH_CODE");function stringHashCode(e){if(null!=e[STRING_HASH_CODE])return e[STRING_HASH_CODE];let t=0;if(0===e.length)return t;for(let o=0;o<e.length;o++)t=(t<<5)-t+e.charCodeAt(o),t|=0;return e[STRING_HASH_CODE]=t}function asNodes(e){const t=document.createElement("template");t.insertAdjacentHTML("afterbegin",e);for(const e of t.querySelectorAll("script")){const t=document.createElement("script");e.src.length>0&&(t.src=e.src),e.text.length>0&&(t.text=e.text),e.after(t),e.remove()}switch(t.childElementCount){case 0:return null;case 1:return t.firstChild;default:return Array.from(t.childNodes)}}function observeIntersectionOnce(e,t){Array.from(e).forEach((e=>{e instanceof Element==!1&&console.log("observeIntersectionOnce > ",e," ignored.");let o=!1;const n=new IntersectionObserver(((s,r)=>{!0===s[0].isIntersecting&&(n.disconnect(),!1===o&&(o=!0,t(e)))}));n.observe(e)}))}const numPartRegex1=/(((^|[\s$¥£₡₱€₩₭฿])[+-]?)?(\d+(,\d+)*(\.\d+)?)|(\d?\.\d+)|(\d+))/,numPartRegex2=/(([\s$¥£₡₱€₩₭฿][+-]?)?(\d+(,\d+)*(\.\d+)?)|(\d?\.\d+)|(\d+))/,startWithNumberRegex1=new RegExp(`^${numPartRegex1.source}`),startWithNumberRegex2=new RegExp(`^${numPartRegex2.source}`),textPartRegex1=new RegExp(`^((?!${numPartRegex1.source})[\\d\\D])+`,"m"),textPartRegex2=new RegExp(`^((?!${numPartRegex2.source})[\\d\\D])+`,"m");function naturalCompareString(e,t){if(e==t)return 0;const[o,n]=[e,t];for(;;){if(e.length*t.length==0)return e.length-t.length;const s=(e===o?startWithNumberRegex1:startWithNumberRegex2).test(e),r=(t===n?startWithNumberRegex1:startWithNumberRegex2).test(t);if(s&&r){const s=parseFloat(e.match(e===o?startWithNumberRegex1:startWithNumberRegex2)[0].replace(/[^\-\d\.]/g,"")),r=parseFloat(t.match(t===n?startWithNumberRegex1:startWithNumberRegex2)[0].replace(/[^\-\d\.]/g,""));if(Math.abs(s-r)>=Number.EPSILON)return s-r;e=e.replace(e===o?startWithNumberRegex1:startWithNumberRegex2,""),t=t.replace(t===n?startWithNumberRegex1:startWithNumberRegex2,"");continue}if(s)return-1;if(r)return 1;const a=e.match(e===o?textPartRegex1:textPartRegex2)[0],l=t.match(t===n?textPartRegex1:textPartRegex2)[0],i=a.localeCompare(l);if(0!==i)return i;e=e.replace(e===o?textPartRegex1:textPartRegex2,""),t=t.replace(t===n?textPartRegex1:textPartRegex2,"")}}const rgbaRegex=/(\d+)\D*(\d+)\D*(\d+)\D*(\d*\.?\d*)/;function getRgba(e){const t=window.getComputedStyle(e).getPropertyValue("background-color"),o=rgbaRegex.exec(t);return[parseInt(o[1]),parseInt(o[2]),parseInt(o[3]),t.search("rgba")>=0?parseFloat(o[3]):1]}function debounce(e,t){const o=function(...n){const s=o[LAST_CALL_TIME];o[LAST_CALL_TIME]=Date.now(),o[LAST_CALL_TIME]-s<=t&&clearTimeout(o[SETTIMEOUT_HANDLE]),o[SETTIMEOUT_HANDLE]=setTimeout((()=>e(...n)),t)};return o[LAST_CALL_TIME]=0,o[SETTIMEOUT_HANDLE]=null,o}function openLink(e,t){const o=document.createElement("a");o.href=e,o.target=t??"_blank",document.body.append(o),o.click(),o.remove()}function calcOffset(e){let t={left:e.offsetLeft,top:e.offsetTop};for(;null!=e.offsetParent;)t.left+=e.offsetParent.offsetLeft??0,t.top+=e.offsetParent.offsetTop??0,e=e.offsetParent;return t}function highlight(e){if(null==document.getElementById("highlight-css")){const e=asNodes('<style id="highlight-css">@keyframes highlight{from{background:#ff0;}to{background:#fff;}}</style>');document.querySelector("head").append(e)}e.style.animation?.length>0||(e.style.animation="highlight 3s 1",setTimeout((()=>{e.style.animation=""}),3e3))}function showSnackbar(e,t,o){if(null==document.getElementById("snackbar-css")){const e=asNodes('<style id="snackbar-css">#snackbar{visibility:hidden;min-width:250px;margin-left:-125px;background-color:#333;color:#fff;text-align:center;border-radius:2px;padding:16px;position:fixed;z-index:1000000;left:50%;bottom:30px;font-size:17px}\n#snackbar.show{visibility:visible;-webkit-animation:sf-fadein 0.5s,sf-fadeout 0.5s 2.5s;animation:sf-fadein 0.5s,sf-fadeout 0.5s 2.5s}\n@-webkit-keyframes sf-fadein{from{bottom:0;opacity:0}to{bottom:30px;opacity:1}}\n@keyframes sf-fadein{from{bottom:0;opacity:0}to{bottom:30px;opacity:1}}\n@-webkit-keyframes sf-fadeout{from{bottom:30px;opacity:1}to{bottom:0;opacity:0}}\n@keyframes sf-fadeout{from{bottom:30px;opacity:1}to{bottom:0;opacity:0}}</style>');document.getElementsByTagName("head")[0].append(e)}const n=asNodes(`<div id="snackbar" class="show">${e}</div>`);(t??document.body).append(n),setTimeout((()=>n.remove()),o??2e3)}function addHoverContent(e,t){const o=getRgba(e);e.style.backgroundColor=`rgba(${o[0]}, ${o[1]}, ${o[2]}, ${o[3]>.9?o[3]:o[3]+.1})`,t.style.position="absolute",t.style.display="none";const n=function(o){if("none"!==t.style.display){for(const n of[calcOffset(e),calcOffset(t)])if(n.left<o.pageX&&o.pageX<n.left+e.offsetWidth&&n.top<o.pageY&&o.pageY<n.top+e.offsetHeight)return;t.style.display="none"}};e.addEventListener("mouseenter",(function(e){"block"!==t.style.display&&(t.style.display="block",t.style.top=e.pageY+"px",t.style.left=e.pageX+"px",t.style.maxWidth=window.innerWidth-e.clientX+"px",t.style.maxHeight=window.innerHeight-e.clientY+"px",t.style.overflow="auto")})),e.addEventListener("mouseleave",debounce(n,300)),t.addEventListener("mouseleave",debounce(n,300))}function copyTextToCilpboard(e,t){const o=document.createElement("textarea");o.textContent=e,(t??document.body).append(o),o.select(),navigator.clipboard.writeText(o.textContent),o.remove()}function downloadText(e,t){const o=document.createElement("a");o.href=URL.createObjectURL(new Blob([e],{type:"text/plain;charset=utf-8;"})),o.target="_blank",o.download=t??"text.txt",document.body.append(o),o.click(),o.remove()}function printElement(e){const t=window.scrollY,o=document.getElementsByTagName("html")[0],n=asNodes(`<print>${e.innerHTML}</print>`);o.append(n),document.body.style.display="none",window.print(),document.body.style.display="block",n.remove(),window.scrollTo(0,t)}function toggleClass(e,t){for(const o of t)e.classList.contains(o)?e.classList.remove(o):e.classList.add(o)}async function yield(){return null!=globalThis.scheduler?.yield?await globalThis.scheduler.yield():await new Promise((e=>{setTimeout(e,0)}))}async function initGoto(){observeIntersectionOnce(document.querySelectorAll("a.goto"),(e=>{e.addEventListener("click",(function(){0===e.id.length&&(e.id=`goto-${Math.random()}-${Math.random()}`),history.pushState({},"",`#${e.id}`)}))})),window.onpopstate=function(){if(location.hash.length<=1)return console.log("onpopstate > No location.hash");const e=document.getElementById(location.hash.slice(1));if(null==e)return console.log("onpopstate > No target");let t=e;for(;0===t.clientHeight;)t=null==t.nextSibling?t.parentElement:t.nextSibling;goto(t)}}function initNav(){document.getElementById("nav-toggle-btn").addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation();const t=document.getElementById("sidebar");"none"===t.computedStyleMap().get("display")?.value?(t.style.display="block",document.documentElement.style.setProperty("--sidebar-width","333px")):(t.style.display="none",document.documentElement.style.setProperty("--sidebar-width","0px"))})),document.getElementById("query").onkeydown=function(e){return"Enter"!==e.key||(openLink(`https://github.com/search?q=repo:Dong-gi/Dong-gi.github.io+${encodeURIComponent(e.target.value)}&type=code`,"_blank"),e.stopPropagation(),!1)}}async function initCodeBtn(){observeIntersectionOnce(document.body.querySelectorAll("button.btn-code"),(codeButton=>{codeButton.id="code-button-"+Math.random().toString().slice(2)+stringHashCode(codeButton.title),codeButton.onclick=async function(e){const button=e.target,path=button.title,codeId=button.id.slice(12),codeDivId="code-div-"+codeId;let codeDiv=document.getElementById(codeDivId);if(null!=codeDiv)return toggleClass(codeDiv,["w3-hide"]),void(codeDiv.style.maxHeight=window.innerHeight/3+"px");const codeTxt=await fetch(`${path.startsWith("/")?"":"./"}${path.replace(/ /gm,"%20")}`).then((e=>e.text())).catch((e=>(console.log("Fetch failed...",e),"Fetch failed...")));codeDiv=asNodes(`<div id="${codeDivId}" class="w3-leftbar w3-border-green code-div"></div>`);const lan=button.getAttribute("lan");if(posts.codes[codeId]=codeTxt,fillCodeDiv(codeDiv,lan,codeTxt,button.getAttribute("displayRange")),codeDiv.style.maxHeight=window.innerHeight/3+"px","nohighlight"!==lan){const e=asNodes('<button class="w3-btn w3-round w3-round-xxlarge w3-small w3-blue">모달로 보기</button>');e.onclick=()=>showModal(codeId),button.after(e),e.after(codeDiv)}else button.after(codeDiv);if(/javascript/i.test(lan)){const script=asNodes('<button class="w3-btn w3-round w3-round-xxlarge w3-small w3-green">실행</button>');script.onclick=function(){const code=Array.from(codeDiv.querySelectorAll("li")).map((e=>e.textContent)).join("\n");eval(code)},button.after(script)}}}))}async function initHoverContent(){observeIntersectionOnce(document.body.querySelectorAll(".hover-content"),(e=>{addHoverContent(e,document.getElementById(e.getAttribute("template-id")))}))}async function initInlineCode(){observeIntersectionOnce(document.body.querySelectorAll("div.as-code"),(e=>{const t=e.innerHTML.trim().replace(/&lt;/gm,"<").replace(/&gt;/gm,">").replace(/&amp;/gm,"&");e.innerHTML="";const o=e.getAttribute("lan")??"text";fillCodeDiv(e,o,t),e.style.maxHeight=window.innerHeight/3+"px"})),observeIntersectionOnce(document.body.querySelectorAll("span.as-code"),(e=>{const t=e.innerHTML.trim().replace(/&lt;/gm,"<").replace(/&gt;/gm,">").replace(/&amp;/gm,"&");e.innerHTML=hljs.highlight(t,{language:e.getAttribute("lan")??"text",ignoreIllegals:!0}).value}))}function goto(e){console.log("goto > ",e),highlight(e);for(let t=e;"BODY"!==t.tagName;t=t.parentNode)"DETAILS"===t.tagName&&(t.open=!0);const t=calcOffset(e).top-document.getElementById("nav").clientHeight;setTimeout((()=>{window.scrollTo({top:t}),document.body.scrollTop=t}),100)}async function updatePostList(){const e=new Map,t=new Map,o=asNodes('<details open class="w3-small"><summary>Category</summary><ul></ul></details>'),n=location.href.toLowerCase();for(const s of posts.list){await yield();const r=s.category.split("/"),a=n.search(s.file.toLowerCase())>=0;let l=null;for(let t=0;t<r.length;++t){const n=r.slice(0,t+1).join("/");if(e.has(n)){l=e.get(n),l.open||=a;continue}const s=asNodes(`<li><details class="w3-small" title="${n}"><summary>${r[t]}</summary><ul></ul></details></li>`),i=s.firstChild;e.set(n,i),null!=l?l.querySelector("ul").append(s):o.querySelector("ul").append(s),l=i,l.open||=a}t.has(s.category)||t.set(s.category,[]),t.get(s.category).push(s)}for(const o of t.keys()){const s=e.get(o).querySelector("ul"),r=t.get(o);for(const e of r){const t=n.search(e.file.toLowerCase())>=0;s.append(asNodes(`<li><a ${t?'class="w3-yellow"':""} href="/posts/${e.file}">${e.title}</a></li>`))}}document.getElementById("post-list").append(o)}async function updateMarkerList(){const e=asNodes('<details open class="w3-small"><summary>Content</summary><ul></ul></details>'),t=e.querySelector("ul"),o=document.querySelector("#contents"),n=new Set(["THEAD","TBODY","TR","SPAN"]),s=[0,0,0,0,0,0,0,0],r=new Set(["H1","H2","H3","H4","H5","H6"]);for(const e of document.querySelectorAll("h1:not(.no-marker), h2:not(.no-marker), h3:not(.no-marker), h4:not(.no-marker), h5:not(.no-marker), h6:not(.no-marker), .marker:not(.no-marker)")){await yield();const a=makeMarkerName(e),l=`pos${stringHashCode(a)}`;e.before(asNodes(`<span class="pos-span" id="${l}"></span>`));const i=asNodes(`<li><a title="${a}" href="#${l}"></a></li>`);let c=0,d=e.parentElement;for(;d!==o;)d=d.parentElement,n.has(d.tagName)||(c+=1);0!==c&&i.classList.add(`margin-left-${c}`),s[c]+=1,s.fill(0,c+1);const u=`${s.filter((e=>e>0)).join(".")}.`;i.querySelector("a").textContent=`${u}${a.substring(0,50)}`,r.has(e.tagName)&&(e.dataset.beforeText=u),e.classList.contains("fake")||t.append(i)}document.getElementById("marker-list").append(e)}function makeMarkerName(e){switch(e.tagName){case"IMG":return`이미지 : ${e.parentElement.querySelector("figcaption")?.textContent??"No description"}`;case"TABLE":return`표 : ${e.caption.textContent}`;case"DETAILS":return e.firstChild.textContent;default:const t=Array.from(e.childNodes).find((e=>e instanceof Text&&0!==e.wholeText.trim().length));return null!=t?t.wholeText:e.textContent}}function fillCodeDiv(e,t,o,n){if("nohighlight"!==t){const s=o.replace(/\t/gm,"    ").replace(/ /gm,"  ").split(/\n/gm),r=[];(n=JSON.parse(n||"[1, 100000000]")??[1,1e8]).length%2==1&&n.push(1e8),n.reverse();let a=0;for(;n.length>0;){let e=[];const o=n.pop()-1,l=n.pop();let i=1e4;for(let t=o;t<l&&t<s.length;++t){const o=s[t];e.push(o);for(let e=0;e<i;++e)if(e>=o.length||32!==o.charCodeAt[e]){i=e;break}}i>0&&(e=e.map((e=>e.slice(i)))),"text"!==t&&(e=hljs.highlight(e.join("\n"),{language:t,ignoreIllegals:!0}).value.split(/\n/gm)),r.push(e),a+=e.length}const l=document.createElement("ol");for(const e of r){for(const o of e)if("text"===t){const e=document.createElement("li");e.innerText=o.replace(/  /gm," "),1===a&&(e.style.listStyleType="none"),l.append(e)}else l.append(asNodes(`<li ${1===a?'style="list-style-type:none;"':""}>${o.replace(/  /gm,"&nbsp;")}</li>`));e!==r[r.length-1]&&l.append(document.createElement("hr"))}e.append(l)}else{const t=asNodes(o);Array.isArray(t)?e.append(...t):e.append(t)}}function showModal(e){let t=document.getElementById(`code-modal-${e}`);if(null!=t)return void(t.style.display="block");t=asNodes(`<div id="code-modal-${e}" class="w3-modal code-modal">\n    <div class="w3-modal-content">\n        <header class="w3-container">\n            <h2 style="display: inline-block;" class="modal-title">${document.getElementById(`code-button-${e}`).title.split("/").pop()}</h2>\n            <span class="w3-btn w3-circle w3-display-topright close" style="color: black; font-size: 1.5em; font-weight: bold;">&times;</span>\n        </header>\n        <div class="w3-container w3-leftbar w3-border-green code-modal-body code-div"></div>\n        <footer class="w3-container w3-display-bottomright">\n            <button class="w3-btn w3-white w3-border w3-border-green w3-round-xlarge copy">Copy</button>\n            <button class="w3-btn w3-white w3-border w3-border-green w3-round-xlarge download">Download</button>\n            <button class="w3-btn w3-white w3-border w3-border-green w3-round-xlarge print">Print</button>\n            <button class="w3-btn w3-white w3-border w3-border-red w3-round-xlarge close">Close</button>\n        </footer>\n    </div>\n</div>`),t.style.display="block";const o=t.querySelector("header"),n=t.querySelector(".code-modal-body"),s=t.querySelector("footer");n.innerHTML=document.getElementById(`code-div-${e}`).innerHTML,n.style.height=window.innerHeight-parseFloat(window.getComputedStyle(o).height),s.querySelector("button.copy").onclick=function(){copyTextToCilpboard(posts.codes[e],t),showSnackbar("복사 완료",t),t.focus()},s.querySelector("button.download").onclick=function(){downloadText(posts.codes[e],document.getElementById(`code-button-${e}`).title.split("/").pop())},s.querySelector("button.print").onclick=function(){printElement(asNodes(`<div>${o.innerHTML}${n.innerHTML}</div>`))};for(const e of t.querySelectorAll(".close"))e.onclick=function(){t.style.display="none"};document.body.append(t)}window.addEventListener("load",(async()=>{initNav(),await Promise.allSettled([initInlineCode(),initGoto(),initCodeBtn(),initHoverContent(),fetch("/files/posts-compressed.json").then((e=>e.json())).then((async e=>{Object.assign(posts,e),posts.list=[...posts.list.filter((e=>!Array.isArray(e.category))),...posts.list.filter((e=>Array.isArray(e.category))).flatMap((e=>e.category.map((t=>Object.assign({},e,{category:t})))))].sort(((e,t)=>{const o=e.category.localeCompare(t.category);return 0!==o?o:e.title.localeCompare(t.title)})),await Promise.all([updatePostList(),updateMarkerList()]);const t=posts.list.find((e=>location.pathname.endsWith(e.file)));null!=t&&Number.isInteger(t.mtimeMs)&&document.getElementById("contents").prepend(asNodes(`<p>Last update : ${new Date(t.mtimeMs).toISOString()}</p>`))}))]),window.onpopstate(),null!=navigator.serviceWorker&&(navigator.serviceWorker.controller?console.log("Offline service worker working..."):navigator.serviceWorker.register("/offline-service-worker.js",{scope:"/"}).then((()=>console.log("Offline service worker registered")))),console.log(hljs.listLanguages())}));