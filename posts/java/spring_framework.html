<html lnag="ko"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="google-site-verification" content="aH-DyzdytYQ0NPHNQFcs5dVoiu5YNs6CEEHYgqDmAFM"><meta name="author" content="Donggi Kim &lt;hi.donggi@gmail.com&gt;"><meta name="keywords" content="Spring Core, Spring MVC"><meta name="description" content="Spring Framework 정리"><title>Spring Framework</title><link id="w3css" rel="stylesheet" href="/source/w3.css"><link id="highlight-style" rel="stylesheet" href="/source/xcode.css"><link id="default-style" rel="stylesheet" href="/source/default.css"><script id="highlight-js" src="/source/highlight.pack.js"></script><script id="default-js" src="/source/default.min.js"></script><script id="dsq-count-scr" src="//donggi.disqus.com/count.js" async></script><script id="google-ads" data-ad-client="ca-pub-7897366614471210" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script><script id="google-analytics" src="https://www.googletagmanager.com/gtag/js?id=UA-143098403-1" async></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-143098403-1');</script></head><body><div id="sidebar" class="w3-bar-block w3-sidebar w3-animate-left"><hr><a href="javascript:closeSidebar();" class="w3-bar-item w3-button">Close &times;</a><hr><div id="marker-list"></div><hr><div id="post-list"></div><hr><div id="file-list"></div><hr></div><div id="main"><div id="nav" style="position:-webkit-sticky;position:sticky;top:0px;vertical-align:middle" class="w3-bar w3-blue w3-large"><button onclick="toggleSidebar()" class="w3-bar-item w3-button w3-hover-theme">&#9776;</button><input id="query" type="text" placeholder="search" style="max-width:35%" class="w3-bar-item"><a href="/" class="w3-bar-item w3-button w3-hover-theme">Home</a></div><div id="contents" class="w3-padding"><h1>Spring Framework</h1><div><a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green" href="https://spring.io/projects/spring-framework#learn">spring-framework#learn</a><a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green" href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/index.html">spring-framework-reference</a><h2>Overview</h2><ul><li>상용 Java 앱 개발을 위한 JavaEE 대안 프레임워크. 다른 JVM 언어 ─ Groovy, Kotlin ─ 도 지원한다.</li><p>JavaEE보다 신규 사양의 결정, 신규 기능의 추가가 빠르다</p><li>Spring Framework 5에 추가된 WebFlux는 서블릿 컨테이너 대신 Netty 등의 리액티브 스트림 서버를 이용한다</li><li>Spring Framework는 순환적인 패키지 참조가 없는, 고도로 표준화된 코드를 유지한다.</li><li>빠른 시작</li><a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green" href="https://start.spring.io/">Spring Boot initializer</a><a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green" href="https://spring.io/guides#topical-guides">topical-guides</a></ul></div><h1>Core</h1><div><h2>IoC Container</h2><div><h3>Introduction</h3><ul><li>Dependency란?</li><p>객체가 정상적인 작동을 위해 필요로 하는 다른 객체</p><li>IoC(Inversion of Control), DI(Dependency Injection)란?</li><ul><li>객체 인스턴스화, 프로퍼티 설정을 Spring IoC 컨테이너가 대신 해준다.</li><li>의존성을 컨테이너가 주입(DI)한다.</li><li>의존성을 외부에서 설정하므로 제어의 역전(IoC)이 존재한다.</li></ul><li>Bean이란?</li><p>Spring IoC 컨테이너가 관리하는 인스턴스. 그 외 임의 인스턴스를 지칭해도 무방</p><li>연관 패키지</li><p>org.springframework.beans, org.springframework.context</p><li>ApplicationContext → BeanFactory 인터페이스</li><ul><li>BeanFactory : 임의 타입 객체를 관리할 수 있는, DI 관련 최상위 인터페이스.</li><li>ApplicationContext : AOP, 이벤트 발행 등 상용 애플리케이션에 쓰일 특징을 추가로 주입한다.</li></ul></ul><h3>Container Overview</h3><p>ApplicationContext는 메타데이터(XML, Java annotation Since 2.5, Java code Since 3.0)에 기술된 대로 클래스를 인스턴스화하고, 의존성을 주입한다.</p><ol><li>IoC 메타데이터 작성</li><li>IoC Container 인스턴스화</li><li>IoC Container 이용</li></ol><div><h4>XML 메타데이터</h4><ul><li>ClassPathXmlApplicationContext : 클래스 패스 상의 메타데이터 파일 이용</li><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">new ClassPathXmlApplicationContext("beans/Beans12.xml")</div><li>FileSystemXmlApplicationContext : 파일 시스템 상의 메타데이터 파일 이용</li><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">new FileSystemXmlApplicationContext("src/main/resource/anno01.xml")</div><li>GenericXmlApplicationContext Since 3.0</li><p>ClassPathXmlApplicationContext, FileSystemXmlApplicationContext 두 경우 모두 포함</p><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">new GenericXmlApplicationContext(
    "classpath:beans/Beans*.xml",
    "file:src/main/resource/anno*.xml"
)</div><li>WebApplicationContext : web.xml 이용</li></ul><div><h5 class="fake">최상위 &lt;beans> 안에 필요한 &lt;bean>들을 정의한다</h5><p><strong>↓ xml</strong></p><div lan="xml" class="as-code code-div w3-leftbar w3-border-green">&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
   http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">
    &lt;bean id="hello" class="io.github.donggi.bean.Hello"/>
&lt;/beans></div><h5 class="fake">다른 xml 포함</h5><p><strong>↓ xml</strong></p><div lan="xml" class="as-code code-div w3-leftbar w3-border-green">&lt;beans>
    &lt;import resource="other.xml"/>
    &lt;import resource="dir/other.xml"/>
&lt;/beans></div><p>↑ resource의 경로는 '/'로 시작하더라도 항상 현재 디렉터리에 대한 상대경로로 해석된다.</p></div><h4>Groovy DSL 메타데이터</h4><p><strong>↓ services.groovy</strong></p><div lan="groovy" class="as-code code-div w3-leftbar w3-border-green">beans {
    myService(MyService) {
        msg = "Hello World"
    }
}</div><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">var context = new GenericGroovyApplicationContext("services.groovy");</div><h4>GenericApplicationContext - 메타데이터 혼용</h4><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">var context = new GenericApplicationContext();
new XmlBeanDefinitionReader(context).loadBeanDefinitions("services.xml", "daos.xml");
new GroovyBeanDefinitionReader(context).loadBeanDefinitions("services.groovy", "daos.groovy");
context.refresh();
</div></div><h3>Bean Overview</h3><table class="no-sort"><caption>빈을 정의하는 요소 <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green" href="https://docs.spring.io/spring/docs/5.3.0-SNAPSHOT/javadoc-api/org/springframework/beans/factory/config/BeanDefinition.html">BeanDefinition</a></caption><tr><td>Class</td></tr><tr><td>Name</td></tr><tr><td>Scope</td></tr><tr><td>Constructor arguments</td></tr><tr><td>Properties</td></tr><tr><td>Autowiring mode</td></tr><tr><td>Lazy initialization mode</td></tr><tr><td>Initialization method</td></tr><tr><td>Destruction method</td></tr></table><div><h4>Naming Beans</h4><ul><li>모든 빈은 이름을 가지며, 지정하지 않더라도 자동 할당된다</li><li>XML에서 빈 이름은 id 또는 name 속성으로 정의할 수 있다</li><p>id는 컨테이너 전체에 걸쳐 고유해야 하며, name은 여러 이름을 ',', ';', ' '로 구분하여 설정할 수 있다</p><li>동일한 빈을 여러 이름으로 접근할 수 있다</li><p><strong>↓ xml</strong></p><div lan="xml" class="as-code code-div w3-leftbar w3-border-green">&lt;alias name="originalName" alias="alias1"/>
&lt;alias name="originalName" alias="alias2"/></div></ul><h4>Instantiating Beans</h4><ul><li>빈 클래스로 static 클래스 지정 가능</li><p><strong>↓ xml</strong></p><div lan="xml" class="as-code code-div w3-leftbar w3-border-green">&lt;bean class="com.example.SomeThing$OtherThing"/></div><li>팩터리 메서드 지정 가능</li><p><strong>↓ xml</strong></p><div lan="xml" class="as-code code-div w3-leftbar w3-border-green">&lt;bean class="..." factory-method="newInstance"/>
&lt;bean factory-bean="beanName" factory-method="newInstance"/></div><li>생성된 빈의 실제 타입은 BeanFactory#getType 메서드로 획득할 수 있다</li></ul></div><h3>Dependency Injection</h3><ul><li>A가 B에 의존하고, 둘 사이에 순환 의존성이 존재하지 않는다면, A에 B가 주입되기 전에 B가 완전히 초기화됨이 보장된다</li><li class="marker">생성자 주입 // 팩터리 메서드 인자도 동일한 태그를 사용한다</li><p><strong>↓ xml</strong></p><div lan="xml" class="as-code code-div w3-leftbar w3-border-green">&lt;constructor-arg index="0" type="java.lang.String" name="msg" value="Hell World"/>
&lt;constructor-arg value="Hell World"/>
&lt;constructor-arg ref="beanName"/>
&lt;constructor-arg>
    &lt;ref bean="beanName"/>
&lt;/constructor-arg></div><ul><li>index, type, name은 모호성을 피하기 위해 사용하는 옵션 프로퍼티이며, name을 이용하는 경우 debug 컴파일하거나, <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green" href="https://docs.oracle.com/javase/8/docs/api/java/beans/ConstructorProperties.html">ConstructorProperties</a>를 이용해 이름을 탐색할 수 있게 해야한다.</li><li>constructor-arg를 이용한 생성자 주입 예</li><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello17.java" displayRange="[7]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans25.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello17Test.java" displayRange="[8]" lan="java">Context</button><li>xmlns:c를 이용한 생성자 주입 예</li><ul><li>생성자 인자 이름을 알 수 있는 경우 예 : <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello17.java" displayRange="[7]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans26.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello17Test2.java" displayRange="[8]" lan="java">Context</button></li><li>생성자 인자 이름을 알 수 없는 경우 예 : <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello17.java" displayRange="[7]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans32.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello17Test4.java" displayRange="[8]" lan="java">Context</button></li></ul></ul><li class="marker">세터 주입</li><p><strong>↓ xml</strong></p><div lan="xml" class="as-code code-div w3-leftbar w3-border-green">&lt;property name="message" value="Hello"/>
&lt;property name="message" ref="beanName"/>
&lt;property name="message">
    &lt;ref bean="beanName"/>
&lt;/property>
&lt;property name="message">
    &lt;bean class="java.lang.String" c:original="빈 메시지 2"/>
&lt;/property></div><ul><li>인자 없는 생성자 또는 팩터리 메서드 호출 뒤, 세터를 호출하여 의존성을 주입한다</li><li>property를 이용한 세터 주입 예</li><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello1.java" displayRange="[5]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans1.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello1Test.java" displayRange="[8]" lan="java">Context</button><li>xmlns:p를 이용한 세터 주입 예</li><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello1.java" displayRange="[5]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans5.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello1Test2.java" displayRange="[8]" lan="java">Context</button></ul><li class="marker">기타 의존성 주입</li><table><tr><th>종류</th><th>예시 코드</th></tr><tr><td>익명 빈 생성</td><td><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello17.java" displayRange="[7]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans27.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello17Test3.java" displayRange="[8]" lan="java">Context</button></td></tr><tr><td>의존 빈 주입</td><td>property, constructor-arg 태그 안에서 이용하는 bean 태그들은 id, name이 필요없으며, 지정해도 무시된다.<button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello1.java" displayRange="[5]" lan="java">Bean1</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello17.java" displayRange="[7]" lan="java">Bean2</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans7.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello4Test3.java" displayRange="[8]" lan="java">Context</button></td></tr><tr><td>의존 컬렉션 주입</td><td>자바 기본 타입 및 String은 문자열로부터 알아서 변환되어 주입된다.
 반면 배열, List, Properties, Map 등은 전용 태그를 이용하거나, 다른 팩터리 메서드를 빌려 설정해야 한다.<button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello5.java" displayRange="[10]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans8.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello5Test.java" displayRange="[11]" lan="java">Context</button></td></tr><tr><td>팩터리를 통한 의존 컬렉션 주입</td><td><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello5.java" displayRange="[10]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans10.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello5Test3.java" displayRange="[11]" lan="java">Context</button></td></tr><tr><td>xmlns:util을 이용한 의존 컬렉션 주입</td><td><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello5.java" displayRange="[10]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans9.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello5Test2.java" displayRange="[11]" lan="java">Context</button></td></tr><tr><td>parent 속성을 통한 상속</td><td><p>값 상속 예 : <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello1.java" displayRange="[5]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans11.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello1Test3.java" displayRange="[8]" lan="java">Context</button></p><p>컬렉션 상속(merge="true") 예 : <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello5.java" displayRange="[10]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans31.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello5Test4.java" displayRange="[11]" lan="java">Context</button></p></td></tr><tr><td>parent context를 이용한 상속</td><td><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello18.java" displayRange="[3]" lan="java">Interface</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello18Impl.java" displayRange="[5]" lan="java">Impl</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans29.xml" lan="xml">parent XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans30.xml" lan="xml">child XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello18Test.java" displayRange="[8]" lan="java">Context</button></td></tr><tr><td>lookup-method를 통한 프록시</td><td><ul><span id="pos-516828012" style="padding:0!important;margin:0!important;width:0!important;height:0!important;overflow:hidden!important"></span><li>name : 재정의할 메서드 이름 → private X, void 반환 X, 메서드 매개변수 X, final X</li><li>bean : 재정의한 메서드에서 반환할 객체</li><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans19.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Beans19Test.java" displayRange="[11]" lan="java">Context</button></ul></td></tr><tr><td>replaced-method를 통한 프록시</td><td><ul><li>name : 재정의할 메서드 이름</li><li>replacer : MethodReplacer 구현체</li><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello22.java" displayRange="[5]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello22Replacement.java" displayRange="[10]" lan="java">MethodReplacer</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans36.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello22Test.java" displayRange="[8]" lan="java">Context</button></ul></td></tr><tr><td>Compound property name을 이용한 내부 빈 속성 설정</td><td><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello19.java" displayRange="[5]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans33.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello19Test.java" displayRange="[8]" lan="java">Context</button></td></tr><tr><td><span id="pos-25936411" style="padding:0!important;margin:0!important;width:0!important;height:0!important;overflow:hidden!important"></span>depends-on을 이용한 빈 생성 순서 설정</td><td>has-a 관계보다 약한 의존 관계에서, depends-on을 이용해 특정 빈이 먼저 생성되도록 강제할 수 있다.
 양쪽 빈 모두 싱글톤인 경우, 객체 소멸 순서도 정해진다.<button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello20.java" displayRange="[5]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans34.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello20Test.java" displayRange="[10]" lan="java">Context</button></td></tr><tr><td>lazy-init을 이용한 빈 생성 늦추기</td><td><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello21.java" displayRange="[5]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans35.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello21Test.java" displayRange="[10]" lan="java">Context</button></td></tr></table></ul><div><h4>Autowire</h4><ul><li>IoC 컨테이너가 관리중인 빈들을 자동으로 주입하도록 구성할 수 있다. XML에서는 bean 태그의 autowire 속성으로 제어하며, 아래 4가지 모드가 가능하다</li><table><tr><th>mode</th><th>설명</th></tr><tr><td>no</td><td>기본 설정. 모든 의존성은 명시되어야 한다.</td></tr><tr><td>byName</td><td>이름이 일치하는 빈을 주입한다</td></tr><tr><td>byType</td><td>타입이 일치하는 빈을 주입한다. 일치하는 빈이 2개 이상이면 에러, 0개면 미설정</td></tr><tr><td>constructor</td><td>생성자에 적용되는 byType</td></tr></table><li>명시된 의존성은 항상 autowire보다 우선이며, 자바 기본 타입은 autowire 할 수 없다.</li><li>bean 정의 시 autowire-candidate 속성을 false로 하면, type 매치 주입물이 되지 않는다</li><li>beans 정의 시 default-autowire-candidates를 이용해 autowire 주입물을 제한할 수 있다</li><p><strong>↓ xml</strong></p><div lan="xml" class="as-code code-div w3-leftbar w3-border-green">&lt;beans ... default-autowire-candidates="*Service,*Dao" /></div><li>bean 정의 시 primary 속성을 true로 하면, 최우선 autowire 주입물이 된다</li><li>예시 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello15.java" displayRange="[7]" lan="java">Bean1</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello16.java" displayRange="[7]" lan="java">Bean2</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans12.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello15Test3.java" displayRange="[8]" lan="java">Context</button></li></ul></div><h3>Bean Scope</h3><ul><li>빈의 유효 기간을 설정할 수 있다. 아래 6가지는 빈 설정 시 기본으로 이용할 수 있는 목록이다.</li><table><tr><th>Scope</th><th>설명</th></tr><tr><td>singleton</td><td>기본값. 컨테이너에서 하나의 인스턴스만 생성</td></tr><tr><td>prototype</td><td>빈 요청마다 새 인스턴스 생성. 컨테이너는 prototype 빈의 일부 lifecycle만 관리하며, 생성 이후 lifecycle은 클라이언트가 책임져야 한다</td></tr><tr><td>request</td><td>HTTP 요청마다 새 인스턴스 생성. Web 관련 ApplicationContext에서 지정 가능</td></tr><tr><td>session</td><td>HTTP 세션마다 새 인스턴스 생성. Web 관련 ApplicationContext에서 지정 가능</td></tr><tr><td>application</td><td>ServletContext마다 새 인스턴스 생성. Web 관련 ApplicationContext에서 지정 가능</td></tr><tr><td>websocket</td><td>WebSocket마다 새 인스턴스 생성. Web 관련 ApplicationContext에서 지정 가능</td></tr></table><li>Spring 3.0부터 스레드 단위로 인스턴스를 생성하는 SimpleThreadScope가 추가되었다.</li><p>ConfigurableBeanFactory.registerScope(String, Scope) 또는 CustomScopeConfigurer로 사용 가능</p><span id="pos1923990332" style="padding:0!important;margin:0!important;width:0!important;height:0!important;overflow:hidden!important"></span><li>request, session, application 예</li><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/ioc-example/src/main/java/io/github/donggi/example/entity/PerApp.java" displayRange="[8]" lan="java">Bean per App</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/ioc-example/src/main/java/io/github/donggi/example/entity/PerRequest.java" displayRange="[8]" lan="java">Bean per Request</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/ioc-example/src/main/java/io/github/donggi/example/entity/PerSession.java" displayRange="[8]" lan="java">Bean per Session</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/ioc-example/src/main/java/io/github/donggi/example/controller/ScopeController.java" displayRange="[27,40,42,55]" lan="java">Controller</button><li>기본적으로 빈에 주입된 의존 객체는 컨테이너에 의해 다시 설정되지 않는다.</li><p>만일 스코프가 더 좁은 빈을 의존하지만 참조 시마다 새로운 인스턴스가 필요한 경우, 해당 메서드를 재정의하거나, aop:scoped-proxy를 이용하면 된다.
 AOP proxy 인스턴스는 직렬화 가능하며, 직렬화 전 참조 객체와 역직렬화 후 참조 객체는 동일하다.</p><p>다른 방법으로 ObjectFactory#getObject(), ObjectProvider(→ ObjectFactory)의 getIfAvailable(), getIfUnique()을 이용할 수도 있다</p><p><span template-id="template-jsr330" class="hover-content">JSR-330</span>에서는 Provider가 위와 비슷한 기능을 제공한다.</p><table class="no-sort"><tr><td>아무 설정 없는 예</td><td><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello15.java" displayRange="[7]" lan="java">Bean1</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello16.java" displayRange="[7]" lan="java">Bean2</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans20.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello15Test.java" displayRange="[8]" lan="java">Context</button></td></tr><tr><td>메서드 재정의 예</td><td><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello15.java" displayRange="[7]" lan="java">Bean1</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello16.java" displayRange="[7]" lan="java">Bean2</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans37.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello15Test5.java" displayRange="[8]" lan="java">Context</button></td></tr><tr><td>aop:scoped-proxy 예</td><td><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello15.java" displayRange="[7]" lan="java">Bean1</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello16.java" displayRange="[7]" lan="java">Bean2</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans21.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello15Test4.java" displayRange="[8]" lan="java">Context</button></td></tr><tr><td>Custom Scope 예</td><td><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/ioc-example/src/main/java/io/github/donggi/example/entity/PerMinute.java" displayRange="[8]" lan="java">Bean per Minute</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/ioc-example/src/main/java/io/github/donggi/example/scope/MinuteScope.java" displayRange="[10]" lan="java">Custom Scope</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/ioc-example/src/main/java/io/github/donggi/example/config/MinuteBeanFactoryPostProcessor.java" displayRange="[9]" lan="java">PostBeanProcessor</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/ioc-example/src/main/java/io/github/donggi/example/config/AppConfig.java" displayRange="[7]" lan="java">AppConfig</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/ioc-example/src/main/java/io/github/donggi/example/controller/ScopeController.java" displayRange="[57,70]" lan="java">Controller</button><p>aop:scoped-proxy 설정을 하고 싶다면 @Scope의 proxyMode 변수를 설정</p><ul><li>NO : default. 프록시 없음</li><li>INTERFACES : 인터페이스 프록시 생성. JDK 동적 프록시 이용</li><li>TARGET_CLASS : 클래스 프록시 생성. CGLIB 이용</li></ul></td></tr></table></ul><h3>Bean 커스터마이징</h3><div><h4>Lifecycle Callback</h4><ul><li>InitializingBean, DisposableBean 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello2.java" displayRange="[8]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans2.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello2Test.java" displayRange="[8]" lan="java">Context</button></li><li>Lifecycle 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello29.java" displayRange="[8]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans46.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello29Test.java" displayRange="[8]" lan="java">Context</button></li><li>init-method, destroy-method 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello3.java" displayRange="[5]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans3.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello3Test.java" displayRange="[8]" lan="java">Context</button></li><li>destroy-method로 (inferred)를 설정하면 public close() 또는 shutdown()을 찾아 실행한다 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello23.java" displayRange="[5]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans38.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello23Test.java" displayRange="[8]" lan="java">Context</button></li><li>default-init-method, default-destroy-method 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello24.java" displayRange="[3]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans39.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello24Test.java" displayRange="[8]" lan="java">Context</button></li><li>JSR-250 : @PostConstruct, @PreDestroy 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno21.java" displayRange="[8]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/anno/Anno21Test.java" displayRange="[8]" lan="java">Context</button></li><li>위 설정들은 중복이 가능하며, 서로 다른 메서드들로 설정된 경우 아래 순서대로 실행된다</li><ul><li>@PostConstruct → InitializingBean → init-method</li><li>@PreDestroy → DisposableBean → destroy-method</li></ul><li>ConfigurableApplicationContext#registerShutdownHook 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello4Test.java" displayRange="[9]" lan="java">Context</button></li></ul><h4>Aware</h4><ul><li>ApplicationContextAware 인터페이스를 구현한 경우, 빈 생성 후 어떤 컨텍스트가 만들었는지 알 수 있다. <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello25.java" displayRange="[9]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans40.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello25Test.java" displayRange="[8]" lan="java">Context</button></li><li>BeanNameAware 인터페이스를 구현한 경우, 빈 생성 후 어떤 이름으로 만들었는지 알 수 있다. <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello26.java" displayRange="[6]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans41.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello26Test.java" displayRange="[8]" lan="java">Context</button></li></ul><table><caption><a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green" href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html#aware-list">aware-list</a></caption><tr><th>interface</th><th>주입물</th></tr><tr><td>ApplicationEventPublisherAware</td><td>ApplicationEventPublisher</td></tr><tr><td>BeanClassLoaderAware</td><td>ClassLoader</td></tr><tr><td>BeanFactoryAware</td><td>BeanFactory</td></tr><tr><td>LoadTimeWeaverAware</td><td>LoadTimeWeaver</td></tr><tr><td>MessageSourceAware</td><td>MessageSource</td></tr><tr><td>ResourceLoaderAware</td><td>ResourceLoader</td></tr><tr><td>ServletConfigAware</td><td>ServletConfig</td></tr><tr><td>ServletContextAware</td><td>ServletContext</td></tr></table></div><h3>컨테이너 확장</h3><p>ApplicationContext를 직접 상속하지 않고, 여러 인터페이스 구현체를 등록함으로써 기능 확장이 가능하다.</p><ul><li>BeanPostProcessor <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello27.java" displayRange="[8]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans42.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello27Test.java" displayRange="[8]" lan="java">Context</button></li><p>인스턴스 생성 후, 초기화 콜백 호출 전/후 작업을 추가할 수 있다. 여러 BeanPostProcessor를 등록하는 경우, order 속성(Ordered 인터페이스)으로 실행 순서를 제어할 수 있다.</p><p>ApplicationContext#addBeanPostProcessor를 이용해 직접 등록하는 경우, Ordered 인터페이스를 구현해도 무시하며, 직접 등록된 순서대로 실행된다. 자동으로 탐색된 다른 BeanPostProcessor들보다 항상 먼저 실행된다.</p><li>BeanFactoryPostProcessor</li><p>빈을 생성하기 전에 컨테이너 관련 설정을 변경할 수 있다. 여러 BeanFactoryPostProcessor를 등록하는 경우, order 속성(Ordered 인터페이스)으로 순서를 제어할 수 있다</p><ul><li>PropertySourcesPlaceholderConfigurer 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello1.java" displayRange="[5]" lan="java">Bean1</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello17.java" displayRange="[7]" lan="java">Bean2</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans43.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/beans43-1.properties" lan="properties">properties1</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/beans43-2.properties" lan="properties">properties2</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello17Test5.java" displayRange="[8]" lan="java">Context</button></li><li>PropertyOverrideConfigurer 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello1.java" displayRange="[5]" lan="java">Bean1</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello17.java" displayRange="[7]" lan="java">Bean2</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans44.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/beans43-1.properties" lan="properties">properties1</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/beans43-2.properties" lan="properties">properties2</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/beans44.properties" lan="properties">properties3</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello17Test6.java" displayRange="[8]" lan="java">Context</button></li></ul><li>FactoryBean 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/bean/Hello28.java" displayRange="[6]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/Beans45.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/bean/Hello28Test.java" displayRange="[8]" lan="java">Context</button></li><p>빈 생성 절차를 XML보다 Java로 표현하는 것이 효율적인 경우, FactoryBean을 컨테이너에 등록할 수 있다</p></ul><h3>Annotation 기반 설정</h3><ul><li>XML 기반 설정과 같이 이용하는 경우, Annotation 기반 처리가 먼저 이뤄짐에 유의.</li><li>context:annotation-config <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/anno01.xml" lan="xml">XML</button></li><p>↑ 컨테이너에 등록된 빈에 대하여 애너테이션 처리</p><li>context:component-scan <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/anno02.xml" lan="xml">XML</button></li><p>↑ 기준 패키지의 모든 클래스를 탐색하여 자동으로 빈 등록, DI, 기타 애너테이션 처리</p><li>XML을 아예 사용하지 않고도 구성 가능하다 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno02.java" displayRange="[11]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/anno/Anno02Test2.java" displayRange="[14]" lan="java">Context</button></li><li>@Autowired, @Inject, @Value, @Resource는 BeanPostProcessor 구현체가 처리하므로, 사용자 정의 BeanPostProcessor 또는 BeanFactoryPostProcessor 클래스 안에서 해당 애너테이션들을 적용할 수 없다. 대신 @Bean을 이용해야 한다.</li><li>Since JDK 9 : 스캔 대상 패키지가 module-info에서 exports 됐는지, non-public 메서드를 호출해야 되는 패키지가 opens(exports 말고) 됐는지 확인 필요</li></ul><table><tr><th>Annotation</th><th>대응 코드</th><th>예시 코드</th></tr><tr><td>@Component</td><td>xml: bean</td><td><ul><li>해당 타입이 빈 생성 대상임을 나타낸다</li><li>value로 빈 이름을 설정할 수 있다. ""(default)면 자동 할당</li><li>@Repository : Persistence layer</li><li>@Service : Service layer</li><li>@Controller : Presentation layer</li><li>@Configuration : @Bean 메서드들을 갖는 구성 클래스</li><p>@Configuration 클래스 안에서 형제 @Bean 메서드 호출은 의존 관계의 정의를 의미한다 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno26.java" displayRange="[6]" lan="java">Configuration</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/anno/Anno26Test.java" displayRange="[8]" lan="java">Context</button></p><li>@RestController = @Controller + @ResponseBody</li><li>기타 사용자 정의 애너테이션도 가능</li></ul></td></tr><tr><td>@Bean</td><td>xml: bean</td><td><ul><li>팩터리 메서드에 적용하여 빈 생성 대상임을 나타낸다</li><li>static 메서드에 적용하는 경우 프록시를 통하지 않고 호출된다</li><li>name으로 빈 별명을 설정할 수 있다</li><li>initMethod를 설정할 수 있다 ← 메서드 바디에서 호출하면 되므로 쓸 일은 별로 없을듯</li><li>destroyMethod를 설정할 수 있다</li><p>기본값은 "(inferred)"로, 자동으로 public close() 또는 shutdown()을 찾아 실행한다. 아무것도 호출하고 싶지 않다면 ""로 설정하면 된다.</p><p>JNDI로 가져온 리소스 ─ 특히 DataSource들은 외부에서 생애가 관리되므로 destroyMethod="" 설정함이 바람직하다</p></ul></td></tr><tr><td>@Conditional</td><td></td><td>Condition 인터페이스 구현체를 지정하여, @Component, @Configuration, @Bean 초기화를 진행할 지 여부를 미리 판단한다</td></tr><tr><td><span id="pos1225939273" style="padding:0!important;margin:0!important;width:0!important;height:0!important;overflow:hidden!important"></span>@Profile</td><td>xml: beans profile=""</td><td>@Conditional(value=org.springframework.context.annotation.ProfileCondition.class)<br>→ active profile을 기준으로 초기화 진행 여부를 판단한다<a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos230028222" target="_self">Goto - profile 표현식</a></td></tr><tr><td>@Autowired</td><td>xml: autowire</td><td><ul><li>적용 위치 : CONSTRUCTOR, FIELD, METHOD, PARAMETER</li><li>CONSTRUCTOR 적용 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno03.java" displayRange="[12]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/anno/Anno03Test.java" displayRange="[8]" lan="java">Context</button></li><p>Since 4.3 : 기본 생성자가 없으면서 여러 생성자가 존재하는 경우에만 생성자에 @Autowired 적용 필요</p><li>FIELD 적용 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno01.java" displayRange="[6]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/anno01.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/anno/Anno01Test.java" displayRange="[8]" lan="java">Context</button></li><li>특정 타입 T의 배열(T[])/컬렉션(Collection&lt;T>)/맵(Map&lt;String, T>에 적용한 경우, 해당 타입의 모든 빈을 목록으로 설정해준다.</li><p>타깃 타입이 org.springframework.core.Ordered를 구현했거나, @Order, @Priority를 갖고 있으면 정렬하여 설정해준다</p><ul><li>Array FIELD 적용 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno02.java" displayRange="[11]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/anno/Anno02Test.java" displayRange="[10]" lan="java">Context</button></li><li>Set FIELD 적용 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno05.java" displayRange="[14]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/anno/Anno05Test.java" displayRange="[10]" lan="java">Context</button></li><li>Map FIELD 적용 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno06.java" displayRange="[13]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/anno/Anno06Test.java" displayRange="[8]" lan="java">Context</button></li></ul><li>required = false</li><ul><li>FIELD, METHOD에 required = false 적용 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno07.java" displayRange="[14]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/anno/Anno07Test.java" displayRange="[8]" lan="java">Context</button></li><p>의존 객체가 하나라도 누락되면 호출을 생략한다. → 따라서 기본값 그대로 남는다.</p><li>팩터리 메서드, CONSTRUCTOR에 required = false 적용</li><p>배열, Collection, Map인자로 매칭되는 빈이 없는 경우, empty 인스턴스를 넘겨 호출한다.</p><li>↑ 이는 @Autowired가 없는 단일 생성자를 갖는 일반 클래스에도 적용된다 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno08.java" displayRange="[9]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/anno/Anno08Test.java" displayRange="[10]" lan="java">Context</button></li></ul><li>METHOD 적용 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno04.java" displayRange="[12]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/anno/Anno04Test.java" displayRange="[8]" lan="java">Context</button></li><li>인자가 있든 없든 호출되길 원한다면 Optional 또는 @Nullable(Since 5.0)을 이용하면 된다 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno09.java" displayRange="[11]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/anno/Anno09Test.java" displayRange="[8]" lan="java">Context</button></li><li>아래의 인터페이스 및 연관 구현 클래스에 대한 @Autowired 필드는 실행 환경에 따라 적절히 주입된다.</li><p>BeanFactory, ApplicationContext, Environment, ResourceLoader, ApplicationEventPublisher, MessageSource</p></ul></td></tr><tr><td>@Primary</td><td>xml: primary="true"</td><td>특정 빈을 우선적으로 주입하도록 설정한다 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno10.java" displayRange="[14]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/anno/Anno10Test.java" displayRange="[8]" lan="java">Context</button></td></tr><tr><td>@Qualifier</td><td>xml: qualifier value="xxx"<br>xml: qualifier type="x.y.Z" value="xxx"</td><td><ul><li>빈을 구별할 수 있는 값을 설정한다. 빈 이름은 default qualifier로 이용됨에 유의. <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno11.java" displayRange="[13]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/anno/Anno11Test.java" displayRange="[8]" lan="java">Context</button></li><li>Qualifier는 고유할 필요가 없으며, 배열/컬렉션/맵 주입 시 qualifier가 일치하는 모든 빈들이 멤버로 할당된다</li><li>@Autowired와 같이 사용하는 경우, 타입 기반 매칭이 먼저 수행됨에 유의. Qualifier 매칭만 수행하려는 경우 JSR-250의 @Resource를 이용할 것.</li><li>사용자 정의 @Qualifier를 이용할 수 있다 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno12.java" displayRange="[19]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/anno/Anno12Test.java" displayRange="[8]" lan="java">Context</button></li><li>사용자 정의 @Qualifier는 값 없이도 빈 특정이 가능할 수 있다 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno13.java" displayRange="[17]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/anno/Anno13Test.java" displayRange="[8]" lan="java">Context</button></li><li>사용자 정의 @Qualifier는 다른 타입 속성들을 가질 수 있다 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno14.java" displayRange="[17]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/anno/Anno14Test.java" displayRange="[8]" lan="java">Context</button></li><li>Generic도 일종의 타입 Qualifier로 이용할 수 있다<button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno15.java" displayRange="[11]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/anno/Anno15Test.java" displayRange="[8]" lan="java">Context</button></li></ul></td></tr><tr><td>@Resource</td><td>xml: ref="beanName"</td><td><ul><li>빈 이름을 기준으로 주입한다 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno16.java" displayRange="[12]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/anno/Anno16Test.java" displayRange="[8]" lan="java">Context</button></li><li>name 속성을 지정하지 않으면 field 또는 parameter 이름을 기준으로 찾는다</li><li>이름을 기준으로 찾지 못하면 타입을 기준으로 다시 찾는다 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno17.java" displayRange="[12]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/anno/Anno17Test.java" displayRange="[8]" lan="java">Context</button></li></ul></td></tr><tr><td>@Value</td><td>xml: context:property-placeholder<span id="pos114384251" style="padding:0!important;margin:0!important;width:0!important;height:0!important;overflow:hidden!important"></span></td><td><ul><li>외부 *.properties 파일 기반으로 값 주입 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno18.java" displayRange="[10]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/anno18.properties" lan="properties">properties</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/anno/Anno18Test.java" displayRange="[8]" lan="java">Context</button></li><li>@Bean static 메서드로 PropertySourcesPlaceholderConfigurer 인스턴스를 반환하면 커스터마이징 가능하다</li><li>Spring Boot 애플리케이션은 기본적으로 application.properties, application.yml 파일을 읽는 PropertySourcesPlaceholderConfigurer 빈을 갖는다</li><li>프로퍼티 문자열 → Java Type으로의 변환</li><p>BeanPostProcessor는 ConversionService를 이용해 타입 변환을 수행한다. 커스텀 컨버터를 등록하면 사용자 정의 타입으로의 변환도 가능하다 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno19.java" displayRange="[14]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/anno19.properties" lan="properties">properties</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/anno/Anno19Test.java" displayRange="[8]" lan="java">Context</button></p><li>SpEL 표현식도 가능하다 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno20.java" displayRange="[10]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/anno/Anno20Test.java" displayRange="[8]" lan="java">Context</button></li></ul></td></tr><tr><td>@PostConstruct</td><td>xml: init-method</td><td>빈 생성 후 호출 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno21.java" displayRange="[8]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/anno/Anno21Test.java" displayRange="[8]" lan="java">Context</button></td></tr><tr><td>@PreDestroy</td><td>xml: destroy-method</td><td>빈 소멸 시 호출<button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno21.java" displayRange="[8]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/anno/Anno21Test.java" displayRange="[8]" lan="java">Context</button></td></tr><tr><td>@ComponentScan</td><td>xml: context:component-scan base-package=""</td><td><ul><li>스캔 범위를 확장한다 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno22.java" displayRange="[6]" lan="java">Configuration</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/rare/Rare1.java" displayRange="[5]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/anno/Anno22Test.java" displayRange="[9]" lan="java">Context</button></li><li>includeFilters == xml: context:include-filter </li><p>↑ 명시적으로 매칭되는 클래스만 스캔</p><li>excludeFilters == xml: context:exclude-filter</li><p>↑ 매칭되는 클래스는 스캔 제외</p><li>useDefaultFilters=false == xml: use-default-filters="false"</li><p>↑ @Component, @Repository, @Service 등을 자동으로 찾지 않는다.</p><li>필터 종류</li><ul><li>annotation(default) : 타입에 특정 애너테이션이 붙어있는지? <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno23.java" displayRange="[11]" lan="java">Configuration</button></li><li>assignable : 특정 타입으로 할당 가능한지? <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno23.java" displayRange="[11]" lan="java">Configuration</button></li><li>aspectj : 클래스 경로가 AspectJ 표현식에 일치하는지? <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno24.java" displayRange="[8]" lan="java">Configuration</button></li><p><strong>↓ AspectJ 관련 jar들을 포함해야 한다. Spring Boot 예</strong></p><div lan="gradle" class="as-code code-div w3-leftbar w3-border-green">implementation 'org.springframework.boot:spring-boot-starter-aop'</div><li>regex : 클래스 경로가 정규표현식에 일치하는지? <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno24.java" displayRange="[8]" lan="java">Configuration</button></li><li>custom : TypeFilter 구현 클래스 지정 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno25.java" displayRange="[8]" lan="java">Configuration</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/scan/ScanFilter.java" displayRange="[9]" lan="java">TypeFilter</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/anno/Anno25Test.java" displayRange="[8]" lan="java">Context</button></li></ul><li>nameGenerator == xml: name-generator</li><p>스프링 기본 네이밍이 맞지 않는 경우 BeanNameGenerator 구현체를 직접 제공해도 된다. 특히 같은 이름의 클래스가 여러 패키지에 존재하는 경우, 클래스 풀네임을 이름으로 제공하는 FullyQualifiedAnnotationBeanNameGenerator(Since 5.2.3)도 고려해봄직하다.</p><li>scopeResolver == xml: scope-resolver</li><p>애너테이션 기반 스코핑이 불충분하다면, 직접 ScopeMetadataResolver 구현체를 제공할 수 있다.</p><li>scopedProxy == xml: scoped-proxy</li><p>singleton 외 스코프 빈에 대한 기본 프록시 설정 가능.</p><ul><li>NO : default. 프록시 없음</li><li>INTERFACES : 인터페이스 프록시 생성. JDK 동적 프록시 이용</li><li>TARGET_CLASS : 클래스 프록시 생성. CGLIB 이용</li></ul></ul></td></tr><tr><td>@Inject</td><td>@Autowired</td><td><span template-id="template-jsr330" class="hover-content">JSR-330</span><ul><li>@Autowire와 마찬가지로 필드, 메서드, 생성자에 적용 가능 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/jsr330/Anno01.java" displayRange="[9]" lan="java">Configuration</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/jsr330/Anno01Test.java" displayRange="[8]" lan="java">Context</button></li><li>@Named로 이름 지정 가능 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/jsr330/Anno02.java" displayRange="[10]" lan="java">Configuration</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/jsr330/Anno02Test.java" displayRange="[8]" lan="java">Context</button></li><p>@Named는 주입/생성 빈 이름 모두에 사용할 수 있다</p><li>Provider를 이용하여 지연된 접근, 짧은 scope 빈 접근 가능 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/jsr330/Anno03.java" displayRange="[12]" lan="java">Configuration</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/jsr330/Anno03Test.java" displayRange="[10]" lan="java">Context</button></li><li>Optional 또는 @Nullable도 사용 가능 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/jsr330/Anno04.java" displayRange="[13]" lan="java">Configuration</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/jsr330/Anno04Test.java" displayRange="[8]" lan="java">Context</button></li></ul></td></tr><tr><td>@Named, @ManagedBean</td><td>@Component</td><td> <span template-id="template-jsr330" class="hover-content">JSR-330.</span> 타입에 적용하는 경우 자동 생성 대상임을 나타낸다. 속성으로 이름을 지정하지 않는 경우 자동으로 할당된다.</td></tr><tr><td>@Singleton</td><td>@Scope("singleton")</td><td> <span template-id="template-jsr330" class="hover-content">JSR-330</span>의 기본 scope는 prototype이지만, 스프링 컨테이너는 singleton으로 처리한다. 따라서 이 애너테이션은 사용자 정의 스코프 정의에만 이용하면 된다.</td></tr><tr><td>@Qualifier, @Named</td><td>@Qualifier</td><td> <span template-id="template-jsr330" class="hover-content">JSR-330.</span> javax.inject.Qualifier는 사용자 정의 Qualifier를 위해 존재하며, @Named는 String qualifier 구현체로 이용할 수 있다.</td></tr><tr><td>@Import, @ImportResource</td><td>xml: import</td><td><ul><li>@Import : @Configuration에서 다른 @Configuration 임포트 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno27.java" displayRange="[7]" lan="java">Configuration</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/anno/Anno27Test.java" displayRange="[8]" lan="java">Context</button></li><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">@Configuration
@Import({OtherConfiguration.class})
public class MyConfiguration {}</div><li>@ImportResource : @Configuration 다른 xml 임포트 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno28.java" displayRange="[7]" lan="java">Configuration</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/resource/anno28.xml" lan="xml">XML</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/anno/Anno28Test.java" displayRange="[8]" lan="java">Context</button></li><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">@Configuration
@ImportResource("file:src/main/resource/otherConfig.xml")
public class MyConfiguration {}

@Configuration
@ImportResource("classpath:/otherConfig.xml")
public class MyConfiguration {}</div><li>xml에서 @Configuration 임포트는 context:component-scan, context:component-scan 또는 그냥 bean 이용</li></ul></td></tr><tr><td>@DependsOn</td><td>xml: depends-on</td><td><a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos-25936411" target="_self">Goto - depends-on</a></td></tr><tr><td>@lookup</td><td>xml: lookup-method</td><td><a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos-516828012" target="_self">Goto - lookup-method</a></td></tr><tr><td>@RequestScope</td><td>xml: scope="request"</td><td><a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos1923990332" target="_self">Goto - scope 예</a></td></tr><tr><td>@SessionScope</td><td>xml: scope="session"</td><td><a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos1923990332" target="_self">Goto - scope 예</a></td></tr><tr><td>@ApplicationScope</td><td>xml: scope="application"</td><td><a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos1923990332" target="_self">Goto - scope 예</a></td></tr><tr><td>@Description</td><td>xml: description</td><td>빈에 대한 설명(Optional)</td></tr><tr><td>@EnableLoadTimeWeaving</td><td>xml: context:load-time-weaver</td><td>LoadTimeWeaverAware를 구현한 빈은 LoadTimeWeaver 인스턴스를 인자로 받는다<a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos-941319825" target="_self">Goto - Spring AOP</a></td></tr></table><h3>Environment</h3><ul><li>Environment 인터페이스는 profile, properties 정보를 컨테이너에 제공한다</li><span id="pos230028222" style="padding:0!important;margin:0!important;width:0!important;height:0!important;overflow:hidden!important"></span><li>Profile 표현에 !(not), &amp;(and), |(or) 가능. <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos1225939273" target="_self">Goto - @Profile</a></li><p>예. production &amp; (us-east | eu-central)<br>xml 표현식에서 !는 가능하지만 &amp;, |는 포함할 수 없다. 대신 beans profiles=""를 중첩하여 &amp; 효과를 얻을 수는 있다</p><li>Profile 활성화</li><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">context.getEnvironment().setDefaultProfiles("profile1", "profile2")
context.getEnvironment().setActiveProfiles("profile1", "profile2")</div><p><strong>↓ shell</strong></p><div lan="shell" class="as-code code-div w3-leftbar w3-border-green">$ env "spring.profiles.active=profile1,profile2"</div><p><strong>↓ shell</strong></p><div lan="shell" class="as-code code-div w3-leftbar w3-border-green">$ java ... -Dspring.profiles.active="profile1,profile2"</div><li>제공할 수 있는 properties 타입</li><p>properties 파일, JNDI, Servlet context parameter, Properties 인스턴스, Map 인스턴스</p><li>StandardEnvironment(→ AbstractEnvironment) 기본으로 포함되는 properties 항목들</li><p>JVM system properties (System.getProperties()) + 환경 변수 (System.getenv()). 시스템 속성이 환경 변수보다 우선 검색된다</p><li>StandardServletEnvironment(→ StandardEnvironment) 추가 제공 properties</li><p>Servlet config + Servlet context parameter + JndiPropertySource(Optional).<br>우선 순위 : ServletConfig ← ServletContext parameter ← JNDI ← JVM system properties ← 환경 변수</p><li>PropertySource 추가</li><p><strong>↓ 수동 추가</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">var sources = context.getEnvironment().getPropertySources();
sources.addFirst(new PropertySource(...));
sources.addLast(new PropertySource(...));
// ResourcePropertySource, PropertiesPropertySource 등 이용</div><p><strong>↓ 자동 추가</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">@Configuration
@PropertySource("classpath:io/github/donggi/${spring.profiles.active:localhost}.properties")
@PropertySource(value="classpath:io/github/donggi/more/${spring.profiles.active:localhost}.properties", ignoreResourceNotFound=true)
public class AppConfig {}
</div></ul><h3>ApplicationContext 추가 기능</h3><div><h4>국제화; ApplicationContext → MessageSource</h4><ul><li>HierarchicalMessageSource 인터페이스는 부모의 것을 상속한다</li><li>문자열 획득</li><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">String getMessage(String code, Object[] args[, String default], Locale loc)
String getMessage(MessageSourceResolvable resolvable, Locale locale)</div><li>MessageSource 탐색</li><ol><li>ApplicationContext는 자동으로 "messageSource" 이름의 MessageSource 빈을 찾는다</li><li>없는 경우 부모 컨텍스트에서 해당하는 빈을 찾는다</li><li>없는 경우 DelegatingMessageSource 인스턴스로 설정</li></ol><li>MessageSource 구현 클래스</li><ul><li>StaticMessageSource : 코드로 등록</li><li>ResourceBundleMessageSource : 리소스 파일 로드</li><li>ReloadableResourceBundleMessageSource : 주기적으로 리소스 파일 변경 확인(classpath: 리소스 제외)</li></ul><li>*.properties 네이밍 규칙</li><ul><li>Locale ENGLISH = createConstant("en", ""); → xxx_en.properties</li><li>Locale US = createConstant("en", "US"); → xxx_en_US.properties</li></ul><li>예시 코드 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/ioc-example/src/main/java/io/github/donggi/example/config/I18nConfig.java" displayRange="[8]" lan="java">Configuration</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/ioc-example/src/main/resources/i18n/templates_en.properties" lan="properties">templates_en.properties</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/ioc-example/src/main/resources/i18n/templates_ko.properties" lan="properties">templates_ko.properties</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/ioc-example/src/test/java/io/github/donggi/example/config/I18nTests.java" displayRange="[11]" lan="java">Test</button></li></ul><h4>이벤트 Pub/Sub</h4><ul><li>이벤트 정의 : ApplicationEvent</li><li>이벤트 리스너 : ApplicationListener 또는 @EventListener(Since 4.2)</li><li>내장 이벤트</li><table><tr><th>Event</th><th>요약</th></tr><tr><td>ContextRefreshedEvent</td><td>ApplicationContext 초기화 또는 갱신(refresh) 완료</td></tr><tr><td>ContextStartedEvent</td><td>ConfigurableApplicationContext#start()</td></tr><tr><td>ContextStoppedEvent</td><td>ConfigurableApplicationContext#stop()</td></tr><tr><td>ContextClosedEvent</td><td>ConfigurableApplicationContext#close() 또는 JVM 종료</td></tr><tr><td>RequestHandledEvent</td><td>HTTP 요청 처리 완료</td></tr><tr><td>ServletRequestHandledEvent</td><td>RequestHandledEvent + 서블릿 정보</td></tr></table><li>예시 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/ioc-example/src/main/java/io/github/donggi/example/event/MyEvent1.java" displayRange="[7]" lan="java">Event</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/ioc-example/src/main/java/io/github/donggi/example/event/MyEvent1Publisher.java" displayRange="[7]" lan="java">Publisher</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/ioc-example/src/main/java/io/github/donggi/example/event/MyEvent1Listener1.java" displayRange="[8]" lan="java">Listener</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/ioc-example/src/test/java/io/github/donggi/example/event/Event1Tests.java" displayRange="[8]" lan="java">Test</button></li><li>@EventListener 예시 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/ioc-example/src/main/java/io/github/donggi/example/event/MyEvent2.java" displayRange="[7]" lan="java">Event</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/ioc-example/src/main/java/io/github/donggi/example/event/MyEvent2Publisher.java" displayRange="[7]" lan="java">Publisher</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/ioc-example/src/main/java/io/github/donggi/example/event/MyEvent2Listener1.java" displayRange="[8]" lan="java">Listener1</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/ioc-example/src/main/java/io/github/donggi/example/event/MyEvent2Listener2.java" displayRange="[8]" lan="java">Listener2</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/ioc-example/src/test/java/io/github/donggi/example/event/Event2Tests.java" displayRange="[8]" lan="java">Test</button></li><li>이벤트 핸들러가 다른 이벤트를 반환하는 경우, 해당 이벤트가 발행된다. 이벤트에 대한 컬렉션을 반환하면, 각각이 모두 발행된다</li><p>단, @Async 메서드는 수동으로 발행해야 한다.</p><li>@Order로 리스너 호출 순서를 제어할 수 있다</li><li>@EventListener > condition에 사용 가능한 SpEL 이벤트 메타데이터</li><table><tr><th>code</th><th>description</th></tr><tr><td>#root.event, event</td><td>ApplicationEvent 인스턴스</td></tr><tr><td>#root.args, args</td><td>메서드 파라미터 배열</td></tr><tr><td>#name, #a0, #p0</td><td>이름 또는 인덱스로 지정한 메서드 파라미터</td></tr></table></ul><h4>ApplicationContext → ResourceLoader</h4><ul><li>Resource ::= java.net.URL을 포함한 클래스 패스 또는 파일 시스템 상의 리소스</li><li>ApplicationContext는 그 자체로 ResourceLoader며, 저수준 Resource 획득을 쉽게 해준다</li><li>ResourceLoaderAware를 구현한 빈들은 초기화 시 ApplicationContext를 ResourceLoader로 전달받는다</li><li>ClassPathXmlAPplicationContext에 간단한 경로로 리소스를 질의하는 경우, 클래스 패스 상의 리소스를 찾는다.</li><p>애매한 경우, 명시적으로 classpath:, file: 등 URL을 지정해야 한다.</p></ul></div></div><h2>Resources</h2><div><h3>interface Resource extends InputStreamSource</h3><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">boolean             exists()            // 리소스의 실재 여부는 이 메서드로 확인해야 한다
boolean             isReadable()
boolean             isOpen()            // InputStream이 이미 열렸는지 여부.
                                        // true면 InputStream을 한 번만 읽고 닫아야 한다
boolean             isFile()

URL                 getURL()
URI                 getURI()
File                getFile()
    long            contentLength()
    long            lastModified()
    String          getFilename()
    String          getDescription()

InputStream         getInputStream()    // from InputStreamSource
                                        // 매 호출마다 새로운 InputStream을 반환한다고 가정해도 된다
ReadableByteChannel readableChannel()   // Channels.newChannel(getInputStream())

Resource            createRelative(String relativePath)</div><h3>내장 Resource 구현클래스</h3><ul><li>UrlResource</li><p>classpath:, file:, http:, ftp: 등 일반적인 스킴 모두 지원</p><li>ClassPathResource</li><p>클래스패스 상의 리소스</p><li>FileSystemResource</li><p>파일 시스템 상의 리소스</p><li>ServletContextResource</li><p>웹앱 루트 디렉터리를 기준으로 한 상대 경로 상의 리소스</p><li>InputStreamResource</li><p>지정 IputStream으로부터 Resource 생성. isOpen()이 true를 반환한다. 다른 구현체를 이용할 수 있다면 그쪽을 사용하는 편이 좋다</p><li>ByteArrayResource</li><p>주어진 byte 배열로부터 Resource 생성. 여러번 읽기 가능.</p></ul><h3>interface ResourceLoader</h3><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">static String       CLASSPATH_URL_PREFIX    // "classpath:"

ClassLoader         getClassLoader()
Resource            getResource(String location)
    // 스킴을 지정하지 않은 경우, 각 ApplicationContext 구현체는 서로 다른 Resource를 찾아 반환한다
    // 예. ClassPathXmlApplicationContext -> ClassPathResource
    // 예. FileSystemXmlApplicationContext  -> FileSystemResource
    // 예. WebApplicationContext -> ServletContextResource</div><h3>Resource 주입</h3><ul><li>XML 기반 설정에서, Resource 타입 property의 value로 URL 문자열이 가능하다</li><li>일반적으로 ApplicationContext 생성자 자체도 URL 문자열 (배열)로 초기화 가능하다</li><li>ClassPathXmlApplicationContext 생성자에 클래스와 파일명 배열을 같이 보내면, 자동으로 클래스 위치에서 파일을 찾는다</li><li>ApplicationContext 생성자 및 PathMatcher 유틸리티 클래스는 와일드카드를 사용할 수 있다</li><ul><li>"file:C:/some/path/*-context.xml", "classpath*:com/mycompany/**/applicationContext.xml"</li><li>XML관련 ApplicationContext는 "classpath*:" 접두를 사용할 수 있다. 의미는 모든 클래스패스 리소스 검색</li><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">new ClassPathXmlApplicationContext("classpath*:conf/appContext.xml");</div><p>내부적으로 ClassLoader.getResources()를 이용한다. jar 파일에서 리소스를 로드하는 경우, getClass().getClassLoader().getResources()를 직접 호출했을 때와 비교하여 차이가 있으면 서버 설정을 조정하거나 해야 한다.</p><li>"jar:" 리소스들은 java.net.JarURLConnection을 필요로 하기 때문에, 일부 환경에서 실패할 수 있음에 유의</li></ul><li>이전 버전과의 호환성을 위해, FileSystemApplicationContext 자체가 ResourceLoader 역할을 하는 경우, 절대 경로도 상대 경로로 해석함에 유의.</li><p>절대 경로로 리소스를 지정하려면 "file:///path/file.ext" 처럼 "file:" 접두를 사용해 UrlResource로 가져오도록 해야 한다.</p></ul></div><h2>데이터 검증, 바인딩, 타입 변환</h2><div><h3>Validator를 이용한 검증</h3><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">boolean supports(Class&lt;?&gt; clazz)
    // 전형적으로 MyTargetClass.class.isAssignableFrom(clazz)
void validate(Object target, Errors errors)
    // Errors.reject*()를 이용해 오류 정보 전달
    // Errors의 각 거부 항목들은 이름-에러코드 쌍으로 구성된다. 예. ("x", "is.null")
    // DefaultMessageCodesResolver는 에러 정보를 토대로 새 에러코드도 등록한다.
    //      예. ("x", "is.null") → is.null.x, is.null.float, is.null
    //      이를 이용해 MessageSource로부터 보다 적절한 메시지를 가져올 수 있다
    // ValidationUtils를 이용하면 구현에 도움이 된다</div><p>예시 코드 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno29.java" displayRange="[19]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/anno29_ko.properties" lan="properties">message</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/anno/Anno29Test.java" displayRange="[8]" lan="java">Context</button></p><h3>애너테이션 기반 검증</h3><ul><li><a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green" href="https://beanvalidation.org/">Java Bean Validation API</a>예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/spring-core/src/main/java/io/github/donggi/bean/Test2Bean.java" displayRange="[9]" lan="java">Bean1</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/spring-core/src/main/java/io/github/donggi/bean/Test2Bean2.java" displayRange="[10]" lan="java">Bean2</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/spring-core/src/main/java/io/github/donggi/bean/Test2Bean3.java" displayRange="[8]" lan="java">Bean3</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/spring-core/src/main/java/io/github/donggi/anno/Test2Constraint.java" displayRange="[14]" lan="java">Test2Constraint</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/spring-core/src/main/java/io/github/donggi/config/Test2Config.java" displayRange="[14]" lan="java">Config</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/spring-core/src/test/java/io/github/donggi/Test2.java" displayRange="[17]" lan="java">Test</button></li></ul><h3>BeanWrapper의 프로퍼티 주입</h3><ul><li>BeanWrapper는 단일/벌크 프로퍼티 설정을 위한 연산을 정의하며, BeanWrapperImpl은 가장 기본적으로 사용되는 구현 클래스다</li><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">var person = new BeanWrapperImpl(new Person());
person.setPropertyValue("name", "my name");
var realPerson = person.getWrappedInstance();</div><li>프로퍼티 경로는 구분자를 이용한 무제한 확장이 가능하다</li><table class="no-sort"><tr><td>prop</td><td>prop 이름의 필드를 가리킨다. 접근 메서드는 getProp() or isProp(), setProp()</td></tr><tr><td>prop1.prop2</td><td>prop1 필드의 prop2 필드. 접근 메서드는 getProp1().getProp2() or getProp1().isProp2(), getProp1().setProp2()</td></tr><tr><td>prop[2]</td><td>prop 이름의 배열, List, 기타 ordered collection</td></tr><tr><td>prop[key]</td><td>prop 이름의 Map</td></tr></table></ul><h3>PropertyEditor의 Object ↔ String 변환</h3><ul><li>Something 클래스와 같은 패키지에 PropertyEditor를 구현한 SomethingEditor가 존재하면 자동으로 사용된다</li><p>예시 코드 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno30.java" displayRange="[8]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/main/java/io/github/donggi/anno/Anno30DataEditor.java" displayRange="[5]" lan="java">Editor</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/app2/src/test/java/io/github/donggi/anno/Anno30Test.java" displayRange="[8]" lan="java">Context</button></p><li>내장 PropertyEditor 구현체</li><table><tr><th>Class</th><th>설명</th></tr><tr><td>ByteArrayPropertyEditor</td><td>String → byte[]. BeanWrapperImpl 기본 등록</td></tr><tr><td>ClassEditor</td><td>String(클래스 경로) ↔ Class. BeanWrapperImpl 기본 등록</td></tr><tr><td>FileEditor</td><td>String(파일 경로) → File. BeanWrapperImpl 기본 등록</td></tr><tr><td>InputStreamEditor</td><td>String(리소스 경로) → InputStream. BeanWrapperImpl 기본 등록; InputStream을 알아서 닫아주지는 않는다</td></tr><tr><td>LocaleEditor</td><td>String ↔ Locale. BeanWrapperImpl 기본 등록</td></tr><tr><td>PropertiesEditor</td><td>String → Properties. BeanWrapperImpl 기본 등록</td></tr><tr><td>URLEditor</td><td>String → URL. BeanWrapperImpl 기본 등록</td></tr><tr><td>CustomBooleanEditor</td><td>String ↔ Boolean. BeanWrapperImpl 기본 등록 &amp; 덮어쓰기 가능</td></tr><tr><td>CustomNumberEditor</td><td>String ↔ Number. BeanWrapperImpl 기본 등록 &amp; 덮어쓰기 가능</td></tr><tr><td>CustomCollectionEditor</td><td>source Collection → target Collection</td></tr><tr><td>CustomDateEditor</td><td>String ↔ Date. 커스텀 DateFormat 사용 가능.</td></tr><tr><td>PatternEditor</td><td>String ↔ Pattern</td></tr><tr><td>StringTrimmerEditor</td><td>String → Trimmed string. (Option) &quot;&quot; → null</td></tr></table><li>사용자 정의 PropertyEditor를 BeanWrapper 또는 IoC container에 등록하여 사용할 수 있다</li><p><strong>↓ SomethingEditor.java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">public class SomethingEditor extends PropertyEditorSupport {
    public void setAsText(String text) {
        setValue(new Something(text));
    }
}</div><ul><li>CustomEditorConfigurer 이용 : 중첩 프로퍼티 설정도 해준다</li><p><strong>↓ config.xml</strong></p><div lan="xml" class="as-code code-div w3-leftbar w3-border-green">&lt;bean class="org.springframework.beans.factory.config.CustomEditorConfigurer">
    &lt;property name="customEditors">
        &lt;map>
            &lt;entry key="package.Something" value="package.SomethingEditor"/>
        &lt;/map>
    &lt;/property>
&lt;/bean></div><p><strong>↓ Config.java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">@Bean
public CustomEditorConfigurer customEditorConfigurer() {
    var c = new CustomEditorConfigurer();
    var map = new HashMap&lt;Class&lt;?>, Class&lt;? extends PropertyEditor>>();
    map.put(Something.class, SomethingEditor.class);
    c.setCustomEditors(map);
    return c;
}</div><li>PropertyEditorRegistrar 이용 : 사용 시마다 새 PropertyEditor 인스턴스를 만들기 때문에 동기화 걱정 없음</li><p><strong>↓ CustomPropertyEditorRegistrar.java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">public class CustomPropertyEditorRegistrar implements PropertyEditorRegistrar {
    public void registerCustomEditors(PropertyEditorRegistry registry) {
        registry.registerCustomEditor(Something.class, new SomethingEditor());
    }
}</div><p><strong>↓ Config.java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">@Bean
public PropertyEditorRegistrar customPropertyEditorRegistrar() {
    return new CustomPropertyEditorRegistrar();
}
@Bean
public CustomEditorConfigurer customEditorConfigurer() {
    var c = new CustomEditorConfigurer();
    c.setPropertyEditorRegistrars(new PropertyEditorRegistrar[] { customPropertyEditorRegistrar() });
    return c;
}</div><li>ConfigurableBeanFactory.registerCustomEditor()</li></ul></ul><h3>타입 변환</h3><ul><li>core.convert 서브 패키지는 타입 변환 시스템을 제공한다. PropertyEditor 대신 이용해도 좋다</li><p><strong>↓ interface Converter&lt;S, T&gt;</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">T convert(S source);</div><ul><li>source는 non-null임이 보장된다</li><li>실패한 경우 IllegalArgumentException을 던지면 된다</li><li>convert 메서드는 스레드-안전해야 한다.</li><li>core.convert.support 서브 패키지에서 여러 범용 컨버터를 제공한다.</li></ul><li>동일 소스로부터 여러 타입으로의 변환이 필요한 경우 ConverterFactory를 이용하면 좋다</li><p><strong>↓ interface ConverterFactory&lt;S, R&gt;</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">&lt;T extends R&gt; Converter&lt;S, T&gt; getConverter(Class&lt;T&gt; targetType);</div><li>n:m 변환을 한번에 지원하려면 GenericConverter가 유용할 수 있다</li><p><strong>↓ interface GenericConverter</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">Set&lt;ConvertiblePair&gt; getConvertibleTypes();
Object convert(Object source, TypeDescriptor sourceType, TypeDescriptor targetType);</div><p><strong>↓ TypeDescriptor 헬퍼 메서드</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">List&lt;Integer&gt; list;
conversionService.convert(list,
        TypeDescriptor.forObject(input),                                                // List&lt;Integer>
        TypeDescriptor.collection(List.class, TypeDescriptor.valueOf(String.class)))    // List&lt;String></div><li>ConditionalGenericConverter : 특정 조건을 만족할 때만 변환</li><p><strong>↓ interface ConditionalConverter</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">boolean matched(TypeDescriptor sourceType, TypeDescriptor targetType);</div><li>각 컨버터는 ConversionService 뒤에서 실행된다</li><p><strong>↓ interface ConversionService</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">boolean canConvert(Class&lt;?> sourceType, Class&lt;?> targetType);
&lt;T> T convert(Object source, Class&lt;T> targetType);
boolean canConvert(TypeDescriptor sourceType, TypeDescriptor targetType);
Object convert(Object source, TypeDescriptor sourceType, TypeDescriptor targetType);</div><ul><li>대부분의 ConversionService 구현 클래스들은 ConverterRegistry 역시 구현하며, 이를 통해 컨버터를 등록할 수 있다</li><li>core.convert.support 서브 패키지에서 일반적인 GenericConversionService 클래스를 제공한다</li><li>core.convert.support 서브 패키지에서 ConversionService 생성을 위한 ConversionServiceFactory 클래스를 제공한다</li><li>IoC 컨테이너에 설정된 ConversionService는 관리되는 임의 빈에서 직접 사용할 수 있다.</li></ul><p><strong>↓ 기본 ConversionService 등록</strong></p><div lan="xml" class="as-code code-div w3-leftbar w3-border-green">&lt;bean class="org.springframework.context.support.ConversionServiceFactoryBean"/></div><p><strong>↓ 기본 + 사용자 컨버터 추가</strong></p><div lan="xml" class="as-code code-div w3-leftbar w3-border-green">&lt;bean class="org.springframework.context.support.ConversionServiceFactoryBean">
    &lt;property name="converters">
        &lt;set>
            &lt;bean class="example.MyCustomConverter"/>
        &lt;/set>
    &lt;/property>
&lt;/bean></div></ul><h3>Field Formatting</h3><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">interface Formatter&lt;T&gt; extends Printer&lt;T&gt;, Parser&lt;T&gt; {}
interface Printer&lt;T&gt; {
    String print(T fieldValue, Locale locale);
}
interface Parser&lt;T&gt; {
    T parse(String clientValue, Locale locale) throws ParseException;
}</div><ul><li>Formatter는 스레드-안전해야 한다</li><li>format 서브 패키지에서 여러 Formatter 구현체를 제공한다</li><p>NumberStyleFormatter, PercentStyleFormatter, DateFormatter, ...</p><li>FormatterRegistry, FormatterRegistrar : 포매터 등록을 위한 인터페이스</li><a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green" href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/web.html#mvc-config-conversion">mvc-config-conversion</a><li>Annotation-driven Formatting</li><p>AnnotationFormatterFactory를 이용한다. 예시 코드 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/spring-core/src/main/java/io/github/donggi/bean/Test1Bean.java" displayRange="[10]" lan="java">Bean</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/spring-core/src/main/java/io/github/donggi/anno/Test1FormatAnnotationFormatterFactory.java" displayRange="[16]" lan="java">FormatterFactory</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/spring-core/src/main/java/io/github/donggi/config/Test1Config.java" displayRange="[14]" lan="java">Config</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/spring-core/src/test/java/io/github/donggi/Test1.java" displayRange="[16]" lan="java">Test</button></p></ul></div><h2>SpEL; Spring Expression Language</h2><div><h3>표현식 평가</h3><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">var parser = new SpelExpressionParser();
var exp = parser.parseeExpression("'Hello World'");
exp = parser.parseeExpression("'Hello World'.concat('!')");          // concat()
exp = parser.parseeExpression("'Hello World'.bytes");                // getBytes()
exp = parser.parseeExpression("new String('Hello World').bytes.length");

parser.parseExpression("name").getValue(String.class);               // get result value as String
parser.parseExpression("name").getValue(obj);                        // get obj.name via obj.getName()
parser.parseExpression("name == 'Bob'").getValue(obj, Boolean.class) // get (obj.getName().equals("Bob"))</div><p>속도 향상을 위해 컴파일러를 켤 수 있다.</p><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">new SpelParserConfiguration(SpelCompilerMode.IMMEDIATE, ...);
// OFF(default), IMMEDIATE(즉시 컴파일), MIXED(나중에 컴파일, 컴파일 표현식 실패 시 다시 인터프리팅 해석)
// 또는 시스템 속성 spring.expression.compiler.mode=off|immediate|mixed 로도 설정 가능

// 4.1 제약사항
// * 할당 문장 사용 불가
// * Conversion service 의존 문장 사용 불가
// * 사용자 정의 resolver, accessor 사용 불가
// * Selection, projection  불가</div><h3>빈 정의 표현식</h3><p><strong>&#x23;{ 표현식 }</strong>으로 빈을 정의할 수 있다</p><p><strong>↓ xml</strong></p><div lan="xml" class="as-code code-div w3-leftbar w3-border-green">&lt;property value="&#x23;{ T(java.lang.Math).random() * 100 }"/>
&lt;!-- 컨텍스트 상에 정의된 다른 모든 빈을 참조할 수 있다 -->
&lt;property value="&#x23;{ systemProperties['user.region'] }"/>
&lt;property value="&#x23;{ myBean.someProp }"/></div><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">@Value("&#x23;{ systemProperties['user.region'] }")</div><h3>표현식 문법</h3><div><h4>Literal</h4><p><strong>↓ text</strong></p><div lan="text" class="as-code code-div w3-leftbar w3-border-green">&#x23;{ 'Text' }
&#x23;{ '3.14e+15' }
&#x23;{ '0x7fff' }
&#x23;{ 'true' }
&#x23;{ 'null' }</div><h4>Properties, Arrays, Lists, Maps, Indexers</h4><p><strong>↓ text</strong></p><div lan="text" class="as-code code-div w3-leftbar w3-border-green">&#x23;{ list[3].arr[3][3] }
&#x23;{ map['key'] }
&#x23;{ {1, 2, 3} }                    // inline list
&#x23;{ {} }                           // empty list
&#x23;{ {num: 1, date: '2020-02-02'} } // inline map
&#x23;{ {:} }                          // empty map
&#x23;{ new int[] {1, 2, 3} }          // 배열 생성자 호출 가능</div><h4>Operators</h4><p><strong>↓ text</strong></p><div lan="text" class="as-code code-div w3-leftbar w3-border-green">&#x23;{ 2 > null == true }                       // null은 다른 모든 것보다 작다고 간주
&#x23;{ 2 gt null eq true }
    // lt(&lt;), gt(>), le(&lt;=), ge(>=), eq(==), ne(!=), div(/), mod(%), not(!), and(&amp;&amp;), or(||)
&#x23;{ 'text' instanceof T(java.lang.String) }  // 기본 타입들은 모두 래핑됨에 유의
&#x23;{ 'text' matches '^\\w+$' }
&#x23;{ T(java.math.RoundingMode).CEILING }      // static 멤버 접근 가능
&#x23;{ name?:'Anonymous' }                      // name != null ? name : "Anonymous"
&#x23;{ bean?.prop }                             // Null safe navigation</div><h4>Variables, Functions</h4><p><strong>↓ text</strong></p><div lan="text" class="as-code code-div w3-leftbar w3-border-green">&#x23;{ &#x23;variable }   // 변수 참조
&#x23;{ &#x23;this }       // 현재 컨텍스트
&#x23;{ &#x23;root }       // 루트 컨텍스트
&#x23;{ &#x23;funcName() } // 사용자 정의 함수 호출</div><h4>Selection, Projection</h4><p><strong>↓ text</strong></p><div lan="text" class="as-code code-div w3-leftbar w3-border-green">${ collection.?[num > 123] } // selection
${ collection.![num + 123] } // projection
</div></div></div><h2>Spring AOP</h2><span id="pos-941319825" style="padding:0!important;margin:0!important;width:0!important;height:0!important;overflow:hidden!important"></span><div><h3>AOP 개념</h3><ol><li>Aspect : 횡단 관심사. 로깅/보안 등, 여러 객체를 가로질러 공통적으로 사용되는 모듈/기능</li><li>Join Point : Aspect 실행 지점</li><li>Advice : Join Point에서 실행되는 코드</li><li>Pointcut : 일치하는 Join Point에 대한<a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green" href="https://www.eclipse.org/aspectj/doc/next/progguide/semantics-pointcuts.html">정규 표현식</a></li>Advice는 Pointcut과 연관되며, 일치하는 모든 Join Point에서 실행된다.<li>Weaving : Advice 코드를 삽입</li>세 가지 Weaving 방식 : 컴파일 타임 위빙, 클래스 로드 타임 위빙, 런타임 위빙</ol><h3>Spring AOP</h3><ul><li>Spring은 프록시를 만들어 Aspect의 실행을 삽입한다</li><p>따라서 final이거나, 정의되지 않은 메서드는 Aspect 삽입이 불가능하다.</p><li>JDK 프록시는 public 인터페이스 메서드만, CGLIB 프록시는 public, protected 인터페이스/클래스 메서드에 삽입 가능</li><p><strong>↓ CGLIB 고정 - java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">@EnableAspectJAutoProxy(proxyTargetClass=true)</div><p><strong>↓ CGLIB 고정 - xml</strong></p><div lan="xml" class="as-code code-div w3-leftbar w3-border-green">&lt;aop:config proxy-target-class="true">&lt;/aop:config>
&lt;aop:aspectj-autoproxy proxy-target-class="true"/></div><li>프록시가 새 인터페이스를 구현하도록 변경(Introduction)하는 것은 가능하다.</li><li>Aspect 적용 순서 정의</li><p>@Order(xml에서는 order 속성)를 적용하거나 Ordered 인터페이스 구현</p><li class="marker">지원하는 advice</li><table><tr><th>종류</th><th>aop 태그</th><th>적용 시점</th></tr><tr><td>Before</td><td>aop:before</td><td>메서드 실행 전</td></tr><tr><td>After Returning</td><td>aop:after-returning</td><td>메서드 정상 종료 후</td></tr><tr><td>After Throwing</td><td>aop:after-throwing</td><td>메서드 예외 throw시 적용</td></tr><tr><td>After</td><td>aop:after</td><td>after-returning + after-throwing</td></tr><tr><td>Around</td><td>aop:around</td><td>before + after</td></tr></table><li class="marker">지원하는 pointcut 지시자</li><table><tr><th>Designator</th><th>설명</th></tr><tr><td>bean</td><td>특정 빈에 정의된 메서드 호출. id or name 지정. 와일드카드 * 사용 가능</td></tr><tr><td>execution</td><td>특정 메서드 호출</td></tr><tr><td>within</td><td>특정 타입들에 정의된 메서드 호출</td></tr><tr><td>this</td><td>특정 타입 AOP 프록시 인스턴스에 정의된 메서드 호출</td></tr><tr><td>target</td><td>특정 타입 인스턴스에 정의된 메서드 호출</td></tr><tr><td>args</td><td>인자가 특정 타입 인스턴스들인 메서드 호출</td></tr><tr><td>@annotation</td><td>특정 애너테이션이 붙은 메서드 호출</td></tr><tr><td>@within</td><td>특정 애너테이션이 타입들에 정의된 메서드 호출</td></tr><tr><td>@target</td><td>특정 애너테이션이 붙은 클래스 인스턴스에 정의된 메서드 호출</td></tr><tr><td>@args</td><td>인자에 특정 애너테이션이 붙은 메서드 호출</td></tr></table><ul><li>Pointcut 표현식에 &amp;&amp;, ||, ! 사용 가능</li><li>Pointcut 표현식에 이름 사용 가능</li><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">@Pointcut("execution(public * *(..))")
private void anyPublicOperation() {} 
@Pointcut("within(com.xyz.someapp.trading..*)")
private void inTrading() {} 
@Pointcut("anyPublicOperation() &amp;&amp; inTrading()")
private void tradingOperation() {} </div><li>public Pointcut 표현식은 외부에서도 이용 가능하므로, 정의를 중앙화할 수 있다.</li><li>execution 표현식</li><p><strong>↓ text</strong></p><div lan="text" class="as-code code-div w3-leftbar w3-border-green">execution(modifires-pattern? return-type-pattern declaring-type-pattern?name-pattern(param-pattern) throws-pattern?)
    return-type-pattern     *는 임의 반환 타입에 매칭
    declaring-type-pattern  메서드가 정의된 타입 지정. 마지막은 '.'으로 끝나야 한다.
    name-pattern            메서드 이름 지정
    param-pattern           ()는 무인자, (..)는 임의 타입 및 길이 인자, (*)는 해당 자리의 임의 타입 인자.</div></ul><li class="marker">각 advice별 예시 코드(XML)</li><table class="no-sort"><tr><td>Before</td><td><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/main/java/io/github/donggi/advice/BeforeAdvice.java" displayRange="[7]" lan="java">Advice</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/test/resources/beans/Beans2.xml" lan="xml">Config</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/test/java/io/github/donggi/advice/BeforeAdviceTest.java" displayRange="[7]" lan="java">Test</button><br>Before advice에서 예외를 던지면 실제 메서드는 호출되지 않는 효과가 있다.</td></tr><tr><td>After returning</td><td><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/main/java/io/github/donggi/advice/AfterAdvice.java" displayRange="[3]" lan="java">Advice</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/test/resources/beans/Beans3.xml" lan="xml">Config</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/test/java/io/github/donggi/advice/AfterAdviceTest.java" displayRange="[7]" lan="java">Test</button></td></tr><tr><td>After throwing</td><td><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/main/java/io/github/donggi/advice/AfterAdvice2.java" displayRange="[3]" lan="java">Advice</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/test/resources/beans/Beans4.xml" lan="xml">Config</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/test/java/io/github/donggi/advice/AfterAdviceTest2.java" displayRange="[7]" lan="java">Test</button></td></tr><tr><td>After</td><td><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/main/java/io/github/donggi/advice/AfterAdvice3.java" displayRange="[5]" lan="java">Advice</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/test/resources/beans/Beans5.xml" lan="xml">Config</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/test/java/io/github/donggi/advice/AfterAdviceTest3.java" displayRange="[7]" lan="java">Test</button></td></tr><tr><td>Around</td><td><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/main/java/io/github/donggi/advice/TimerAdvice.java" displayRange="[5]" lan="java">Advice</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/test/resources/beans/Beans1.xml" lan="xml">Config</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/test/java/io/github/donggi/advice/TimerAdviceTest.java" displayRange="[7]" lan="java">Test</button></td></tr></table><li class="marker">각 advice별 예시 코드(@Aspect)</li><p><strong>↓ @Aspect 켜기 - Java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">@Configuration
@EnableAspectJAutoProxy</div><p><strong>↓ @Aspect 켜기 - XML</strong></p><div lan="xml" class="as-code code-div w3-leftbar w3-border-green">&lt;aop:aspectj-autoproxy/></div><table class="no-sort"><tr><td>Before</td><td><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/main/java/io/github/donggi/aspect/BeforeAspect.java" displayRange="[9]" lan="java">Aspect</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/test/resources/beans/Beans7.xml" lan="xml">Config</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/test/java/io/github/donggi/advice/BeforeAdviceTest2.java" displayRange="[7]" lan="java">Test</button></td></tr><tr><td>After Returning</td><td><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/main/java/io/github/donggi/aspect/AfterAspect.java" displayRange="[7]" lan="java">Aspect</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/test/resources/beans/Beans8.xml" lan="xml">Config</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/test/java/io/github/donggi/advice/AfterAdviceTest4.java" displayRange="[7]" lan="java">Test</button></td></tr><tr><td>After Throwing</td><td><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/main/java/io/github/donggi/aspect/AfterAspect2.java" displayRange="[7]" lan="java">Aspect</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/test/resources/beans/Beans9.xml" lan="xml">Config</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/test/java/io/github/donggi/advice/AfterAdviceTest5.java" displayRange="[7]" lan="java">Test</button></td></tr><tr><td>After</td><td><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/main/java/io/github/donggi/aspect/AfterAspect3.java" displayRange="[7]" lan="java">Aspect</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/test/resources/beans/Beans10.xml" lan="xml">Config</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/test/java/io/github/donggi/advice/AfterAdviceTest6.java" displayRange="[7]" lan="java">Test</button></td></tr><tr><td>Around</td><td><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/main/java/io/github/donggi/aspect/AroundAspect.java" displayRange="[8]" lan="java">Aspect</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/test/resources/beans/Beans6.xml" lan="xml">Config</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/test/java/io/github/donggi/advice/TimerAdviceTest2.java" displayRange="[7]" lan="java">Test</button></td></tr></table><li class="marker">execution 외 Pointcut 예시 코드</li><table class="no-sort"><tr><td>args XML 설정 예</td><td><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/main/java/io/github/donggi/advice/BeforeAdvice2.java" displayRange="[5]" lan="java">Advice</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/test/resources/beans/Beans11.xml" lan="xml">Config</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/test/java/io/github/donggi/advice/BeforeAdviceTest3.java" displayRange="[7]" lan="java">Test</button></td></tr><tr><td>args @Aspect 설정 예</td><td><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/main/java/io/github/donggi/aspect/BeforeAspect2.java" displayRange="[7]" lan="java">Aspect</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/test/resources/beans/Beans12.xml" lan="xml">Config</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-aop/src/test/java/io/github/donggi/advice/BeforeAdviceTest4.java" displayRange="[7]" lan="java">Test</button></td></tr><tr><td>execution + args 예</td><td><p><strong>↓ 즉시 이용</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">@Before("com.xyz.myapp.SystemArchitecture.dataAccessOperation() &amp;&amp; args(account,..)")
public void validateAccount(Account account) { ... }</div><p><strong>↓ Pointcut 지정</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">@Pointcut("com.xyz.myapp.SystemArchitecture.dataAccessOperation() &amp;&amp; args(account,..)")
private void accountDataAccessOperation(Account account) {}

@Before("accountDataAccessOperation(account)")
public void validateAccount(Account account) { ... }</div></td></tr><tr><td>Generic args 예</td><td><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">public interface Sample&lt;T> {
    void sampleGenericMethod(T param);
    void sampleGenericCollectionMethod(Collection&lt;T> param);
}

@Before("execution(* ..Sample+.sampleGenericMethod(*)) &amp;&amp; args(param)")
public void beforeSampleMethod(MyType param) { ... } // ← 가능

@Before("execution(* ..Sample+.sampleGenericCollectionMethod(*)) &amp;&amp; args(param)")
public void beforeSampleMethod(Collection&lt;MyType> param) { ... } // ← 불가능</div></td></tr></table><li class="marker">Aspect 인스턴스화 종류</li><ul><li>default. 싱글톤</li><li>perthis : 대상 메서드를 실행하는 프록시 인스턴스(this)마다 프록시 생성</li><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">@Aspect("perthis(com.xyz.myapp.SystemArchitecture.businessService())")
public class MyAspect { }</div><li>pertarget : 대상 메서드를 실행하는 실제 인스턴스(target)마다 프록시 생성</li></ul></ul></div><h2>Null-safety</h2><ul><li>@Nullable : 파리미터, 반환값, 필드가 null일 수 있음</li><li>@NonNull : 파리미터, 반환값, 필드가 null일 수 없음</li><li>@NonNullApi : 패키지 수준으로 파라미터, 반환값에 @NonNull 기본 적용</li><li>@NonNullFields : 패키지 수준으로 필드에 @NonNull 기본 적용</li></ul><h2>Data Bufferes and Codecs Since 5.0</h2><p>java.nio 패키지에서 Buffer를 제공하지만, 여러 라이브러리들은 그전부터 자체적인 버퍼 api를 정의해 사용해왔다. 스프링은 이러한 불일치를 해소하기 위해 추상화된 API를 제공한다.</p><ul><li>DataBufferFactory</li><p>2가지 방법으로 버퍼 생성이 가능하다. WebFlux에서는 ServerHttpResponse, ClientHttpRequest를 통해 팩터리에 접근한다</p><ol><li>새로운 버퍼를 생성. 최초 크기 지정 가능</li><li>기존 byte[], java.nio.ByteBuffer를 래핑하여 생성</li></ol><li>DataBuffer</li><p>java.nio.ByteBuffer와 유사한 기능에 더해 아래의 장점을 갖는다</p><ul><li>flip() 사용없이 서로 다른 위치에 대해 읽기/쓰기 가능</li><li>자동으로 capacity 증가</li><li>버퍼에 대한 ByteBuffer, InputStream, OutputStream 뷰 제공</li></ul><li>PooledDataBuffer</li><p>Direct 버퍼의 생성/소멸 시간이 Non-direct 버퍼에 비해 길다는 단점을 해소하기 위해 만들어졌다.<br>→ 버퍼에 대한 참조 카운터를 유지함으로써 버퍼를 재활용할 수 있게 해준다.<br>retain()으로 참조를 얻고, release()로 반환 → DataBufferUtils에서 편의 메서드 제공</p><li>DataBUfferUtils</li><ul><li>복사없이 두 버퍼를 하나로 연결하는 기능 제공</li><li>InputStream, Channel -> Flux&lt;DataBuffer> 변환, Publisher&lt;DataBuffer> -> OutputStream, Channel 변환 제공</li><li>PooledDataBuffer 획득/반환</li></ul><li>Codecs</li><ul><li>Encoder : Publisher&lt;T> -> Flux&lt;DataBuffer> 변환</li><li>Decoder : Publisher&lt;DataBuffer> -> Flux&lt;T> 변환</li><li>spring-core 모듈은 byte[], ByteBuffer, DataBuffer, Resource, String에 대한 인코더/디코더 구현을 제공한다</li><li>spring-web 모듈은 Jackson JSON, Jackson Smile, JAXB2 등에 대한 인코더/디코더 구현을 제공한다</li></ul><li>DataBuffer 주의사항</li><p>버퍼를 사용한 후엔 반드시 잘 반환해야 한다</p><ul><li>Decoder가 각 버퍼를 읽고 바로 반환하는 경우 DataBufferUtils.release() 이용</li><li>Decoder가 Flux, Mono의 연산 ─ flatMap, reduce, filter, skip 등 ─ 을 이용하는 경우, 체인에 doOnDiscard(PooledDataBuffer.class, DataBufferUtils::release)를 결합하여 버퍼가 버려지기 전에 반환되도록 해야한다</li><li>그 외의 경우, Decoder는 모든 읽기를 마치거나, 에러/취소 신호를 받는 경우 버퍼를 반환해야 한다</li><li>DataBufferUtils의 join, skipUntilByteCount, takeUntilByteCount는 decoder가 이용해도 안전하다</li><li>Encoder의 경우, 쓰기 작업에 예외가 발생한 경우 버퍼를 반환해야 한다</li></ul></ul></div><h1>Spring Web MVC</h1><ul><li>Servlet API 기반으로 빌드하고 Servlet container로 배포하는 웹 애플리케이션 개발 프레임워크</li><li>리액티브 스트림 기반의 Spring WebFlux가 Spring Framework 5.0에 추가되었다</li></ul><div><h2>DispatcherServlet</h2><ul><li>DispatcherServlet은 클라이언트 요청을 받아 다른 컴포넌트로 처리를 넘긴다.</li><li>각 DispatcherServlet은 하나의 WebApplicationContext를 갖는다</li><li>여타 서블릿과 마찬가지로 자바 설정이나 web.xml로 선언해야 한다</li></ul><div><h3>자바 설정 Since 3.0 - WebApplicationInitializer 정의 예</h3><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java1/src/main/java/io/github/donggi/mvc/config/Initializer.java" displayRange="[9]" lan="java">Initializer.java</button><p>정상적으로 완료되면 실행 시 로그에 "INFO: 1 Spring WebApplicationInitializers detected on classpath"처럼 기록된다. 자동으로 스캔되지 않는 경우 /META-INF/services/javax.servlet.ServletContainerInitializer 파일에 해당 클래스 명시</p><h3>web.xml 기술 예</h3><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-xml2/src/main/webapp/WEB-INF/web.xml" lan="xml">web.xml</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-xml2/src/main/webapp/WEB-INF/app-servlet.xml" lan="xml">app-servlet.xml</button><ul><li>기본적으로 {서블릿_이름}-servlet.xml 설정을 읽어온다.</li><p>{서블릿_이름}-servlet == default namespace</p><li>다른 파일(들)을 로드하고 싶거나, 아예 로드하고 싶지 않은 경우 contextConfigLocation 조정</li><p>각 경로들은 ','로 구분하면 된다. 클래스패스에 있는 파일은 classpath:conf.xml처럼 지정하면 된다.</p><p><strong>↓ 추가 로드 x</strong></p><div lan="xml" class="as-code code-div w3-leftbar w3-border-green">&lt;servlet>
    &lt;servlet-name>app&lt;/servlet-name>
    &lt;servlet-class>org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class>
    &lt;init-param>
        &lt;param-name>contextConfigLocation&lt;/param-name>
        &lt;param-value>&lt;/param-value>
    &lt;/init-param>
&lt;/servlet></div><li>xml에서 ConfigurableWebApplicationContext 구현 클래스를 지정하고 싶은 경우, contextClass 조정</li><p>기본값은 XmlWebApplicationContext</p><p><strong>↓ xml</strong></p><div lan="xml" class="as-code code-div w3-leftbar w3-border-green">&lt;servlet>
    &lt;servlet-name>app&lt;/servlet-name>
    &lt;servlet-class>org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class>
    &lt;init-param>
        &lt;param-name>contextClass&lt;/param-name>
        &lt;param-value>org.springframework.web.context.support.AnnotationConfigWebApplicationContext&lt;/param-value>
    &lt;/init-param>
    &lt;init-param>
        &lt;param-name>contextConfigLocation&lt;/param-name>
        &lt;param-value>package..ClassName&lt;/param-value>
    &lt;/init-param>
&lt;/servlet>
</div></ul><h3>Context Hierarchy</h3><ul><li>일반적으로 하나의 WebApplicationContext로 충분하지만, 루트 WebApplicationContext를 DispatcherServlet들이 공유하고, 각각은 자식 WebApplicationContext를 갖는 계층 구조로도 구성 가능하다</li><li>루트 WebApplicationContext는 전형적으로 Repository, Service 등 여러 Servlet 사이에서 공유될 빈들을 갖는다</li><p>이들은 자식 WebApplicationContext로 상속되며, 필요에 따라 재정의(override)할 수 있다</p><li>자바 구성 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java2/src/main/java/io/github/donggi/mvc/config/App1Initializer.java" displayRange="[5]" lan="java">App1Initializer.java</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java2/src/main/java/io/github/donggi/mvc/config/App2Initializer.java" displayRange="[5]" lan="java">App2Initializer.java</button></li><li>web.xml 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-xml3/src/main/webapp/WEB-INF/web.xml" lan="xml">web.xml</button></li></ul><h3>Special Bean Types</h3><p>DispatcherServlet이 요청을 처리하도록 전달하는 빈들을 Special Bean이라고 하며, 정의하지 않은 경우 <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green" href="https://github.com/spring-projects/spring-framework/blob/master/spring-webmvc/src/main/resources/org/springframework/web/servlet/DispatcherServlet.properties">기본값</a>이 사용된다</p><table><tr><th>타입</th><th>설명</th></tr><tr><td>HandlerMapping</td><td>요청 URI -&gt; 핸들러 매핑. @RequestMapping, @GetMapping, ...</td></tr><tr><td>HandlerAdapter</td><td>핸들러의 구현에 상관없이 DispatcherServlet이 호출할 수 있도록 래퍼 제공</td></tr><tr><td>HandlerExceptionResolver</td><td>예외 발생 시 처리 전략</td></tr><tr><td>ViewResolver</td><td>핸들러가 렌더링할 View 이름을 반환하면 적절한 View를 선택</td></tr><tr><td>LocaleResolver, LocaleContextResolver</td><td>클라이언트 Locale 선택</td></tr><tr><td>MultipartResolver</td><td>Multi-part 요청 처리 api 제공</td></tr><tr><td>FlashMapManager</td><td>요청 간 FlashMap 인스턴스 공유 기능 제공</td></tr></table><h3>Processing; 요청 처리 절차</h3><ol><li>요청에 맞는 WebApplicationContext가 검색되어 바운딩</li><li>LocaleResolver 바운딩</li><li>ThemeResolver 바운딩</li><li>Multi-part 요청이라면 MultipartHttpServletRequest로 래핑</li><li>요청에 대한 핸들러 호출</li></ol><h3>Interception</h3><p>핸들러 요청에 대한 전/후 처리를 추가할 수 있다 <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos63735001" target="_self">Goto - MVC config - Interceptors</a></p><p><strong>↓ interface HandlerInterceptor</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">default boolean preHandle(request, response, handler);
    // DispatcherServlet이 핸들러를 결정하고, 아직 HandlerAdapter가 핸들러를 호출하지 않은 시점에 실행된다
    // 다음 처리로 진행한다면 true. false를 반환한 경우, DispatcherServlet은 여기서 response로 모든 응답을 했다고 간주한다
default void postHandle(request, response, handler, @Nullable modelAndView);
    // HandlerAdapter가 핸들러를 호출하고, 아직 DispatcherServlet이 뷰를 렌더링하지 않은 시점에 실행된다
    // 전달된 modelAndView에 다른 모델 객체들을 추가해도 된다
default void afterCompletion(request, response, handler, @Nullable ex)
    // 모든 처리가 완료되었으므로 자원 정리 등의 작업을 수행해도 된다
    // preHandle()이 성공적으로 true를 반환한 경우에도 실행된다
</div><h3>Exceptions</h3><div><h4>HandlerExceptionResolver 종류</h4><ul><li>SimpleMappingExceptionResolver</li><p>예외 클래스 -> 뷰 이름 매핑</p><p><strong>↓ xml</strong></p><div lan="xml" class="as-code code-div w3-leftbar w3-border-green">&lt;bean id="exceptionResolver"
    class="org.springframework.web.servlet.handler.SimpleMappingExceptionResolver">
    &lt;property name="exceptionMappings">
        &lt;props>
            &lt;prop key="MaxUploadSizeExceededException"> error &lt;/prop>
        &lt;/props>
    &lt;/property>
&lt;/bean></div><li>DefaultHandlerExceptionResolver</li><p>예외 -> HTTP 상태 코드 매핑</p><li>ResponseStatusExceptionResolver</li><p>예외 발생 메서드 또는 발생한 예외 클래스의 @ResponseStatus -> HTTP 상태 코드 매핑</p><li>ExceptionHandlerExceptionResolver</li><p>@Controller 또는 @ControllerAdvice 클래스의 @ExceptionHandler 메서드가 예외 처리 <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos1895376872" target="_self">Goto - Annotated Controllers - Exceptions</a></p></ul><h4 class="fake">Chain of Resolvers</h4><p>여러 HandlerExceptionResolver 빈을 정의하면 order 및 정의된 순서에 따라 호출되는 체인을 구성할 수 있다</p><h4 class="fake">Container Error Page</h4><p>예외가 처리되지 않았고, 응답 상태가 에러(4xx, 5xx)인 경우를 위해 기본 에러 페이지를 지정할 수 있다</p><p><strong>↓ web.xml</strong></p><div lan="xml" class="as-code code-div w3-leftbar w3-border-green">&lt;error-page>
    &lt;exception-type>java.lang.Throwable&lt;/exception-type> // 옵션
    &lt;location>/path/url&lt;/location>
&lt;/error-page></div></div><h3>View Resolution</h3><div><h4>ViewResolver 종류</h4><ul><a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos701800517" target="_self">Goto - View Technologies</a><a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos-1794183043" target="_self">Goto - MVC config - View Resolvers</a><li>AbstractCachingViewResolver</li><p>뷰 인스턴스를 캐시하여 이용한다. cache 속성을 이용해 전체 캐시를 끄거나, removeFromCache()로 일부 뷰만 캐시에서 제거할 수 있다</p><li>XmlViewResolver, BeanNameViewResolver</li><p>현재 컨텍스트에서 뷰 이름과 일치하는 빈을 뷰로 이용한다. XmlViewResolver은 따로 지정하지 않으면 기본으로 /WEB-INF/views.xml를 로드한다</p><li>ResourceBundleViewResolver</li><p>ResourceBundle(기본 리소스 파일 : views.properties)에 저장된 빈 정보로 뷰를 찾는다. 정확히는 [viewname].(class) 속성을 뷰 클래스로, [viewname].url 속성을 뷰 url로 이용한다.</p><li>UrlBasedViewResolver</li><p>Url 경로 그대로의 위치에 존재하는 파일을 뷰로 이용한다.</p><li>InternalResourceViewResolver</li><p>UrlBasedViewResolver의 서브클래스로, InternalResourceView(Servlet, JSP) 파일을 뷰로 이용한다. 그 외 서브클래스 ─ TilesViewResolver, XsltViewResolver, FreeMarkerViewResolver ─ 들도 존재</p><p><strong>↓ xml</strong></p><div lan="xml" class="as-code code-div w3-leftbar w3-border-green">&lt;bean class="org.springframework.web.servlet.view.InternalResourceViewResolver">
    &lt;property name="viewClass" value="org.springframework.web.servlet.view.JstlView"/> // ← JSTL 이용하는 경우
    &lt;property name="prefix" value="/WEB-INF/view/" />
    &lt;property name="suffix" value=".jsp" />
&lt;/bean></div><li>ContentNegotiatingViewResolver</li><p>컨텐츠 협상이 가능한 ViewResolver. 다른 ViewResolver들이 고른 View 중, contentType이 요청과 일치하는 것을 선택한다</p></ul><h4 class="fake">Handling</h4><ul><li>여러 ViewResolver를 이용 가능</li><p>order 속성으로 순서를 제어할 수 있다.</p><li>null을 반환하면 뷰를 찾지 못했음을 의미한다.</li><p>InternalResourceViewResolver는 마지막에 동작해야 한다</p></ul><h4>Redirecting</h4><ul><li>UrlBasedViewResolver 및 서브클래스를 이용하는 경우, 뷰 이름 앞에 redirect:를 붙이면 리다이렉션을 수행한다</li><p>예. redirect:/myapp/some/resource</p><li>redirect:https://myhost.com/some 처럼 외부 절대경로 이용 가능</li></ul><h4>Forwarding</h4><ul><li>UrlBasedViewResolver 및 서브클래스를 이용하는 경우, 뷰 이름 앞에 forward:를 붙이면 포워딩을 수행한다</li><li>RequestDispatcher.forward()를 호출하는 InternalResourceView 인스턴스를 생성하므로 JSP만 사용하는 경우는 유용하지 않음</li><p>다른 종류의 뷰를 이용하지만 서블릿/JSP로 포워딩이 필요한 경우에 적합</p></ul></div><h3>Multipart Resolver</h3><p>Multi-part 요청을 처리하려면 DispatcherServlet에 "multipartResolver" 이름의 MultipartResolver 빈을 정의해야 한다</p><ul><li>commons-fileupload</li><ul><li>JavaConfig 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java5/src/main/java/io/github/donggi/mvc/config/AppConfig.java" displayRange="[13]" lan="java">AppConfig.java</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java5/src/main/java/io/github/donggi/mvc/controller/FileController.java" displayRange="[16]" lan="java">FileController.java</button></li><li>xml 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-xml5/src/main/webapp/WEB-INF/app-servlet.xml" lan="xml">app-servlet.xml</button></li></ul><li>Since Servlet 3.0</li><ol><li>Initializer에서 MultipartConfigElement 추가, 또는 web.xml에 multipart-config 추가</li><li>StandardServletMultipartResolver 빈 정의</li></ol><ul><li>JavaConfig 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java6/src/main/java/io/github/donggi/mvc/config/Initializer.java" displayRange="[10]" lan="java">Initializer.java</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java6/src/main/java/io/github/donggi/mvc/config/AppConfig.java" displayRange="[13]" lan="java">AppConfig.java</button></li><li>xml 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-xml6/src/main/webapp/WEB-INF/web.xml" lan="xml">web.xml</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-xml6/src/main/webapp/WEB-INF/app-servlet.xml" lan="xml">app-servlet.xml</button></li></ul><li>@RequestParam으로 Map&lt;String, MultipartFile>, MultiValueMap&lt;String, MultipartFile>도 가능</li><li>Since Servlet 3.0 : MultipartFile 대신 javax.servlet.http.Part 이용 가능</li></ul><h3>Logging - Sensitive Data</h3><p>기본적으로 요청 인자와 헤더는 로깅하지 않는다. 로깅하려면 DispatcherServlet의 enableLoggingRequestDetails를 true로 설정하면 된다</p><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">public class Initializer extends AbstractAnnotationConfigDispatcherServletInitializer {
    @Override
    protected void customizeRegistration(ServletRegistration.Dynamic registration) {
        registration.setInitParameter("enableLoggingRequestDetails", "true");
    }
}</div><p><strong>↓ xml</strong></p><div lan="xml" class="as-code code-div w3-leftbar w3-border-green">&lt;servlet>
    &lt;servlet-class>org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class>
    &lt;init-param>
        &lt;param-name>enableLoggingRequestDetails&lt;/param-name>
        &lt;param-value>true&lt;/param-value>
    &lt;/init-param>
&lt;/servlet>
</div></div><h2>Filters</h2><div><h3 class="fake">OncePerRequestFilter 서브클래스</h3><p>AbstractRequestLoggingFilter, CharacterEncodingFilter, CorsFilter, FormContentFilter, ForwardedHeaderFilter, HiddenHttpMethodFilter, HttpPutFormContentFilter, MultipartFilter, OpenEntityManagerInViewFilter, OpenSessionInViewFilter, RelativeRedirectFilter, RequestContextFilter, ShallowEtagHeaderFilter</p><div><h4>Default Encoding</h4><p>CharacterEncodingFilter는 HttpServletRequest 변수 request에 대하여 아래를 수행한다</p><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">if (isForceRequestEncoding() || request.getCharacterEncoding() == null) {
    request.setCharacterEncoding(encoding);
}</div><h4>Form Data</h4><p>FormContentFilter를 이용하면 HTTP PUT, PATCH, DELETE 요청으로 온 application/x-www-form-urlencoded 내용을 ServletRequest.getParameter*()로 접근할 수 있다</p><h4>Forwarded Headers</h4><ul><li>프록시 서버를 거치는 경우 실제 클라이언트의 주소는 Forwarded 헤더 ─ X-Forwarded-Host, X-Forwarded-Port, ... ─ 로 옮겨진다</li><li>ForwardedHeaderFilter를 이용하면 요청의 주소를 Forwarded 헤더의 것으로 변경하고 Forwarded 헤더를 지운다</li><p>요청을 래핑해야 하므로, 다른 가장 먼저 실행될 필요가 있다</p><li>Forwarded 헤더가 공격자로부터 삽입된 것이라면 이를 사용하지 않고 삭제만 해야한��</li><p>ForwardedHeaderFilter의 removeOnly 속성을 true로 설정하면 된다</p><li>AbstractAnnotationConfigDispatcherServletInitializer를 이용하는 경우, DispatcherType.REQUEST, ASYNC, ERROR 모두에 대해 실행된다</li><p>그 외의 경우 DispatcherType.REQUEST에 대해서만 동작한다</p></ul><h4>CORS</h4><p>Controller 클래스에 애너테이션을 붙여 CORS 설정을 할 수 있지만, Spring Security를 이용하는 경우 CorsFilter를 이용해 Security보다 먼저 실행되도록 설정할 것이 권장된다 <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos2074541" target="_self">Goto - CORS</a></p></div></div><h2>Annotated Controllers</h2><div><h3>Declaration</h3><ul><li>@Controller : WebApplicationContext에서 웹 요청 처리자로 간주된다</li><li>@RestController : @Controller + 클래스 수준 @ResponseBody</li></ul><h3>Request Mapping</h3><ul><li>컨트롤러 클래스 및 메서드에 @RequestMapping을 붙여 어떤 요청을 처리하는지 명시</li><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">@RequestMapping("/file/*")
public class FileController {
    @RequestMapping(value = "/upload", method = RequestMethod.GET)
    public String upload() { }
}</div><li>HTTP 요청에 따라 @GetMapping, @PostMapping, @PutMapping, @DeleteMapping, @PatchMapping 존재</li></ul><div><h4>URI Patterns</h4><span id="pos-1092929705" style="padding:0!important;margin:0!important;width:0!important;height:0!important;overflow:hidden!important"></span><table><tr><th>Pattern</th><th>Description</th></tr><tr><td>?</td><td>임의 1글자</td></tr><tr><td>*</td><td>1개 경로 조각 내의 임의 0개 이상 글자</td></tr><tr><td>**</td><td>0개 이상의 연속적인 경로 조각</td></tr><tr><td>{name}</td><td>1개 경로 조각을 name 변수로 획득</td></tr><tr><td>{name:regex}</td><td>경로가 정규식에 일치하면 해당 부분을 name 변수로 획득</td></tr></table><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">@GetMapping("/owners/{ownerId}/pets/{petId}")
public Pet findPet(@PathVariable Long ownerId, @PathVariable Long petId);
    // 컴파일된 클래스에 매개변수 이름이 그대로 남아있다면 @PathVariable에 이름 설정 불필요</div><ul><li>기본 타입과 Date 등 일부 클래스로는 자동으로 변환이 가능하다. 전역적인 변환기를 등록하려면 <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos87617553" target="_self">Goto - MVC config - Type Conversion</a>, @Controller, @ControllerAdvice에만 적용되는 변환기를 등록하려면 <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos-1521490412" target="_self">Goto - DataBinder</a> 참고</li><li><a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos114384251" target="_self">Goto - property-placeholder</a>와 같은 ${...} 표현식 사용 가능. 앱 시작 시 평가된다.</li></ul><h4 class="fake">Pattern Comparison</h4><p>URL 하나가 여러 패턴에 매칭되는 경우, 가장 일반적이지 않은 패턴이 선택된다. 우선순위는 <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green" href="https://docs.spring.io/spring-framework/docs/5.2.8.RELEASE/javadoc-api/org/springframework/util/AntPathMatcher.AntPatternComparator.html">AntPathMatcher.AntPatternComparator</a> 참고</p><h4>Suffix Match</h4><ul><li>Before 5.3 : 기본적으로 .* 접미사 매칭이 수행된다. 예를 들어 패턴 "/person"은 "/person.pdf" 같은 URL도 매칭한다. </li><li>기능을 끄려면 PathMatchConfigurer.useSuffixPatternMatching(false) <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos993156397" target="_self">Goto - MVC config - Path Matching</a>, ContentNegotiationConfigurer.favorPathExtension(false) <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos935569767" target="_self">Goto - MVC config - Content Types</a>를 호출해야 한다</li><li>브라우저의 Accept 헤더를 일관적으로 해석하지 못하던 때에는 필수적이었지만, 요즘은 그렇지 않다. 5.3 버전부터는 기본적으로 false로 설정된다</li><li>RFD 공격을 예방하기 위해, 아래를 모두 만족하는 경우 응답 헤더에 Content-Disposition:inline;filename=f.txt를 설정한다</li><ol><li>URL에 파일 확장자가 존재</li><li>확장자가 안전하지 않고 컨텐츠 협상 대상도 아닌 경우</li></ol></ul><h4>Media Types</h4><ul><li>Content-Type:application/json만 처리</li><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">@PostMapping(path = "/pets", consumes = "application/json")</div><li>Content-Type:application/json만 처리 안 함</li><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">@PostMapping(path = "/pets", consumes = "!application/json")</div><li>Accept:application/json만 처리</li><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">@GetMapping(path = "/pets/{petId}", produces = "application/json")</div><li>Accept:application/json만 처리 안 함</li><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">@GetMapping(path = "/pets/{petId}", produces = "!application/json")</div><li>클래스 수준의 consumes, produces 가능.</li><p>클래스와 메서드 모두에 적용하는 경우, 메서드의 것만 적용</p><li>MediaType 클래스에 APPLICATION_JSON_UTF8_VALUE 등 상수 존재</li></ul><h4>Parameters, Headers</h4><ul><li>요청 파라미터에 myParam이 존재하는 경우만 처리</li><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">@GetMapping(path = "/pets/{petId}", params = "myParam")</div><li>요청 파라미터에 myParam이 존재하지 않는 경우만 처리</li><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">@GetMapping(path = "/pets/{petId}", params = "!myParam")</div><li>요청 파라미터에 myParam 값이 "myValue"인 경우만 처리</li><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">@GetMapping(path = "/pets/{petId}", params = "myParam=myValue")</div><li>헤더의 경우 params 대신 headers 이용</li></ul></div><h3>Handler Methods</h3><div><h4>Method Arguments</h4><ol>아래 조건을 모두 만족하는 경우, java.util.Optional을 결합하여 사용할 수 있다<li>required 속성이 있는 @RequestParam, @RequestHeader 등의 애너테이션이 적용됨</li><li>required=false임</li></ol><table><tr><th>Argument</th><th>Description</th></tr><tr><td>WebRequest, NativeWebRequest</td><td>서블릿 API를 직접 사용하지 않고 요청에 대한 일반적인 접근 제공</td></tr><tr><td>ServletRequest, ServletResponse</td><td>HttpServletRequest, MultipartRequest 등 임의 서브클래스 사용 가능</td></tr><tr><td>HttpSession</td><td>세션이 반드시 존재하도록 한다. 동시성이 필요한 경우 RequestMappingHandlerAdapter 인스턴스의 synchronizeOnSession를 true로 설정</td></tr><tr><td>PushBuilder</td><td>HTTP/2 리소스 푸시를 위한 Servlet 4.0 push builder API 제공. 클라이언트가 HTTP/2를 지원하지 않으면 null</td></tr><tr><td>Principal</td><td>현재 인증 유저</td></tr><tr><td>HttpMethod</td><td>HTTP 요청 타입</td></tr><tr><td>Locale, TimeZone, ZoneId</td><td>현재 로캐일, 타임존</td></tr><tr><td>InputStream, Reader</td><td>Raw 요청 접근</td></tr><tr><td>OutputStream, Writer</td><td>응답을 직접 쓰려는 경우 사용</td></tr><tr><td>@PathVariable</td><td>URI 경로 획득 <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos-1092929705" target="_self">Goto - URI Patterns</a></td></tr><tr><td>@MatrixVariable</td><td>URI 상의 이름-값 쌍 획득 <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos1654759384" target="_self">Goto - Matrix Variables</a></td></tr><tr><td>@RequestParam</td><td>서블릿 요청 파라미터(URL query, Form data 모두 해당) 획득. Multi-part 파일도 가능.</td></tr><tr><td>@RequestHeader</td><td>요청 헤더 획득</td></tr><tr><td>@CookieValue</td><td>쿠키 획득</td></tr><tr><td>@RequestBody</td><td>HTTP 요청 body 획득. HttpMessageConverter를 통해 지정 타입으로 변환된다</td></tr><tr><td>HttpEntity&lt;B&gt;</td><td>요청 헤더(HttpHeaders) + body(B) 획득. body는 HttpMessageConverter를 통해 지정 타입으로 변환된다</td></tr><tr><td>@RequestPart</td><td>multipart/form-data 요청 획득. 각 part는 HttpMessageConverter를 통해 지정 타입으로 변환된다</td></tr><tr><td>Map, Model, ModelMap</td><td>렌더링에 사용할 모델</td></tr><tr><td>RedirectAttributes</td><td>리다이렉션 쿼리에 덧붙일 속성<a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos2051435547" target="_self">Goto - Redirect Attributes</a>, 리다이렉션 이후 요청까지 임시로 저장할 속성<a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos-1676026937" target="_self">Goto - Flash Attributes</a></td></tr><tr><td>@ModelAttribute</td><td>기저 모델에 존재하는 객체 획득(없으면 생성). 기저와 바인딩되며, 존재하는 검증도 수행된다. <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos406104531" target="_self">Goto - @ModelAttribute</a>. 바인딩을 원하지 않는 경우 @ModelAttribute(binding=false) 설정</td></tr><tr><td>Errors, BindingResult</td><td>@ModelAttribute 인자의 검증 및 바인딩 수행 시 발생한 예외 획득. @RequestBody 또는 @RequestPart 검증 시 발생한 예외 획득. 각 Errors, BindingResult 인자는 검증 대상 바로 다음에 위치해야 한다.</td></tr><tr><td>SessionStatus + class-level @SessionAttributes</td><td>Form 처리가 완료되면 @SessionAttributes로 저장 중인 값을 정리하기 위한 SessionStatus 획득 <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos-2103470842" target="_self">Goto - @SessionAttribute</a></td></tr><tr><td>UriComponentsBuilder</td><td>요청 host, port, scheme, context path, servlet mapping으로 구성된 builder 획득</td></tr><tr><td>@SessionAttribute</td><td>세션에 저장된 임의 인스턴스 접근 <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos-2103470842" target="_self">Goto - @SessionAttribute</a></td></tr><tr><td>@RequestAttribute</td><td>임의 요청 속성 접근 <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos-1461908179" target="_self">Goto - @RequestAttribute</a></td></tr><tr><td>임의 타입</td><td>위 타입 중 어느 것에도 일치하지 않는 단순 타입은 @RequestParam, 그 외에는 @ModelAttribute<br><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java8/src/main/java/io/github/donggi/mvc/controller/Controller.java" displayRange="[98,102,74,82]" lan="java">예1</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java8/src/main/java/io/github/donggi/mvc/controller/Controller2.java" displayRange="[30,34,45,53]" lan="java">예2</button></td></tr></table><h4>Return Values</h4><table><tr><th>Return Type</th><th>Description</th></tr><tr><td>@ResponseBody</td><td>HttpMessageConverter 인스턴스가 반환값을 적절히 응답에 쓴다 <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos5090787" target="_self">Goto - @ResponseBody</a></td></tr><tr><td>HttpEntity&lt;B&gt;, ResponseEntity&lt;B&gt;</td><td>HTTP 헤더(HttpHeaders)와 바디(B)를 포함한 전체 응답을 반환하면 HttpMessageConverter가 적절히 응답에 쓴다<a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos-1311327324" target="_self">Goto - ResponseEntity</a></td></tr><tr><td>HttpHeaders</td><td>응답 헤더 반환. body는 empty.</td></tr><tr><td>String</td><td>뷰 이름을 반환하면 ViewResolver가 적절히 뷰를 선택한다</td></tr><tr><td>View</td><td>렌더링할 뷰</td></tr><tr><td>Map, Model, @ModelAttribute AnyType</td><td>묵시적 모델에 추가될 속성</td></tr><tr><td>ModelAndView</td><td>뷰 + 모델</td></tr><tr><td>void</td><td>void 리턴, null 리턴이 아래 상황에서 이루어졌다면 응답이 완료됐다고 간주한다<ul><li>ServletResponse, OutputStream 인자를 메서드로 받은 경우</li><li>@ResponseStatus를 갖는 경우</li><li>컨트롤러가 ETag, lastModified를 설정한 경우</li></ul>그 외의 경우 "no response body"(REST 컨트롤러), 기본 뷰(HTTP 컨트롤러)를 의미한다</td></tr><tr><td>DeferredResult&lt;V&gt;, ListenableFuture&lt;V&gt;, CompletionStage&lt;V&gt;, CompletableFuture&lt;V&gt;</td><td>위 임의 타입을 임의 스레드에서 비동기적으로 반환 <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos-297540356" target="_self">Goto - DeferredResult</a></td></tr><tr><td>Callable&lt;V&gt;</td><td>위 임의 타입을 Spring MVC 관리 스레드에서 비동기적으로 반환 <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos-107604776" target="_self">Goto - Callable</a></td></tr><tr><td>ResponseBodyEmitter, SseEmitter</td><td>비동기적으로 객체를 전달하면 HttpMessageConverter가 변환하여 쓴다. ResponseEntity의 body로 이용 가능. <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos-990817622" target="_self">Goto - HTTP Streaming</a></td></tr><tr><td>StreamingResponseBody</td><td>비동기적으로 OutputStream에 쓴다. ResponseEntity의 body로 이용 가능. <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos-990817622" target="_self">Goto - HTTP Streaming</a></td></tr><tr><td>Reactive types — Reactor, RxJava, or others through ReactiveAdapterRegistry</td><td>한 번에 여러 값을 전송하는 경우 DeferredResult 대안.</td></tr></table><h4>Type Conversion</h4><p>문자열로 표현되는 요청 인자 ─ @RequestParam, @RequestHeader, @PathVariable, @MatrixVariable, @CookieValue ─ 들을 String 외의 타입으로 받으려면 변환이 필요하다<br>기본 타입과 Date 등 일부 클래스는 자동으로 변환이 가능하다. 전역적인 변환기를 등록하려면 <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos87617553" target="_self">Goto - MVC config - Type Conversion</a>, @Controller, @ControllerAdvice에만 적용되는 변환기를 등록하려면 <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos-1521490412" target="_self">Goto - DataBinder</a> 참고</p><h4>Matrix Variables<span id="pos1654759384" style="padding:0!important;margin:0!important;width:0!important;height:0!important;overflow:hidden!important"></span></h4><ul><li>Java Config <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java7/src/main/java/io/github/donggi/mvc/config/AppConfig.java" displayRange="[10]" lan="java">AppConfig.java</button></li><li>XML Config <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-xml7/src/main/webapp/WEB-INF/app-servlet.xml" lan="xml">app-servlet.xml</button></li><li>Matrix Variable 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java7/src/main/java/io/github/donggi/mvc/controller/MatrixController.java" displayRange="[18,29]" lan="java">MatrixController.java</button></li><li>각 path part 모두 matrix variable을 가질 수 있다 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java7/src/main/java/io/github/donggi/mvc/controller/MatrixController.java" displayRange="[32,44]" lan="java">MatrixController.java</button></li><li>각 path part 별로 matrix variable을 모아 받을 수 있다<button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java7/src/main/java/io/github/donggi/mvc/controller/MatrixController.java" displayRange="[47,65]" lan="java">MatrixController.java</button></li></ul><h4>@RequestParam, @RequestBody</h4><ul><li>Get 요청 query 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java8/src/main/java/io/github/donggi/mvc/controller/Controller.java" displayRange="[22,32]" lan="java">Controller.java</button></li><li>배열 또는 리스트를 이용해 동일 이름의 파라미터들을 모을 수 있다 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java8/src/main/java/io/github/donggi/mvc/controller/Controller.java" displayRange="[35,45]" lan="java">Controller.java</button></li><li>Map&lt;String, String&gt;, MultiValueMap&lt;String, String&gt;로 전체 파라미터를 모을 수 있다 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java8/src/main/java/io/github/donggi/mvc/controller/Controller.java" displayRange="[48,58,61,71]" lan="java">Controller.java</button></li><li>Post 요청 Jackson JSON 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java8/build.gradle" displayRange="[31,31]" lan="gradle">build.gradle</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java8/src/main/java/io/github/donggi/mvc/controller/Controller.java" displayRange="[98,102,85,94]" lan="java">Controller.java</button></li></ul><h4>@RequestHeader</h4><p>특정 이름의 헤더, 또는 전체 헤더 ─ Map&lt;String, String&gt;, MultiValueMap&lt;String, String&gt;, HttpHeaders ─ 획득 가능 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java8/src/main/java/io/github/donggi/mvc/controller/Controller2.java" displayRange="[21,27]" lan="java">Controller2.java</button></p><h4>@ModelAttribute<span id="pos406104531" style="padding:0!important;margin:0!important;width:0!important;height:0!important;overflow:hidden!important"></span></h4><ol>@ModelAttribute로 선언된 인자는 아래 순서에 따라 획득된다<li>이미 Model에 추가된 객체</li><li>@SessionAttribute로 저장된 객체<a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos-2103470842" target="_self">Goto - @SessionAttribute</a></li><li>URI path variable로부터 변환(Converter) <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java8/src/main/java/io/github/donggi/mvc/controller/Controller2.java" displayRange="[30,34,35,43]" lan="java">Controller2.java</button></li><li>기본생성자 호출</li><li>Primary 생성자 호출. 생성 인자는 서블릿 요청으로부터 결정</li></ol><h4>@SessionAttributes, @SessionAttribute<span id="pos-2103470842" style="padding:0!important;margin:0!important;width:0!important;height:0!important;overflow:hidden!important"></span></h4><ul><li>@SessionAttributes는 자동으로 세션에 객체를 저장하고, 완료 시 제거하는 기능을 제공한다 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java8/src/main/java/io/github/donggi/mvc/controller/Controller3.java" displayRange="[15,40,41,56]" lan="java">Controller3.java</button></li><li>@SessionAttribute로 세션 객체를 획득할 수 있다 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java8/src/main/java/io/github/donggi/mvc/controller/Controller4.java" displayRange="[13,35,36,45]" lan="java">Controller4.java</button></li></ul><h4>@RequestAttribute<span id="pos-1461908179" style="padding:0!important;margin:0!important;width:0!important;height:0!important;overflow:hidden!important"></span></h4><p>Filter, HandlerInterceptor 등에 의해 추가된 속성을 획득할 수 있다 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java8/src/main/java/io/github/donggi/mvc/interceptor/Controller5Interceptor.java" displayRange="[9,15]" lan="java">Controller5Interceptor.java</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java8/src/main/java/io/github/donggi/mvc/controller/Controller5.java" displayRange="[14,31]" lan="java">Controller5.java</button></p><h4>Redirect Attributes<span id="pos2051435547" style="padding:0!important;margin:0!important;width:0!important;height:0!important;overflow:hidden!important"></span></h4><ul><li>기본적으로 Model의 속성들은 리다이렉트 URL에 포함된다 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java8/src/main/java/io/github/donggi/mvc/controller/Controller6.java" displayRange="[38,44,21,26,46,50,27,31,52,56]" lan="java">Controller6.java</button></li><li>속성의 자동 추가를 원하지 않는다면, @RequestMapping 메서드에서 RedirectAttributes 매개변수를 명시적으로 이용하면 된다<button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java8/src/main/java/io/github/donggi/mvc/controller/Controller6.java" displayRange="[38,44,32,37,58,62]" lan="java">Controller6.java</button></li><li>전역적으로 설정을 변경하려면 RequestMappingHandlerAdapter의 ignoreDefaultModelOnRedirect 속성을 true로 변경하면 된다</li><p>하위 호환을 위해 false가 기본값이다</p></ul><h4>Flash Attributes<span id="pos-1676026937" style="padding:0!important;margin:0!important;width:0!important;height:0!important;overflow:hidden!important"></span></h4><ul><li>Flash attribute는 다음 요청에서 소비하기 위해 일시적으로 세션에 저장하는 데이터다. 주로 리다이렉션 처리에 이용된다</li><li>임시 속성을 담는 데 FlashMap이 이용되고, FlashMapManager이 FlashMap을 관리한다</li><li>FlashMap은 이전 요청으로부터 전달되는 input, 다음 요청으로 전달할 output으로 구분된다</li><li>@RequestMapping 메서드에서는 input-output FlashMap을 직접 이용하지 않고 RedirectAttributes를 획득하여 사용하면 된다 <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos2051435547" target="_self">Goto - Redirect Attributes</a></li><li>RedirectView는 FlashMap 인스턴스에 대해 리다이렉트 URL과 시각을 기록함으로써, 실제 리다이렉트된 요청에 임시 속성을 전달하게 한다</li><p>그럼에도 불구하고 비동기적으로 빈번하게 요청이 들어오는 경우, 실제로 전달되어야 할 곳이 아닌 다른 요청에 임시 속성을 전달될 가능성이 있다</p></ul><h4>@ResponseBody<span id="pos5090787" style="padding:0!important;margin:0!important;width:0!important;height:0!important;overflow:hidden!important"></span></h4><ul><li>메서드에 @ResponseBody가 적용된 경우 반환 객체를 HTTP 응답으로(HttpMessageConverter) 전송한다. AJAX에 유용.</li><li>Jackson JSON 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java8/build.gradle" displayRange="[31,31]" lan="gradle">build.gradle</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java8/src/main/java/io/github/donggi/mvc/controller/Controller7.java" displayRange="[9]" lan="java">Controller7.java</button></li></ul><h4>ResponseEntity<span id="pos-1311327324" style="padding:0!important;margin:0!important;width:0!important;height:0!important;overflow:hidden!important"></span></h4><p>예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java8/src/main/java/io/github/donggi/mvc/controller/Controller8.java" displayRange="[10]" lan="java">Controller8.java</button></p></div><h3>Model</h3><ul><li>@Controller 또는 @ControllerAdvice 클래스의 메서드에 @ModelAttribute를 적용하면 @RequestMapping 전에 호출되어 모델을 구성한다 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java8/src/main/java/io/github/donggi/mvc/controller/Controller9.java" displayRange="[12]" lan="java">Controller9.java</button></li><li>@ControllerAdvice 안에서 이용하는 경우 여러 컨트롤러에 공유하는 효과가 있다</li><li>@ModelAttribute 메서드는 @RequestMapping 메서드가 사용하는 매개변수 타입들을 사용할 수 있다 ─ @ModelAttribute, 요청 body 관련 부분 제외</li></ul><h3>DataBinder<span id="pos-1521490412" style="padding:0!important;margin:0!important;width:0!important;height:0!important;overflow:hidden!important"></span></h3><ul><li>@Controller, @ControllerAdvice 클래스는 @InitBinder 메서드에서 WebDataBinder 인스턴스를 초기화할 수 있다</li><p>이를 통해 PropertyEditor, Converter, Formatter를 등록할 수 있다 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java8/src/main/java/io/github/donggi/mvc/aop/Controller10Advice.java" displayRange="[12]" lan="java">Controller10Advice.java</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java8/src/main/java/io/github/donggi/mvc/controller/Controller10.java" displayRange="[12]" lan="java">Controller10.java</button></p><li>@InitBinder 메서드는 @RequestMapping 메서드가 사용하는 매개변수 타입들을 사용할 수 있다 ─ @ModelAttribute 제외</li><li>전역적인 변환기 등록은 <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos87617553" target="_self">Goto - MVC config - Type Conversion</a> 참고</li></ul><h3>Exceptions<span id="pos1895376872" style="padding:0!important;margin:0!important;width:0!important;height:0!important;overflow:hidden!important"></span></h3><ul><li>@Controller, @ControllerAdvice 클래스는 예외 처리를 위한 @ExceptionHandler 메서드를 가질 수 있다.</li><li>발생한 최상위 예외 또는 가장 가까운 원인 예외 타입을 기준으로 매칭된다 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java4/src/main/java/io/github/donggi/mvc/controller/HelloController.java" displayRange="[10]" lan="java">HelloController.java</button></li><li>둘 이상의 예외 타입을 처리하려는 경우, 공통 부모 클래스를 인자로 하면 된다.</li><li>value 속성으로 특정 예외들을 명시 가능</li><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">@ExceptionHandler({FileSystemException.class, RemoteException.class})</div><li>@ControllerAdvice 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-mvc/src/main/java/io/github/donggi/advice/UnhandledExceptionAdvice.java" displayRange="[6]" lan="java">UnhandledExceptionAdvice.java</button></li></ul><div><h4 class="fake">Method Arguments</h4><table><caption>가능한 메서드 인자</caption><tr><td>Argument</td><td>Description</td></tr><tr><td>Exception</td><td>발생 예외. 임의 서브클래스 사용 가능</td></tr><tr><td>HandlerMethod</td><td>예외 발생 메서드</td></tr><tr><td>WebRequest, NativeWebRequest</td><td>서블릿 API를 직접 사용하지 않고 요청에 대한 일반적인 접근 제공</td></tr><tr><td>ServletRequest, ServletResponse</td><td>HttpServletRequest, MultipartRequest 등 임의 서브클래스 사용 가능</td></tr><tr><td>HttpSession</td><td>세션이 반드시 존재하도록 한다. 동시성이 필요한 경우 RequestMappingHandlerAdapter 인스턴스의 synchronizeOnSession를 true로 설정</td></tr><tr><td>Principal</td><td>현재 인증 유저</td></tr><tr><td>HttpMethod</td><td>HTTP 요청 타입</td></tr><tr><td>Locale, TimeZone, ZoneId</td><td>현재 로캐일, 타임존</td></tr><tr><td>OutputStream, Writer</td><td>응답을 직접 쓰려는 경우 사용</td></tr><tr><td>Map, Model, ModelMap</td><td>예외 응답을 위한 모델. 항상 비어있음</td></tr><tr><td>RedirectAttributes</td><td>리다이렉션 쿼리에 덧붙일 속성<a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos2051435547" target="_self">Goto - Redirect Attributes</a>, 리다이렉션 이후 요청까지 임시로 저장할 속성<a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos-1676026937" target="_self">Goto - Flash Attributes</a></td></tr><tr><td>@SessionAttribute</td><td>세션에 저장된 임의 인스턴스 접근 <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos-2103470842" target="_self">Goto - @SessionAttribute</a></td></tr><tr><td>@RequestAttribute</td><td>임의 요청 속성 접근 <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos-1461908179" target="_self">Goto - @RequestAttribute</a></td></tr></table><h4 class="fake">Return Values</h4><table><caption>가능한 반환값</caption><tr><td>Return</td><td>Description</td></tr><tr><td>@ResponseBody</td><td>HttpMessageConverter 인스턴스가 반환값을 적절히 응답에 쓴다 <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos5090787" target="_self">Goto - @ResponseBody</a></td></tr><tr><td>HttpEntity&lt;B>, ResponseEntity&lt;B></td><td>HTTP 헤더와 바디를 포함한 전체 응답을 반환하면 HttpMessageConverter가 적절히 응답에 쓴다 <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos-1311327324" target="_self">Goto - ResponseEntity</a></td></tr><tr><td>String</td><td>뷰 이름을 반환하면 ViewResolver가 적절히 뷰를 선택한다</td></tr><tr><td>View</td><td>렌더링할 뷰</td></tr><tr><td>Map, Model, @ModelAttribute AnyType</td><td>묵시적 모델에 추가될 속성</td></tr><tr><td>ModelAndView</td><td>뷰 + 모델</td></tr><tr><td>void</td><td>void 리턴, null 리턴이 아래 상황에서 이루어졌다면 응답이 완료됐다고 간주한다<ul><li>ServletResponse, OutputStream 인자를 메서드로 받은 경우</li><li>@ResponseStatus를 갖는 경우</li><li>컨트롤러가 ETag, lastModified를 설정한 경우</li></ul>그 외의 경우 "no response body"(REST 컨트롤러), 기본 뷰(HTTP 컨트롤러)를 의미한다</td></tr></table><h4 class="fake">REST API 전역 예외 처리</h4><p>@ControllerAdvice 클래스가 ResponseEntityExceptionHandler를 상속함으로써 스프링 내부 예외를 자동으로 처리하고 ResponseEntity로 반환할 수 있다</p></div><h3>Controller Advice</h3><ul><li>@ExceptionHandler, @InitBinder, @ModelAttribute 메서드는 @Controller 뿐만 아니라 @ControllerAdvice, @RestControllerAdvice 클래스도 가질 수 있다</li><p>적용 범위를 제한하지 않은 경우(default) 모든 요청에 적용된다</p><li>@RestControllerAdvice = @ControllerAdvice + @ResponseBody로, @ExceptionHandler 메서드가 응답을 반환함을 의미한다</li><li>@ExceptionHandler 메서드는 @Controller의 것이 먼저 실행되고, @InitBinder, @ModelAttribute 메서드는 @Controller의 것이 나중에 실행된다</li></ul></div><h2>Functional Endpoints</h2><div><h3>Overview</h3><ul><li>WebMvc.fn에서 HTTP 요청은 HandlerFunction을 통해 처리된다</li><p><strong>↓ @FunctionalInterface HandlerFunction</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">// org.springframework.web.servlet.function Since 5.2
T handle(ServerRequest request)
// org.springframework.web.reactive.function.server Since 5.0
Mono&lt;T&gt; handle(ServerRequest request)</div><li>HTTP 요청에 대한 HandlerFunction의 선택은 RouterFunction을 통해 이루어진다</li><p><strong>↓ @FunctionalInterface RouterFunction</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">// org.springframework.web.servlet.function Since 5.2
Optional&lt;HandlerFunction&lt;T>> route(ServerRequest request)
// org.springframework.web.reactive.function.server Since 5.0
Mono&lt;HandlerFunction&lt;T>> route(ServerRequest request)</div><li>정의된 RouterFunction 빈들은 RouterFunction#andOther()를 통해 합쳐진다</li><li>RouterFunctions.route()가 RouterFunction 빌더를 제공한다 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java9/src/main/java/io/github/donggi/mvc/config/AppConfig.java" lan="java">AppConfig.java</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java9/src/main/java/io/github/donggi/mvc/handler/Handler1.java" displayRange="[9]" lan="java">Handler1.java</button></li></ul><h3>HandlerFunction</h3><ul><li>ServerRequest</li><p>HTTP 요청에 대한 불변 객체. HTTP 요청 방식, URI, 헤더, 쿼리 인자, 요청 본문(body)을 제공한다 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java9/src/main/java/io/github/donggi/mvc/handler/Handler2.java" displayRange="[19]" lan="java">Handler2.java</button></p><li>ServerResponse</li><p>HTTP 응답에 대한 불변 객체. <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java9/src/main/java/io/github/donggi/mvc/handler/Handler2.java" displayRange="[19]" lan="java">Handler2.java</button></p></ul><h3>RouterFunction</h3><ul><li>RequestPredicates 유틸리티 클래스가 유용한 RequestPredicate들을 제공한다</li><p>RequestPredicate#and, or을 이용해 여러 predicate을 조합할 수 있다</p><li>각 라우터는 순서대로 평가되고, 가장 처음으로 매칭되는 핸들러가 요청을 처리한다</li><li>중첩 경로에 대한 라우팅 예</li><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">import static org.springframework.web.servlet.function.RouterFunctions.route;

route()
    .path("/person", builder -> builder
        .GET("/{id}", accept(APPLICATION_JSON), handler::getPerson)
        .GET("", accept(APPLICATION_JSON), handler::listPeople)
        .POST("/person", handler::createPerson))
    .build();

route()
    .path("/person", b1 -> b1
        .nest(accept(APPLICATION_JSON), b2 -> b2
            .GET("/{id}", handler::getPerson)
            .GET("", handler::listPeople))
        .POST("/person", handler::createPerson))
    .build();</div></ul><h3>Filtering Handler Functions</h3><p>before, after, filter를 이용해 사전/사후 작업을 정의할 수 있다</p><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">route()
    .path("/person", b1 -> b1
        .nest(accept(APPLICATION_JSON), b2 -> b2
            .GET("/{id}", handler::getPerson)
            .GET("", handler::listPeople)
            .before(request -> ServerRequest.from(request).header("X-RequestHeader", "Value").build()))
        .POST("/person", handler::createPerson))
    .after((request, response) -> logResponse(response)) 
    .build();</div></div><h2>URI Links</h2><div><h3>UriComponents</h3><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">var uriComponents = UriComponentsBuilder
                        .fromUriString("https://example.com/hotels/{hotel}")
                        .queryParam("q", "{q}").encode().build();
URI uri = uriComponents.expand("Westin", "123").toUri();</div><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">URI uri = UriComponentsBuilder
            .fromUriString("https://example.com/hotels/{hotel}?q={q}")
            .build("Westin", "123");</div><h3>UriBuilder</h3><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">var baseUrl = "https://example.com";
var uriBuilderFactory = new DefaultUriBuilderFactory(baseUrl);
URI uri = uriBuilderFactory.uriString("/hotels/{hotel}")
            .queryParam("q", "{q}").build("Westin", "123");</div><h3>URI Encoding</h3><ul><li>UriComponentsBuilder#encode()</li><p>URI 템플릿을 먼저 인코딩. URI 변수들은 할당되는대로 인코딩</p><li>UriComponents#encode()</li><p>URI 변수들이 할당된 후 전체 인코딩</p><li>DefaultUriBuilderFactory#setEncodingMode()</li><ul><li>EncodingMode.TEMPLATE_AND_VALUES Since 5.0.8 : URI 템플릿을 먼저 인코딩. URI 변수들은 할당되는대로 인코딩</li><li>EncodingMode.URI_COMPONENT : URI 변수들이 할당된 후 전체 인코딩</li><li>EncodingMode.VALUES_ONLY : URI 변수만 UriUtils#encodeUriVariables()으로 인코딩</li><li>EncodingMode.NONE : 인코딩 안 함</li></ul></ul><h3>Relative Servlet Requests</h3><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">HttpServletRequest request;
// Re-uses host, scheme, port, path and query string...
var builder = ServletUriComponentsBuilder.fromRequest(request)
                .replaceQueryParam("accountId", "{id}")
                .build().expand("123").encode();</div><h3>Links in Controllers</h3><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">@Controller
@GetMapping("/path1/{val1}")
public class C {
    @GetMapping("/path2/{val2}")
    public ModelAndView methodName() { }
}

var uriComponents = MvcUriComponentsBuilder
                        .fromMethodName(C.class, "methodName", "value2")
                        .buildAndExpand("value1");</div><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">UriComponentsBuilder base = ServletUriComponentsBuilder.fromCurrentContextPath().path("/en");
MvcUriComponentsBuilder builder = MvcUriComponentsBuilder.relativeTo(base);</div></div><h2>Asynchronous Requests</h2><div><h3>Configuration</h3><p>요청 비동기 처리를 위해 서블릿 컨테이너 수준의 옵션을 설정해야 한다.</p><div><h4 class="fake">Servlet Container</h4><ul><li>Java Config</li><p>AbstractAnnotationConfigDispatcherServletInitializer를 이용하면 된다</p><li>web.xml</li><ul><li>DispatcherServlet, Filter 정의에 &lt;async-supported>true&lt;/async-supported></li><li>필터 매핑에 &lt;dispatcher>ASYNC&lt;/dispatcher></li></ul></ul><h4 class="fake">Spring MVC</h4><ul><li>Java Config</li><p>WebMvcConfigurer의 configureAsyncSupport 재정의</p><li>XML Config</li><p>&lt;mvc:annotation-driven> 안에 &lt;async-support> 정의</p></ul><ul>↓ 설정 가능한 옵션들<li>timeout : 설정하지 않으면 서블릿 컨테이너의 것이 적용된다</li><p>timeout은 DeferredResult, ResponseBodyEmitter, SseEmitter, WebAsyncTask 각각에서도 설정 가능하다</p><li>AsyncTaskExecutor : 설정하지 않으면 SimpleAsyncTaskExecutor가 이용된다</li><li>DeferredResultProcessingInterceptor, CallableProcessingInterceptor</li></ul></div><h3>DeferredResult<span id="pos-297540356" style="padding:0!important;margin:0!important;width:0!important;height:0!important;overflow:hidden!important"></span></h3><p>별개 스레드에서 값을 쓴다 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java10/src/main/java/io/github/donggi/mvc/controller/Controller1.java" displayRange="[9]" lan="java">Controller1.java</button></p><h3>Callable<span id="pos-107604776" style="padding:0!important;margin:0!important;width:0!important;height:0!important;overflow:hidden!important"></span></h3><p>Callable에서 값을 반환한다 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java10/src/main/java/io/github/donggi/mvc/controller/Controller2.java" displayRange="[7]" lan="java">Controller2.java</button></p><h3>Processing</h3><div><h4>Interception</h4><ul><li>WebMvcConfigurer 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java10/src/main/java/io/github/donggi/mvc/config/AppConfig.java" displayRange="[12]" lan="java">AppConfig.java</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java10/src/main/java/io/github/donggi/mvc/interceptor/DeferredResultInterceptor.java" displayRange="[8]" lan="java">DeferredResultInterceptor.java</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java10/src/main/java/io/github/donggi/mvc/interceptor/CallableInterceptor.java" displayRange="[9]" lan="java">CallableInterceptor.java</button></li><li>DeferredResult#onTimeout 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java10/src/main/java/io/github/donggi/mvc/controller/Controller3.java" displayRange="[9]" lan="java">Controller3.java</button></li><li>WebAsyncTask 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java10/src/main/java/io/github/donggi/mvc/controller/Controller4.java" displayRange="[7]" lan="java">Controller4.java</button></li></ul><h4>Compared to WebFlux</h4><ul><li>Servlet 3.0에 추가된 비동기 처리는 Filter-Servlet 체인에서 벗어나 ─ 컨테이너 스레드는 해제된다 ─ 결과를 대기한다</li><p>응답을 쓰기 위해 별도 스레드가 이용되며, IO 자체는 blocking이다</p><li>반면 WebFlux는 Servlet API를 따르지 않으며, 최초 설계부터 비동기적이다</li><p>요청 처리에 대한 모든 단계가 비동기적으로 처리될 수 있다. IO는 non-blocking이다</p></ul></div><h3>HTTP Streaming<span id="pos-990817622" style="padding:0!important;margin:0!important;width:0!important;height:0!important;overflow:hidden!important"></span></h3><div><h4>ResponseBodyEmitter</h4><p>각 객체들은 HttpMessageConverter를 통해 변환된다. <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java10/src/main/java/io/github/donggi/mvc/controller/Controller5.java" displayRange="[9]" lan="java">Controller5.java</button></p><h4>SseEmitter</h4><p>ResponseBodyEmitter의 서브클래스로, Server-Sent Events를 지원한다. <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java10/src/main/java/io/github/donggi/mvc/controller/Controller6.java" displayRange="[10]" lan="java">Controller6.java</button></p><h4>StreamingResponseBody</h4><p>Converter를 거치지 않고 OutputStream에 직접 쓴다<button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java10/src/main/java/io/github/donggi/mvc/controller/Controller7.java" displayRange="[7]" lan="java">Controller7.java</button></p></div><h3>Disconnects</h3><p>Servlet API는 클라이언트 연결 종료를 통지하지 않음에 유의.</p></div><h2>CORS<span id="pos2074541" style="padding:0!important;margin:0!important;width:0!important;height:0!important;overflow:hidden!important"></span></h2><div><h3>@CrossOrigin</h3><ul>↓ 기본 설정<li>모든 origin 허용</li><li>모든 header 허용</li><li>매핑에 일치하는 모든 HTTP method 허용</li><li>allowedCredentials 비허용</li><li>maxAge 30분</li></ul><h3>Global Configuration</h3><ul><li>Java Configuration</li><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">@Configuration
@EnableWebMvc
public class WebConfig implements WebMvcConfigurer {
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/api1/**")...;
        registry.addMapping("/api2/**")...;
    }
}</div><li>XML Configuration</li><p><strong>↓ xml</strong></p><div lan="xml" class="as-code code-div w3-leftbar w3-border-green">&lt;mvc:cors>
    &lt;mvc:mapping path="/api/**"
        allowed-origins="https://domain1.com, https://domain2.com"
        allowed-methods="GET, PUT"
        allowed-headers="header1, header2, header3"
        exposed-headers="header1, header2" allow-credentials="true"
        max-age="123" />
    &lt;mvc:mapping path="/resources/**"
        allowed-origins="https://domain1.com" />
&lt;/mvc:cors></div></ul><h3>CorsFilter</h3><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">var config = new CorsConfiguration();
config.setAllowCredentials(true);
config.addAllowedOrigin("https://domain1.com");
config.addAllowedHeader("*");
config.addAllowedMethod("*");

var source = new UrlBasedCorsConfigurationSource();
source.registerCorsConfiguration("/**", config);

var filter = new CorsFilter(source);</div></div><h2>HTTP Caching</h2><div><h3>CacheControl</h3><p>Cache-Control 헤더 정보를 의미한다</p><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">// Cache for an hour - "Cache-Control: max-age=3600"
CacheControl.maxAge(1, TimeUnit.HOURS);
// Prevent caching - "Cache-Control: no-store"
CacheControl.noStore();</div><h3>Controllers</h3><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">@RequestMapping(...)
public ResponseEntity&lt;Something> method(...) {
    return ResponseEntity
            .ok()
            .cacheControl(CacheControl.maxAge(30, TimeUnit.DAYS))
            ...;
}</div></div><h2>View Technologies<span id="pos701800517" style="padding:0!important;margin:0!important;width:0!important;height:0!important;overflow:hidden!important"></span></h2><div><h3>Thymeleaf</h3><p>Spring MVC 연동은 Thymeleaf 프로젝트가 관리한다. 다음 빈들이 필요하다 ─ ServletContextTemplateResolver, SpringTemplateEngine, ThymeleafViewResolver <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/reminder/src/main/java/io/github/donggi/reminder/config/ThymeleafConfig.java" displayRange="[21]" lan="java">ThymeleafConfig.java</button></p><h3>FreeMarker</h3><p>예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java11/src/main/java/io/github/donggi/mvc/config/AppConfig.java" displayRange="[12]" lan="java">AppConfig.java</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java11/src/main/java/io/github/donggi/mvc/controller/MyController.java" displayRange="[7]" lan="java">MyController.java</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java11/src/main/webapp/WEB-INF/freemarker/hello.ftl" lan="html">hello.ftl</button></p><h3>JSP, JSTL</h3><div><h4 class="fake">View Resolvers</h4><p>ResourceBundleViewResolver 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java12/src/main/java/io/github/donggi/mvc/config/AppConfig.java" displayRange="[13]" lan="java">AppConfig.java</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java12/src/main/webapp/WEB-INF/classes/my_views.properties" lan="ini">my_views.properties</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java12/src/main/java/io/github/donggi/mvc/controller/Controller1.java" displayRange="[7]" lan="java">Controller1.java</button><br>InternalResourceViewResolver 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java13/src/main/java/io/github/donggi/mvc/config/AppConfig.java" displayRange="[13]" lan="java">AppConfig.java</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java13/src/main/java/io/github/donggi/mvc/controller/Controller1.java" displayRange="[7]" lan="java">Controller1.java</button></p><h4 class="fake">JSPs versus JSTL</h4><p>JSTL(JSP Standard Tag Library)을 이용할 때에는 뷰 클래스로 JstlView를 이용해야 한다 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java12/build.gradle" displayRange="[31,31]" lan="gradle">build.gradle</button></p><h4 class="fake">Spring’s JSP Tag Library</h4><p>spring-webmvc.jar 안의 spring.tld에 스프리이 제공하는 태그 정의가 담겨 있다. 또는 <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green" href="https://docs.spring.io/spring-framework/docs/5.2.8.RELEASE/javadoc-api/org/springframework/web/servlet/tags/package-summary.html#package.description">package.description</a> 참고</p></div></div><h2>MVC Config</h2><div><h3>MVC 구성 켜기</h3><ol><li>Java 기반 설정</li><p><strong>↓ java</strong></p><div lan="java" class="as-code code-div w3-leftbar w3-border-green">@Configuration
@EnableWebMvc
public class WebConfig { }</div><li>XML 기반 설정</li><p><strong>↓ xml</strong></p><div lan="xml" class="as-code code-div w3-leftbar w3-border-green">&lt;mvc:annotation-driven></div></ol><h3>Type Conversion<span id="pos87617553" style="padding:0!important;margin:0!important;width:0!important;height:0!important;overflow:hidden!important"></span></h3><ul><li>@Controller, @ControllerAdvice에만 적용되는 변환기를 등록하려면 <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green goto" href="#pos-1521490412" target="_self">Goto - DataBinder</a> 참고</li><li>전역 Java Configuration 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java14/src/main/java/io/github/donggi/mvc/config/AppConfig.java" displayRange="[10]" lan="java">AppConfig.java</button></li><li>XML에서는 FormattingConversionServiceFactoryBean 빈을 정의하면 된다</li></ul><h3>Validation</h3><h3>Interceptors<span id="pos63735001" style="padding:0!important;margin:0!important;width:0!important;height:0!important;overflow:hidden!important"></span></h3><ol><li>Java 기반 설정 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-java3/src/main/java/io/github/donggi/mvc/config/AppConfig.java" displayRange="[19]" lan="java">AppConfig.java</button></li><p>addInterceptors(InterceptorRegistry)를 재정의하여 추가</p><li>XML 기반 설정 예 <button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/mvc-xml4/src/main/webapp/WEB-INF/app-servlet.xml" lan="xml">app-servlet.xml</button></li><p>mvc:interceptors 태그 안에 작성</p></ol><h3>Content Types<span id="pos935569767" style="padding:0!important;margin:0!important;width:0!important;height:0!important;overflow:hidden!important"></span></h3><h3>Message Converters</h3><h3>View Controllers</h3><h3>View Resolvers<span id="pos-1794183043" style="padding:0!important;margin:0!important;width:0!important;height:0!important;overflow:hidden!important"></span></h3><h3>Static Resources</h3><h3>Default Servlet</h3><h3>Path Matching<span id="pos993156397" style="padding:0!important;margin:0!important;width:0!important;height:0!important;overflow:hidden!important"></span></h3><h3>Advanced Java Config</h3><h3>Advanced XML Config</h3></div><h2>HTTP/2</h2><h2>REST Clients</h2><h2>Testing</h2><h2>WebSockets</h2><h2>Other Web Frameworks</h2></div><details><details><summary>@RequestMapping 사용 시 가능한 파라미터 타입</summary><ol><li>POJO : 각 POJO 클래스<button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-mvc/src/main/java/io/github/donggi/controller/LoginController.java" lan="java">예시1</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-mvc/src/main/webapp/WEB-INF/view/login.jsp" lan="xml">login.jsp</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-mvc/src/main/java/io/github/donggi/controller/BulkLoginController.java" lan="java">예시2</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-mvc/src/main/webapp/WEB-INF/view/bulkLogin.jsp" lan="xml">bulkLogin.jsp</button></li><li>POJO로의 바인딩 결과 : Errors, BindingResult</li><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-mvc/src/main/java/io/github/donggi/controller/LoginController.java" lan="java">@Valid, @InitBinder 예시</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-mvc/src/main/java/io/github/donggi/validator/LoginRequestValidator.java" lan="java">Validator 예시</button></ol></details></details><li>Spring 트랜잭션 사용하기</li><ul><li>관련 클래스</li><p>AbstractPlatformTransactionManager ← DataSourceTransactionManager(JDBC), HibernateTransactionManager, JtaTransactionManager</p><li>예시 코드</li><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-transaction/pom.xml" lan="xml">pom.xml »</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-transaction/src/main/resources/applicationContext.xml" lan="xml">applicationContext.xml »</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-transaction/src/main/java/io/github/donggi/service/NameService.java" lan="java">NameService.java »</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-transaction/src/test/java/Test.java" lan="java">Test.java »</button></ul><hr><details><summary>Spring JUnit</summary><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-transaction/src/test/java/Test.java" lan="java">예시 코드 1 »</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Eclipse/spring-mvc/src/test/java/Test.java" lan="java">예시 코드 2 »</button></details><hr><details><summary>Spring Boot</summary><ul><li>라이브러리 버전 관리, 로깅, DataSource 등의 일반적인 설정을 자동화하고, 사용자는 필요한 부분만 변경하면 된다</li><li>톰캣 등 WAS 내장하여 실행 가능</li><li>모듈화된 기능들을 <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green" href="https://start.spring.io/">조합</a>하여 빠르게 신규 프로젝트 시작 가능</li></ul><details><summary>Spring Boot Web Microservice</summary><ol><li>예시 코드</li><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/rest-microservice/pom.xml" lan="xml">pom.xml</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/rest-microservice/src/main/java/io/github/donggi/controller/HelloController.java" lan="java">HelloController.java</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/rest-microservice/src/test/java/io/github/donggi/controller/HelloControllerTest.java" lan="java">HelloControllerTest.java</button><li>스프링 부트 마이크로서비스는 실행에 필요한 모든 의존 라이브러리, HTTP 리스너 등을 하나의 jar로 패키징한다</li><div class="w3-center w3-margin-bottom"><img src="/imgs/20191006_180335.png" class="w3-round"></div><div class="w3-center w3-margin-bottom"><img src="/imgs/20191006_180348.png" class="w3-round"></div><div class="w3-center w3-margin-bottom"><img src="/imgs/20191006_180401.png" class="w3-round"></div><li>mvn install하면 bootJar가 빌드된다<br>java -jar target/rest-microservice-0.0.1-SNAPSHOT.jar</li></ol></details><details><summary>Gradle 프로젝트 빌드 및 실행</summary><ol><li>bootRun 실행</li>gradle app-name:bootRun -Pprofile=dev<li>bootJar 빌드</li>gradle app-name:bootJar -x test<li>bootJar 실행</li>java -jar -Dspring.profiles.active=dev app-name.jar</ol></details><details open=""><summary>application.properties 서버 포트 지정</summary>server.port=18080<br>tomcatPort=18009<br>tomcatRedirectPort=18443</details><details><summary>Spring Boot Reactive Web Microservice</summary><ol><li>예시 코드</li><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/reactive-webflux/pom.xml" lan="xml">pom.xml</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/reactive-webflux/src/main/java/io/github/donggi/controller/HelloController.java" lan="java">HelloController.java</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/reactive-webflux/src/test/java/io/github/donggi/controller/HelloControllerTest.java" lan="java">HelloControllerTest.java</button><div class="w3-center w3-margin-bottom"><img src="/imgs/20191008_110029.png" class="w3-round"></div><li>리액티브 스트림 : java.util.concurrent.Flow</li><ul><li>Publisher : 발행자. subscribe​(Subscriber)</li><li>Subscriber : 구독자. onSubscribe(Subscription), onNext(T), onError(Throwable), onComplete(Void)</li><li>Subscription : 구독. request(long), cancel(Void)</li><li>Processor extends Subscriber, Publisher : 발행자 + 구독자</li></ul><li>리액터의 발행자 Processor</li><ul><li>reactor.core.publisher.Mono : 0 또는 1개의 이벤트 발행</li><li>reactor.core.publisher.Flux : 0 또는 n개의 이벤트 발행</li></ul></ol></details><details><summary>CORS 허용</summary><ol><li>컨트롤러 클래스 또는 메서드에 @CrossOrigin 설정</li><li>WebMvcConfigurer 빈의 addCorsMappings(CorsRegistry)를 재정의하여 앱 전체 설정 변경</li></ol></details><details><summary>Spring Config Server</summary><ol><li>Config Server 선택</li><div class="w3-center w3-margin-bottom"><img src="/imgs/20191009_095724.png" class="w3-round"></div><li>예시 코드</li><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/config-server/src/main/resources/bootstrap.properties" lan="text">bootstrap.properties</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/config-server/src/main/java/io/github/donggi/ConfigServerApplication.java" lan="java">@EnableConfigServer</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Config/webapp.properties" lan="text">webapp.properties</button><br><li>접근 예</li>http://localhost:28888/webapp/default<br>http://localhost:28888/webapp/default/master/test.xml<ul><li>/{application}/{profile}[/{label}]</li><li>/{application}-{profile}.yml</li><li>/{label}/{application}-{profile}.yml</li><li>/{application}-{profile}.properties</li><li>/{label}/{application}-{profile}.properties</li><div class="w3-center w3-margin-bottom"><img src="/imgs/20191009_115402.png" class="w3-round"></div></ul><li>갱신 : http://localhost:28888/actuator/refresh</li></ol></details><details><summary>Spring Config Client</summary><ol><li>Config Client, Actuator 선택</li><div class="w3-center w3-margin-bottom"><img src="/imgs/20191009_124833.png" class="w3-round"></div><li>예시 코드</li><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/Config/config-client.properties" lan="text">config-client.properties</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/config-client/src/main/resources/bootstrap.properties" lan="text">bootstrap.properties</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/config-client/src/main/java/io/github/donggi/controller/HelloController.java" lan="java">HelloController.java</button><li>접근 예 http://localhost:18888/hello</li><div class="w3-center w3-margin-bottom"><img src="/imgs/20191009_122755.png" class="w3-round"></div><li>갱신 : POST http://localhost:18888/actuator/refresh</li>http://localhost:18888/actuator/에 접속했을 때 /refresh가 보이지 않는다면 management.security.enabled=false, management.endpoints.web.exposure.include=* 2개 설정 확인<div class="w3-center w3-margin-bottom"><img src="/imgs/20191009_124710.png" class="w3-round"></div><div class="w3-center w3-margin-bottom"><img src="/imgs/20191009_124647.png" class="w3-round"></div></ol></details><ol><li>@Async</li>메서드를 스프링이 관리하는 ThreadExecutor에서 비동기적으로 실행하는 프록시를 생성한다.<button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/web-app/src/main/java/io/github/donggi/WebAppApplication.java" lan="java">@EnableAsync »</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/web-app/src/main/java/io/github/donggi/controller/SleepController.java" lan="java">@Async »</button><li>@Scheduled</li>메서드를 명시적으로 호출하지 않아도 스케쥴대로 실행된다.<button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/web-app/src/main/java/io/github/donggi/WebAppApplication.java" lan="java">@EnableScheduling »</button><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/web-app/src/main/java/io/github/donggi/controller/HelloController.java" lan="java">@Scheduled »</button></ol></details><hr><details><summary>WebSocket</summary><ul><li>HTTP/1.1 업그레이드 기능을 이용해 기존 HTTP/HTTPS를 웹 소켓 연결 WS/WSS로 그대로 전환</li>사용하던 80/443포트 그대로 연결하므로 방화벽의 차단에도 안전. 프록시 서버가 HTTP 업그레이드를 처리하지 않는다면 WSS를 이용.<li>웹소켓 API Since JavaEE 7</li><ul><li>javax.websocket : 클라이언트/서버 공통 기능</li><ul><li>WebSocketContainer</li>웹소켓 클라이언트 기능. connectToServer()<li>ContainerProvider</li>웹소켓 클라이언트 인스턴스 획득을 위한 getWebSocketContainer()<li>@interface ClientEndpoint</li>POJO가 클라이언트측 웹소켓임을 나타낸다. 해당 클래스는 메서드는 @OnOpen, @OnClose, @OnError, @OnMessage 애너테이트될 수 있다<li>@interface OnOpen + OnClose</li>선택적 Session 매개변수, 선택적 EndpointConfig 매개변수, 0 ~ n개 @PathParam String 매개변수를 가질 수 있다<li>@interface OnError</li>선택적 Session 매개변수, Throwable 매개변수, 0 ~ n개 @PathParam String 매개변수를 가질 수 있다<li>@interface OnMessage</li>선택적 Session 매개변수, 0 ~ n개 @PathParam String 매개변수, 아래 중 하나의 메시지 매개변수<ul><li>텍스트 메시지 처리</li><ul><li>전체 메시지 String</li><li>메시지로부터 변환되는 Java primitive or class</li><li>메시지 청크 String and boolean pair : 마지막 메시지는 true</li><li>전체 메시지 Reader</li><li>Decoder.Text or Decoder.TextStream</li></ul><li>이진 메시지 처리</li><ul><li>전체 메시지 byte[] or ByteBuffer</li><li>메시지 청크 (byte[] or ByteBuffer) and boolean pair : 마지막 메시지는 true</li><li>전체 메시지 InputStream</li><li>Decoder.Binary or Decoder.BinaryStream</li></ul><li>퐁 메시지 처리 : PongMessage</li></ul></ul><li>javax.websocket.server : 서버 전용 기능</li><ul><li>ServerContainer extends WebSocketContainer</li>ServerEndpointConfig 인스턴스 또는 @ServerEndpoint 클래스 등록</ul></ul><li>Spring Boot 예시</li><ul><li>웹소켓 API를 사용하기 위해 javax.websocket-api, 스프링의 관리를 위해 spring-websocket 필요<button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/web-app/pom.xml" lan="xml">pom.xml »</button></li><li>스프링이 Endpoint를 찾아 알아서 빈을 생성하도록 ServerEndpointExporter 생성<button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/web-app/src/main/java/io/github/donggi/config/WebSocketConfig.java" lan="java">WebSocketConfig.java »</button></li><li>@ServerEndpoint 예<button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/web-app/src/main/java/io/github/donggi/websocket/Echo.java" lan="java">Echo.java »</button></li>@ServerEndpoint 안에서 @Autowired 주입을 위해 @ServerEndpoint(configurator = ServerEndpointConfigurator.class)를 설정하고 @PostConstruct에서 주입을 실행했음을 참고<button class="w3-btn w3-round w3-round-xxlarge w3-small w3-teal btn-code" title="/Repositories/STS/web-app/src/main/java/io/github/donggi/config/ServerEndpointConfigurator.java" lan="java">ServerEndpointConfigurator.java »</button></ul></ul></details><div class="w3-container w3-leftbar w3-border-green w3-white hover-template" id="template-jsr330"><p>별도 jar 포함 필요</p><p><strong>↓ xml</strong></p><div lan="xml" class="as-code code-div w3-leftbar w3-border-green">&lt;dependency>
    &lt;groupId>javax.inject&lt;/groupId>
    &lt;artifactId>javax.inject&lt;/artifactId>
    &lt;version>1&lt;/version>
&lt;/dependency></div><p><strong>↓ gradle</strong></p><div lan="gradle" class="as-code code-div w3-leftbar w3-border-green">implementation 'javax.inject:javax.inject:1'</div></div></div><hr>&copy; 2020. <a href="mailto:hi.donggi@gmail.com">Donggi Kim</a> all rights reserved.<a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green" href="/LICENSE">LICENSE</a></div></body></html>