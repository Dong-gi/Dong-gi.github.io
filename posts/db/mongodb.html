<html lnag="ko"><meta charset="UTF-8"><meta name="viewport"content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="google-site-verification"content="aH-DyzdytYQ0NPHNQFcs5dVoiu5YNs6CEEHYgqDmAFM"><meta name="author"content="Donggi Kim &lt;hi.donggi@gmail.com&gt;"><meta name="keywords"content="MongoDB, NoSQL, BSON"><meta name="description"content="MongoDB 주요 내용 정리"><title>MongoDB 정리</title><link id="w3css"rel="stylesheet"href="/source/w3.css"><link id="highlight-style"rel="stylesheet"href="/source/xcode.css"><link id="default-style"rel="stylesheet"href="/source/default.css"><script id="highlight-js"src="/source/highlight.pack.js"></script><script id="default-js"src="/source/default.min.js"></script><script id="dsq-count-scr"src="//donggi.disqus.com/count.js"async></script><script id="google-analytics"src="https://www.googletagmanager.com/gtag/js?id=UA-143098403-1"async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-143098403-1")</script><div id="sidebar"class="w3-bar-block w3-sidebar w3-animate-left"><hr><a href="javascript:closeSidebar();"class="w3-bar-item w3-button">Close &times;</a><hr><div id="marker-list"></div><hr><div id="post-list"><details open=""id="dir-1627423780"class="w3-small file-list"title="카테고리"><summary>카테고리</summary><ul><details id="dir--1093871206"class="w3-small file-list"title="카테고리/.NET"open=""><summary>/.NET</summary><ul><li><a href="/posts/dotnet/csharp_basic.html">C# 기초</a><li><a href="/posts/dotnet/csharp_library.html">C# 라이브러리</a><li><a href="/posts/dotnet/wpf_basic.html">WPF 기초</a></ul></details><details id="dir-1275489025"class="w3-small file-list"title="카테고리/단일 주제"open=""><summary>/단일 주제</summary><ul><li><a href="/posts/single/sdkman.html">SDKMAN; The Software Development Kit Manager</a></ul></details><details id="dir-992513986"class="w3-small file-list"title="카테고리/독서"open=""><summary>/독서</summary><ul><li><a href="/posts/book/001.html">1만 시간의 재발견</a><li><a href="/posts/book/002.html">마음의 탄생</a><li><a href="/posts/book/003.html">생각하는 삶을 위한 철학의 역사</a><li><a href="/posts/book/004.html">쇼펜하우어, 돌이 별이 되는 철학</a><li><a href="/posts/book/005.html">인생의 모든 의미</a><li><a href="/posts/book/009.html">인지 편향</a><li><a href="/posts/book/006.html">지식의 착각</a><li><a href="/posts/book/007.html">키르케고르 실존 극장</a><li><a href="/posts/book/008.html">Gamification by Design</a></ul></details><details id="dir-453420171"class="w3-small file-list"title="카테고리/알고리즘"open=""><summary>/알고리즘</summary><ul><li><a href="/posts/algorithm/book01.html">『알고리즘 도감』</a><li><a href="/posts/algorithm/linear_algebra.html">선형대수</a><li><a href="/posts/algorithm/algo.html">알고리즘 일반</a><li><a href="/posts/algorithm/probability.html">확률</a></li><details id="dir--1451989604"class="w3-small file-list"title="카테고리/알고리즘/KOREATECH"open=""><summary>/KOREATECH</summary><ul><li><a href="/posts/algorithm/koreatech/1003.html">1003: 0을 만들자</a><li><a href="/posts/algorithm/koreatech/1008.html">1008: 순환 소수</a><li><a href="/posts/algorithm/koreatech/1018.html">1018: 문자열 거리 최소화 하기</a><li><a href="/posts/algorithm/koreatech/1048.html">1048: AP 배분</a><li><a href="/posts/algorithm/koreatech/1095.html">1095: 자연스러운 정렬</a><li><a href="/posts/algorithm/koreatech/1034.html">1034,1041: 최소 이동 거리</a><li><a href="/posts/algorithm/koreatech/1011.html">동적계획법(DP) 문제</a><li><a href="/posts/algorithm/koreatech/1010.html">소수(Prime) 관련 문제</a></ul></details></ul></details><details id="dir-1817032068"class="w3-small file-list"title="카테고리/작성 중지"open=""><summary>/작성 중지</summary><ul><li><a href="/posts/algorithm/ai.html">AI</a></ul></details></ul></details></div><hr><div id="file-list"></div><hr></div><div id="main"><div id="nav"style="position:-webkit-sticky;position:sticky;top:0;vertical-align:middle"class="w3-bar w3-blue w3-large"><button onclick="toggleSidebar()"class="w3-bar-item w3-button w3-hover-theme">&#9776;</button><input id="query"placeholder="search"class="w3-bar-item"></div><div id="contents"class="w3-padding"><h1 class="marker">MongoDB</h1><ol><li>NoSQL 데이터베이스의 한 종류. 데이터를 BSON(Binary JSON)으로 취급하며, SQL을 지원하지 않는다.</li><a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green"href="https://docs.mongodb.com/manual/reference/sql-comparison/"target="_blank">https://docs.mongodb.com/manual/reference/sql-comparison/</a><table class="no-sort"><tr><th>RDBMS<th>MongoDB<tr><td>Table<td>Collection<tr><td>Tuple, Row<td>Document<tr><td>Join<td>Embedding, Linking</table><a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green"href="https://docs.mongodb.com/manual/installation/"target="_blank">https://docs.mongodb.com/manual/installation/</a><li>서비스 등록이 안 됐길래 그냥 직접 실행함</li><div lan="bash"class="as-code code-div w3-leftbar w3-border-green">mongod --fork -f /etc/mongod.conf</div><li>최대 쿼리 결과 크기는 BSON 문서가 허용하는 16MB</li><p>이를 초과하는 문서가 필요하다면 GridFS API를 이용. mongofiles 명령 또는 드라이버 참고.</ol><h2 class="marker">BSON Specification</h2><ol><a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green"href="http://bsonspec.org/spec.html"target="_blank">http://bsonspec.org/spec.html</a><li>Basic Types</li><table class="no-sort"><tr><th>type<th>size(bytes)<tr><td>byte<td>1<tr><td>int32<td>4(signed, 2의 보수)<tr><td>int64<td>8(signed, 2의 보수)<tr><td>uint64<td>8(unsigned)<tr><td>double<td>8(IEEE 754-2008)<tr><td>decimal128<td>16(IEEE 754-2008)</table><li>Non-terminals</li><table class="no-sort"><tr><th><th><th><th><th>mongo alias<tr><td>document<td>::=<td>int32 e_list "\x00"<td>BSON 객체. int32는 문서의 바이트 크기<td><tr><td>e_list<td>::=<td>element e_list<td><td><tr><td><td>|<td>""<td><td><tr><td>element<td>::=<td>"\x01" e_name double<td><td>double<tr><td><td>|<td>"\x02" e_name string<td>UTF-8 string<td>string<tr><td><td>|<td>"\x03" e_name document<td>Embedded document<td>object<tr><td><td>|<td>"\x04" e_name document<td><span template-id="template-mongodb-bson-array"class="hover-content">Array</span><td>array<tr><td><td>|<td>"\x05" e_name binary<td>Binary data<td>binData<tr><td><td>|<td>"\x06" e_name<td>Deprecated<td>undefined<tr><td><td>|<td>"\x07" e_name (byte*12)<td>4바이트 시각 + 5바이트 랜덤 + 3바이트 카운터<td>objectId<tr><td><td>|<td>"\x08" e_name "\x00"<td>Boolean "false"<td>bool<tr><td><td>|<td>"\x08" e_name "\x01"<td>Boolean "true"<td>bool<tr><td><td>|<td>"\x09" e_name int64<td>UTC datetime(밀리초)<td>date<tr><td><td>|<td>"\x0A" e_name<td>Null<td>null<tr><td><td>|<td>"\x0B" e_name cstring cstring<td>각각 정규표현식 패턴,<span template-id="template-mongodb-bson-regex-option"class="hover-content">옵션(알파벳 순)</span><td>regex<tr><td><td>|<td>"\x0C" e_name string (byte*12)<td>Deprecated<td>dbPointer<tr><td><td>|<td>"\x0D" e_name string<td>JavaScript code<td>javascript<tr><td><td>|<td>"\x0E" e_name string<td>Deprecated<td>symbol<tr><td><td>|<td>"\x0F" e_name code_w_s<td>JavaScript code w/ scope<td>javascriptWithScope<tr><td><td>|<td>"\x10" e_name int32<td>32-bit integer<td>int<tr><td><td>|<td>"\x11" e_name uint64<td>Timestamp<td>timestamp<tr><td><td>|<td>"\x12" e_name int64<td><td>long<tr><td><td>|<td>"\x13" e_name decimal128<td><td>decimal<tr><td><td>|<td>"\xFF" e_name<td><span template-id="template-mongodb-min-key"class="hover-content">Min key</span><td>minKey<tr><td><td>|<td>"\x7F" e_name<td><span template-id="template-mongodb-max-key"class="hover-content">Max key</span><td>maxKey<tr><td>e_name<td>::=<td>cstring<td>Key name<td><tr><td>string<td>::=<td>int32 (byte*) "\x00"<td>UTF8 문자열. int32는 바이트 길이(\x00 포함)<td><tr><td>cstring<td>::=<td>(byte*) "\x00"<td>Modified UTF8 문자열<td><tr><td>binary<td>::=<td>int32 subtype (byte*)<td>int32는 (byte*) 바이트 길이<td><tr><td>subtype<td>::=<td>"\x00"<td>Generic binary subtype<td><tr><td><td>|<td>"\x01"<td>Function<td><tr><td><td>|<td>"\x02"<td>Binary (Old)<td><tr><td><td>|<td>"\x03"<td>UUID (Old)<td><tr><td><td>|<td>"\x04"<td>UUID<td><tr><td><td>|<td>"\x05"<td>MD5<td><tr><td><td>|<td>"\x06"<td>Encrypted BSON value<td><tr><td><td>|<td>"\x80"<td>User defined<td><tr><td>code_w_s<td>::=<td>int32 string document<td>Code w/ scope<td></table></ol><h2 class="marker">mongo Shell</h2><ul><li>mongo</li><p>기본 포트 27017<div lan="bash"class="as-code code-div w3-leftbar w3-border-green">mongo --port 28015 mongo "mongodb://host:port" mongo --password "mongodb://username@host:port" mongo --ssl --host replA/mongodb0.example.com.local:27017,mongodb1.example.com.local:27017,mongodb2.example.com.local:27017 mongo localhost:27017 file.js > load("file.js")</div><li>find(), aggregate() 쿼리 결과는 기본 101개로 제한된다</li><ol><li>find().batchSize(size)로 기본 배치 크기 변경 가능</li><p>그러하더라도 배치 당 16MB 제한은 벗어날 수 없다</p><li>cursor.next() 호출로 자동으로 getMore 연산이 수행되어 나머지 결과도 가져온다<li>cursor.objsLeftInBatch()로 배치에 남은 문서 수 확인 가능</ol><li>메서드<a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green"href="https://docs.mongodb.com/manual/reference/method/"target="_blank">https://docs.mongodb.com/manual/reference/method/</a><li>연산자<a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green"href="https://docs.mongodb.com/manual/reference/operator/query/"target="_blank">https://docs.mongodb.com/manual/reference/operator/query/</a><li>트랜잭션<a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green"href="https://docs.mongodb.com/manual/core/transactions/"target="_blank">https://docs.mongodb.com/manual/core/transactions/</a><li>Aggregation variables<a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green"href="https://docs.mongodb.com/manual/reference/aggregation-variables/"target="_blank">https://docs.mongodb.com/manual/reference/aggregation-variables/</a></ul><h3 class="marker">help</h3><table class="no-sort"><tr><td>db.help()<td>db 메서드 목록<tr><td>db.mycoll.help()<td>collection 메서드 목록<tr><td>sh.help()<td>sharding 메서드 목록<tr><td>rs.help()<td>replica set 메서드 목록<tr><td><td><tr><td>help admin<td>파일시스템 접근, 프로세스 실행 명령 목록<tr><td><span template-id="template-mongodb-help-connect"class="hover-content">help connect</span><td><tr><td><span template-id="template-mongodb-help-misc"class="hover-content">help misc</span><td><tr><td>help mr<td>mapreduce<tr><td><td><tr><td>show dbs // db.adminCommand('listDatabases')<td>DB 목록<tr><td>show collections // db.getCollectionNames()<td>현재 DB의 컬렉션 목록<tr><td>show users // db.getUsers()<td>현재 DB의 유저 목록<tr><td>show logs // db.adminCommand({'getLog': '*'})<td>로거 목록<tr><td>show log [name] // db.adminCommand({'getLog': 'name'})<td>로그 출력. name 기본값은 'global'<tr><td><td><tr><td>db<td>현재 사용 중인 DB<tr><td>use dbName // db.getSiblingDB('dbName')<td>DB 선택<tr><td>it // cursor = db.collName.find()<td>직전 find() 이터레이터 참조<tr><td>DBQuery.shellBatchSize = x<td>한번에 표시할 항목 수 변경<tr><td>print()<td>콘솔 출력<tr><td>printjson()<td>print(tojson(x))<tr><td>edit functionName<td>함수 편집<tr><td>exit<td></table><h3 class="marker">db.mycoll.find().help()</h3><h4 class="marker">find([object predicate][, object projection])</h4><div lan="javascript"class="as-code code-div w3-leftbar w3-border-green">let coll = db.myCollection;</div><table class="no-sort"><tr><td>coll.find()<td>select *<tr><td>coll.find({lv: 1})<td>select * where lv = 1<tr><td>coll.find({item: null})<td>item 속성이 null이거나 없으면 해당<tr><td>coll.find({item: {$type: 10}})<td>item 속성이 BSON 타입 10(Null)이면 해당<tr><td>coll.find({item: {$type: "array"}})<td>item 속성이 배열이면 해당<tr><td>coll.find({item: {$exists: false}})<td>item 속성이 없으면 해당<tr><td>coll.find({leaderCard.lv: 1})<td>select * where leaderCard.lv = 1<tr><td>coll.find({tags: ["red", "blank"]})<td>길이 및 원소 순서가 정확히 일치해야 함<tr><td>coll.find({tags: {$all: ["red", "blank"]}})<td>'red', 'blank' 두 개 모두 포함하기만 하면 됨<tr><td>coll.find({arr: {$elemMatch: {$gt: 22, $lt: 30}}})<td>배열 원소 하나라도 모든 조건을 충족하면 됨<tr><td>coll.find({"arr.0": {$gt: 22}})<td>arr[0]이 모든 조건을 충족하면 됨<tr><td>coll.find({arr: {$size: 3}})<td>arr.length == 3<tr><td>coll.find({lv: {$gt: 1}})<td>select * where lv > 1<tr><td>coll.find({$or: [{status: "A"}, {qty: {$lt: 30}}]})<td>select * where status = 'A' or qty &lt; 30<tr><td>coll.find({status: {$in: ["A", "D"]}})<td>select * where status in ('A', 'D')<tr><td>coll.find({}, {_id: 0})<td>Projection; _id 속성은 제외<tr><td>coll.find({}, {'leaderCard.lv': 1})<td>Projection; 특정 내부 속성 포함<tr><td>coll.find().sort({lv: 1})<td>1(오름차순), -1(내림차순)<tr><td>coll.find().limit(10)<td><tr><td>coll.findOne()<td>== limit(1)<tr><td>coll.find().count()<td>limit(), skip() 무시<tr><td>coll.find().size()<td>limit(), skip() 적용</table><h4 class="marker">Cursor methods</h4><p>db.mycoll.find()는 이터레이터(Cursor)를 반환한다. 단, mongo 쉘에서 var 변수에 할당하지 않은 경우 자동으로 결과를 출력하고 끝냄에 유의.<table class="no-sort"><tr><td>cursor.forEach()<td><tr><td>cursor.toArray()<td>커서를 모두 순회하고 메모리에 올린다.<tr><td>cursor.noCursorTimeout()<td>이 경우 커서를 모두 순회하거나, 수동으로 close()를 호출해야만 한다.</table><h3 class="marker">db.mycoll.help()</h3><div lan="javascript"class="as-code code-div w3-leftbar w3-border-green">let coll = db.myCollection;</div><table class="no-sort"><tr><td>coll.insertOne() Since 3.2<td>1개 추가<tr><td>coll.insertMany() Since 3.2<td>배열 요소 전부 추가<tr><td>coll.insert()<td>document 하나 또는 배열<tr><td>coll.updateOne(filter, update, options) Since 3.2<td><ul><li>1개 변경</li><div lan="javascript"class="as-code code-div w3-leftbar w3-border-green">updateOne({_id: 10}, {$set: {calc: 5}}) // update set calc = 5 {$inc: {calc: 5}} // set calc = calc + 5 {$currentDate: {updDate: true}} // set updDate = now()</div><li>옵션에 upsert: true가 있으면 없을 시 삽입<li>Since 4.2 갱신 연산에서 Aggregation pipeline 및 aggregation variable 사용 가능</li><div lan="javascript"class="as-code code-div w3-leftbar w3-border-green">{$set: {modified: "$$NOW"}}</div><div lan="javascript"class="as-code code-div w3-leftbar w3-border-green">{$set: {grade: {$switch: { branches: [ { case: { $gte: [ "$avgScore", 90 ] }, then: "A" }, { case: { $gte: [ "$avgScore", 80 ] }, then: "B" } ], default: "F" }</div><div lan="javascript"class="as-code code-div w3-leftbar w3-border-green">{$set: {myArr: {$concatArrays: ["$myArr", [8, 6]]}}}</div></ul><tr><td>coll.updateMany(filter, update, options) Since 3.2<td>여러 개 변경<tr><td>coll.replaceOne(filter, update, options) Since 3.2<td>1개 대치. _id는 변경되지 않는다.<tr><td>coll.deleteOne() Since 3.2<td>1개 삭제<tr><td>coll.deleteMany() Since 3.2<td>여러 개 삭제<tr><td>coll.drop()<td>전부 삭제<tr><td><span template-id="template-mongodb-bulk-write"class="hover-content">coll.bulkWrite()</span><td>insertOne, updateOne, updateMany, replaceOne, deleteOne, deleteMany 혼용.<tr><td>coll.createIndex()<td>인덱스가 없으면 생성.<tr><td>db.getSiblingDB()<td>현재 연결을 변경하지 않고 다른 DB 연결 획득.<tr><td>coll.renameCollection('newName')<td></table><h2 class="marker">Aggregation</h2><ul><li><div lan="javascript"class="as-code code-div w3-leftbar w3-border-green">db.mycoll.aggregate([ {$match: {grade: 'A'}}, {$group: {total: {$sum: "$amount"}}} ])</div><li><div lan="javascript"class="as-code code-div w3-leftbar w3-border-green">db.mycoll.mapReduce(mappingFunc, reduceFunc, {query: filterObj, out: "outName"})</div></li><div lan="javascript"class="as-code code-div w3-leftbar w3-border-green">db.mycoll.mapReduce( function() { emit(groupKey, value); }, function(key, values) { return aggrValue; } )</div><p>예 ↓<div lan="javascript"class="as-code code-div w3-leftbar w3-border-green">for(let i = 0; i &lt; 50; ++i) db.test.insertOne({num: i}) db.test.mapReduce( function() { emit(this.num % 5, this.num); }, function(key, values) { return Array.join(values); }, { out: 'result' } ).find()</div><div lan="text"class="as-code code-div w3-leftbar w3-border-green">{ "_id" : 0, "value" : "0,5,10,15,20,25,30,35,40,45" } { "_id" : 1, "value" : "1,6,11,16,21,26,31,36,41,46" } { "_id" : 2, "value" : "2,7,12,17,22,27,32,37,42,47" } { "_id" : 3, "value" : "3,8,13,18,23,28,33,38,43,48" } { "_id" : 4, "value" : "4,9,14,19,24,29,34,39,44,49" }</div><li><div lan="javascript"class="as-code code-div w3-leftbar w3-border-green">db.mycoll.estimatedDocumentCount()</div><li><div lan="javascript"class="as-code code-div w3-leftbar w3-border-green">db.mycoll.count()</div><li><div lan="javascript"class="as-code code-div w3-leftbar w3-border-green">db.mycoll.distinct([string field][, object query][, object options])</div></ul><div class="w3-container w3-leftbar w3-border-green w3-white hover-template"id="template-mongodb-bson-regex-option"><table class="no-sort"><tr><td>i<td>대소문자 구별X<tr><td>m<td>여러 줄 매칭<tr><td>x<td>verbose<tr><td>l<td>로캐일에 따른 \w, \W 등의 해석<tr><td>s<td>'.'이 임의 문자 매칭<tr><td>u<td>\w, \W 등이 유니코드에 따라 매칭</table></div><div class="w3-container w3-leftbar w3-border-green w3-white hover-template"id="template-mongodb-bson-array">예. ['red', 'blue']는 {'0': 'red', '1': 'blue'}로 표현된다</div><div class="w3-container w3-leftbar w3-border-green w3-white hover-template"id="template-mongodb-min-key">항상 다른 것보다 작다고 간주됨</div><div class="w3-container w3-leftbar w3-border-green w3-white hover-template"id="template-mongodb-max-key">항상 다른 것보다 크다고 간주됨</div><div class="w3-container w3-leftbar w3-border-green w3-white hover-template as-code"id="template-mongodb-help-connect"lan="javascript">const mongo = new Mongo('host[:port]'); const mydb = mongo.getDB('mydb'); // or const mydb2 = connect('host[:port]/mydb2');</div><div class="w3-container w3-leftbar w3-border-green w3-white hover-template as-code"id="template-mongodb-help-misc"lan="javascript">b = new BinData(subtype,base64str) // new BSON BinData b = HexData(subtype,hexstr) // BSON BinData from a hex string b = UUID(hexstr) // BSON BinData of UUID subtype b = MD5(hexstr) // BSON BinData of MD5 subtype b.subtype(), b.length(), b.hex(), b.base64(), b.toString() "hexstr" // 0x 접두 필요없이 [0-9a-fA-F]를 나열 o = new ObjectId() // ObjectId o.getTimestamp(), o.isObjectId, o.toString(), o.equals(otherid) d = ISODate() // like Date() but behaves more intuitively when used d = ISODate('YYYY-MM-DD hh:mm:ss') // without an explicit "new " prefix on construction</div><div class="w3-container w3-leftbar w3-border-green w3-white hover-template as-code"id="template-mongodb-bulk-write"lan="javascript">coll.bulkWrite([ { insertOne: { "document": { "_id": 4, "char": "Dithras", "class": "barbarian", "lvl": 4 } } }, { insertOne: { "document": { "_id": 5, "char": "Taeln", "class": "fighter", "lvl": 3 } } }, { updateOne: { "filter": { "char": "Eldon" }, "update": { $set: { "status": "Critical Injury" } } } }, { deleteOne: { "filter": { "char": "Brisbane" } } }, { replaceOne: { "filter": { "char": "Meldane" }, "replacement": { "char": "Tanys", "class": "oracle", "lvl": 4 } } } ]);</div></div><hr>&copy; 2020. <a href="mailto:hi.donggi@gmail.com">Donggi Kim</a> all rights reserved.<a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green"href="/LICENSE"target="_blank">/LICENSE</a></div>