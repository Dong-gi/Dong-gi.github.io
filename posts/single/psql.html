<script src="/source/redirect.js?200226_1657"></script>
<hr>

<details>
    <summary>명령어 목록</summary>
    <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green" target="_blank" href="http://postgresql.kr/docs/current/sql-commands.html">http://postgresql.kr/docs/current/sql-commands.html</a>
</details>

<hr>

<details>
    <summary>postgres 유저 비밀번호를 모를 때</summary>
    <ol>
        <li>pg_hba.conf 파일을 비밀번호 없이 접속할 수 있도록 trust로 변경 후 접속(서비스 재시작 필요)</li>
        <li>비밀번호 설정 후 pg_hba.conf 다시 원복</li>
    </ol>
</details>

<hr>

<details>
    <summary>모든 테이블에 대한 권한 부여</summary>
    <ul>
        <li>GRANT SELECT ON ALL TABLES IN SCHEMA public TO user;</li>
        <li>GRANT EXECUTE ON ALL FUNCTIONS IN SCHEMA public TO user;</li>
        <li>이후 추가되는 테이블에도 적용하려면 기본 권한을 변경</li>
        ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT SELECT ON TABLES TO user;
        <li>실제로 적용됐는지 확인</li>
        select * from information_schema.role_table_grants where table_name = 'table_name';
    </ul>
</details>

<hr>

<details>
    <summary>dblink 재활용</summary>
<pre>SELECT dblink_connect('myconn', 'hostaddr=1.2.3.4 port=5432 dbname=history user=readonly password=password');
(SELECT account_id, last_login_date FROM v_account WHERE account_id IN
    (SELECT r.account_id FROM dblink('myconn', 'SELECT account_id, sum(amount) as total_amount FROM v_payment_history WHERE status=2 GROUP BY account_id HAVING sum(amount) &gt;= 10000') AS r(account_id BIGINT, total_amount BIGINT))
) UNION ...</pre>
</details>

<hr>

<details>
    <summary>시각 차이 획득</summary>
    select abs(extract (epoch from (insert_datetime - '2019-07-04 19:39:55'::timestamp)));
</details>

<hr>

<details>
    <summary>커넥션 정리</summary>
    select pg_terminate_backend(pid) from pg_stat_activity where client_addr = '10.0.2.2';
</details>

<hr>

<details>
    <summary>AWS Redshift와 드라이버 충돌될 때</summary>
    jdbc 연결 쿼리에 <a class="w3-btn w3-round w3-round-xxlarge w3-small w3-green" target="_blank" href="https://www.simba.com/products/Redshift/doc/JDBC_InstallGuide/content/jdbc/re/options/opensourcesubprotocoloverride.htm">OpenSourceSubProtocolOverride=true</a> 추가.
</details>

<hr>