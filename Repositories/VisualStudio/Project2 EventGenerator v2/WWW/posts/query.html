<table id="beforeQueries">
    <tr><th>설명</th><th>서버</th><th>DB</th><th>쿼리</th><th colspan="2" pre-sort sort-order="▲">실행 횟수</th></tr>
    <tr id="query-add-row"><td contenteditable="true"></td><td></td><td contenteditable="true"></td><td contenteditable="true"></td><td>99999</td><td><button id="query-add-btn" class="w3-btn w3-round w3-round-xxlarge w3-small w3-blue">추가</button></td></tr>
</table>

<script>
    function addQueryTr(query) {
        let tr = Donggi.getElementFromText(`<tr><td contenteditable="true">${query.description}</td><td>${query.server}</td><td contenteditable="true">${query.db}</td><td contenteditable="true">${query.query}</td><td>${query.count}</td><td><button class="w3-btn w3-round w3-round-xxlarge w3-small w3-green">실행</button></td></tr>`, 'tbody');
        let tds = tr.querySelectorAll('td');
        Donggi.bind(query, 'description', [tds[0]]);
        Donggi.addInputSelection(tds[1], servers);
        Donggi.bind(query, 'server', [tds[1]]);
        Donggi.bind(query, 'db', [tds[2]]);
        Donggi.bind(query, 'query', [tds[3]]);
        query = Donggi.bind(query, 'count', [tds[4]]);
        tds[5].onclick = ((query) => function(e) {
            sendQuery(query, true);
        })(query);
        document.getElementById('beforeQueries').append(tr);
        return query;
    }
    if (!!queries) {
        for (let query of queries)
            addQueryTr(query);
    }
    Donggi.addInputSelection(document.querySelector('#query-add-row>td:nth-child(2)'), servers);
    document.getElementById('query-add-btn').onclick = function(e) {
        let tr = document.getElementById('query-add-row');
        let tds = tr.querySelectorAll('td');
        let query = new Query(tds[1].textContent.trim(), tds[2].textContent.trim(), tds[3].textContent.trim());
        query.description = tds[0].textContent.trim();
        query = addQueryTr(query);
        queries.push(query);
        localStorage.queries = JSON.stringify(queries);
    }
</script>