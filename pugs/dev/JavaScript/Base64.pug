include ../../../source/skeleton.pug

+post({
    title: 'JavaScript > Base64',
    description: 'JavaScriptì—ì„œ Base64 ì¸ì½”ë”©ì„ ë‹¤ë£° ë•Œ ìœ ì˜ì‚¬í•­',
})

    h1 ì°¸ê³  ìë£Œ
    ul
        li: +asA('https://web.dev/articles/base64-encoding', 'web.dev í¬ìŠ¤íŠ¸')
        li: +asA('https://developer.mozilla.org/en-US/docs/Glossary/Base64', 'mdn ì„¤ëª…ì„œ > Base64')

    h1 Base64 ì¸ì½”ë”©/ë””ì½”ë”© ê´€ë ¨ ì „ì—­ í•¨ìˆ˜
    p JavaScript í™˜ê²½ì€ Base64ì™€ ê´€ë ¨í•œ ì‚¬ì „ ì •ì˜ëœ ì „ì—­ í•¨ìˆ˜ë¥¼ ì œê³µí•œë‹¤
    ul
        li btoa() : Binary stringì„ ASCII ë¬¸ìì—´(Base64)ë¡œ ì¸ì½”ë”©í•œë‹¤
        p ì´ì§„ ë¬¸ìì—´ì´ë¼ê³  í‘œê¸°í•˜ëŠ” ì´ìœ ëŠ”, ê° ë¬¸ìê°€ 1ë°”ì´íŠ¸ ë°”ì´ë„ˆë¦¬ ë°ì´í„°ë¡œ ê°„ì£¼ë¼ì•¼ í•˜ê¸° ë•Œë¬¸
        li atob() : ASCII ë¬¸ìì—´(Base64)ì„ ë””ì½”ë”©í•œë‹¤

    h1 ìœ ë‹ˆì½”ë“œ ë¬¸ìì—´ ì¸ì½”ë”©
    p btoa()ëŠ” ê° ê¸€ìê°€ 1ë°”ì´íŠ¸ì—¬ì•¼ë§Œ ë™ì‘í•œë‹¤
    +asCode('JavaScript').
        btoa('â›³')
        // Uncaught InvalidCharacterError: Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.

    p ë”°ë¼ì„œ JavaScriptì˜ UTF-16 ìœ ë‹ˆì½”ë“œ ë¬¸ìì—´ì„ btoa()ì— ì „ë‹¬í•˜ê¸° ì „ì— ëª¨ë“  ë¬¸ìë“¤ì„ 1ë°”ì´íŠ¸ ë‹¨ìœ„ë¡œ ìª¼ê°œê³ , atob()ì˜ ê²°ê³¼ë¬¼ì„ ì ì ˆí•˜ê²Œ ìœ ë‹ˆì½”ë“œë¡œ í•©ì„±í•  í•„ìš”ê°€ ìˆë‹¤. mdnì—ì„œëŠ” ì´ë¥¼ ìœ„í•œ ê°€ì¥ ê°„ë‹¨í•œ ë°©ë²•ìœ¼ë¡œ TextEncoderì™€ TextDecoder ì‚¬ìš©ì„ ì œì‹œí•œë‹¤
    +asCode('JavaScript').
        const textEncoder = new TextEncoder()
        const textDecoder = new TextDecoder()

        function decodeBase64 (base64) {
            const binTxt = atob(base64)
            const codePointArr = Uint8Array.from(binTxt, (x) => x.codePointAt(0))
            return textDecoder.decode(codePointArr)
        }

        function encodeBase64 (txt) {
            const codePointArr = textEncoder.encode(txt)
            const binTxt = Array.from(codePointArr, (x) => String.fromCodePoint(x)).join('')
            return btoa(binTxt)
        }

        console.log(encodeBase64('ì•ˆë…•í•˜ì„¸ìš”~'))
            // ã„´ 7JWI64WV7ZWY7IS47JqUfg==
        console.log(decodeBase64(encodeBase64('ì•ˆë…•í•˜ì„¸ìš”~')))
            // ã„´ ì•ˆë…•í•˜ì„¸ìš”~

    p í•œí¸, ë¶ˆì™„ì „í•œ(lone) surrogate ë¬¸ìì—´ì´ ì¡´ì¬í•œë‹¤ë©´ ì¸ì½”ë”©-ë””ì½”ë”©ì„ ê±°ì¹œ ê²°ê³¼ëŠ” ì›ë³¸ê³¼ ë‹¤ë¥¼ ìˆ˜ ìˆë‹¤
    +asCode('JavaScript').
        const originalTxt = 'helloâ›³â¤ï¸ğŸ§€\uDE75'
        const encodedTxt = encodeBase64(originalTxt)
        console.log(encodedTxt)
            // ã„´ aGVsbG/im7PinaTvuI/wn6eA77+9
        const decodedTxt = decodeBase64(encodedTxt)
        console.log(decodedTxt)
            // ã„´ helloâ›³â¤ï¸ğŸ§€ï¿½
        for (let i = 0; i < decodedTxt.length; ++i) {
            console.log(i, decodedTxt[i], '0x' + decodedTxt.charCodeAt(i).toString(16).toUpperCase())
        }
        // 0 'h' '0x68'
        // 1 'e' '0x65'
        // 2 'l' '0x6C'
        // 3 'l' '0x6C'
        // 4 'o' '0x6F'
        // 5 'â›³' '0x26F3'      : 16ë¹„íŠ¸ ë¬¸ì í•˜ë‚˜ë¡œ í‘œí˜„ ê°€ëŠ¥í•œ ê²½ìš°
        // 6 'â¤' '0x2764'
        // 7 'ï¸' '0xFE0F'        : ìƒ‰ ì„ íƒ. https://en.wikipedia.org/wiki/Variation_Selectors_(Unicode_block)
        // 8 '\uD83E' '0xD83E'  : ğŸ§€ì˜ ìƒìœ„ surrogate
        // 9 '\uDDC0' '0xDDC0'  : ğŸ§€ì˜ í•˜ìœ„ surrogate
        // 10 'ï¿½' '0xFFFD'      : ë¶ˆì™„ì „í•œ surrogateì— ëŒ€í•œ ëŒ€ì²´ ì½”ë“œ

    h1 ê²°ë¡ 
    ul
        li ì´ì§„ ë°ì´í„°ë¥¼ ì¸ì½”ë”©/ë””ì½”ë”©í•˜ëŠ” ê²½ìš° : TextEncoderì™€ TextDecoderë¥¼ ì‚¬ìš©í•  í•„ìš”ê°€ ì—†ìŒ
        li ë¬¸ìì—´ì„ ì¸ì½”ë”©/ë””ì½”ë”©í•˜ëŠ” ê²½ìš°
        ul
            li ì›ë³¸ê³¼ ë‹¤ë¥´ë©´ ì•ˆ ë˜ëŠ” ê²½ìš° : ì¸ì½”ë”©í•˜ê¸° ì „ì— #[+asA('https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/isWellFormed', 'isWellFormed()')]ì™€ ê°™ì´ ì…ë ¥ì´ ì ì ˆí•œì§€ ê²€ì‚¬í•  í•„ìš”ê°€ ìˆë‹¤
            li ì›ë³¸ê³¼ ë‹¬ë¼ë„ ë˜ëŠ” ê²½ìš° : ìœ„ ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ì´ìš©í•˜ê±°ë‚˜, #[+asA('https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/toWellFormed#browser_compatibility', 'toWellFormed()')]ë¥¼ ì´ìš©í•´ ê°’ì´ ë³€ê²½ë  ê±°ë¼ê³  ì¸ì½”ë”© ê²°ê³¼ë¡œ ì•Œë ¤ì¤„ ìˆ˜ ìˆë‹¤
